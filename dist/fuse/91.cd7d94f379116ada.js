(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[91],{4091:(ze,Ht,N)=>{"use strict";function kt(n,t,e,i,s,r,a){try{var l=n[r](a),c=l.value}catch(h){return void e(h)}l.done?t(c):Promise.resolve(c).then(i,s)}function W(n){return function(){var t=this,e=arguments;return new Promise(function(i,s){var r=n.apply(t,e);function a(c){kt(r,i,s,a,l,"next",c)}function l(c){kt(r,i,s,a,l,"throw",c)}a(void 0)})}}N.r(Ht),N.d(Ht,{default:()=>zg});var vt=N(4755),wt=N(3144),et=N(9401),mt=N(1728),q=N(7870),j=N(9114),Q=N(430),F=N(9609),L=N(7081),B=N(877),D=N(2342),J=N(3617),y=N(2480),C=N(979),o=N(2223),O=N(1217);let nl=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=o.oAB({type:n}),n.\u0275inj=o.cJS({imports:[O.BQ,vt.ez,O.BQ]}),n})(),sl=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=o.oAB({type:n}),n.\u0275inj=o.cJS({imports:[vt.ez,nl]}),n})();var be=N(2340),Pr=N(7326),rl=N(6550),Lr=N(4031),Or=N(7495);const ue=class ol{constructor(t){this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}},us=class al{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};function We(n,t){return n>t?1:n<t?-1:0}function ds(n,t,e){if(n[0]<=t)return 0;const i=n.length;if(t<=n[i-1])return i-1;if("function"==typeof e){for(let s=1;s<i;++s){const r=n[s];if(r===t)return s;if(r<t)return e(t,n[s-1],r)>0?s-1:s}return i-1}if(e>0){for(let s=1;s<i;++s)if(n[s]<t)return s-1;return i-1}if(e<0){for(let s=1;s<i;++s)if(n[s]<=t)return s;return i-1}for(let s=1;s<i;++s){if(n[s]==t)return s;if(n[s]<t)return n[s-1]-t<t-n[s]?s-1:s}return i-1}function ll(n,t,e){for(;t<e;){const i=n[t];n[t]=n[e],n[e]=i,++t,--e}}function Fr(n,t){const e=Array.isArray(t)?t:[t],i=e.length;for(let s=0;s<i;s++)n[n.length]=e[s]}function we(n,t){const e=n.length;if(e!==t.length)return!1;for(let i=0;i<e;i++)if(n[i]!==t[i])return!1;return!0}function Ni(){return!0}function fn(){return!1}function hi(){}function Gi(n){for(const t in n)delete n[t]}function Ui(n){let t;for(t in n)return!1;return!t}const _n=class ul extends us{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),s=i[t]||(i[t]=[]);s.includes(e)||s.push(e)}dispatchEvent(t){const e="string"==typeof t,i=e?t:t.type,s=this.listeners_&&this.listeners_[i];if(!s)return;const r=e?new ue(t):t;r.target||(r.target=this.eventTarget_||this);const a=this.dispatching_||(this.dispatching_={}),l=this.pendingRemovals_||(this.pendingRemovals_={});let c;i in a||(a[i]=0,l[i]=0),++a[i];for(let h=0,u=s.length;h<u;++h)if(c="handleEvent"in s[h]?s[h].handleEvent(r):s[h].call(this,r),!1===c||r.propagationStopped){c=!1;break}if(0==--a[i]){let h=l[i];for(delete l[i];h--;)this.removeEventListener(i,hi);delete a[i]}return c}disposeInternal(){this.listeners_&&Gi(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return!!this.listeners_&&(t?t in this.listeners_:Object.keys(this.listeners_).length>0)}removeEventListener(t,e){const i=this.listeners_&&this.listeners_[t];if(i){const s=i.indexOf(e);-1!==s&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[s]=hi,++this.pendingRemovals_[t]):(i.splice(s,1),0===i.length&&delete this.listeners_[t]))}}},V={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function rt(n,t,e,i,s){if(i&&i!==n&&(e=e.bind(i)),s){const a=e;e=function(){n.removeEventListener(t,e),a.apply(this,arguments)}}const r={target:n,type:t,listener:e};return n.addEventListener(t,e),r}function mn(n,t,e,i){return rt(n,t,e,i,!0)}function pt(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),Gi(n))}const Dr=class pn extends _n{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(V.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=rt(this,t[r],e);return s}return rt(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const s=t.length;i=new Array(s);for(let r=0;r<s;++r)i[r]=mn(this,t[r],e)}else i=mn(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)!function dl(n){if(Array.isArray(n))for(let t=0,e=n.length;t<e;++t)pt(n[t]);else pt(n)}(i);else if(Array.isArray(t))for(let s=0,r=t.length;s<r;++s)this.removeEventListener(t[s],e);else this.removeEventListener(t,e)}};function ot(){throw new Error("Unimplemented abstract method.")}let gl=0;function ct(n){return n.ol_uid||(n.ol_uid=String(++gl))}class kr extends ue{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}const re=class fl extends Dr{constructor(t){super(),ct(this),this.values_=null,void 0!==t&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(t,e){let i;i=`change:${t}`,this.hasListener(i)&&this.dispatchEvent(new kr(i,t,e)),i="propertychange",this.hasListener(i)&&this.dispatchEvent(new kr(i,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const s=this.values_||(this.values_={});if(i)s[t]=e;else{const r=s[t];s[t]=e,r!==e&&this.notify(t,r)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],Ui(this.values_)&&(this.values_=null),e||this.notify(t,i)}}},_l={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:'`renderMode` must be `"hybrid"` or `"vector"`',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection",69:"`width` or `height` cannot be provided together with `scale`"};class ml extends Error{constructor(t){const e=_l[t];super(e),this.code=t,this.name="AssertionError",this.message=e}}const Zr=ml;class yn extends ue{constructor(t,e,i){super(t),this.element=e,this.index=i}}const oe=class pl extends re{constructor(t,e){if(super(),this.unique_=!!(e=e||{}).unique,this.array_=t||[],this.unique_)for(let i=0,s=this.array_.length;i<s;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,i=t.length;e<i;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let i=0,s=e.length;i<s;++i)t(e[i],i,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get("length")}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new yn("add",e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let i=0,s=e.length;i<s;++i)if(e[i]===t)return this.removeAt(i)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new yn("remove",e,t)),e}setAt(t,e){if(t>=this.getLength())return void this.insertAt(t,e);if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const s=this.array_[t];this.array_[t]=e,this.dispatchEvent(new yn("remove",s,t)),this.dispatchEvent(new yn("add",e,t))}updateLength_(){this.set("length",this.array_.length)}assertUnique_(t,e){for(let i=0,s=this.array_.length;i<s;++i)if(this.array_[i]===t&&i!==e)throw new Zr(58)}},Re=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",yl=Re.includes("firefox"),xl=(Re.includes("safari")&&!Re.includes("chrom")&&(Re.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Re)),Re.includes("webkit")&&!Re.includes("edge")),vl=Re.includes("macintosh"),Gr=typeof devicePixelRatio<"u"?devicePixelRatio:1,gs=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Cl=typeof Image<"u"&&Image.prototype.decode,Ur=function(){let n=!1;try{const t=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return n}();function tt(n,t){if(!n)throw new Zr(t)}function Rt(n,t){const e=t[0],i=t[1];return t[0]=n[0]*e+n[2]*i+n[4],t[1]=n[1]*e+n[3]*i+n[5],t}function de(n,t,e,i,s,r,a,l){const c=Math.sin(r),h=Math.cos(r);return n[0]=i*h,n[1]=s*c,n[2]=-i*c,n[3]=s*h,n[4]=a*i*h-l*i*c+t,n[5]=a*s*c+l*s*h+e,n}function xn(n,t){const e=function bl(n){return n[0]*n[3]-n[1]*n[2]}(t);tt(0!==e,32);const i=t[0],s=t[1],r=t[2],a=t[3],l=t[4],c=t[5];return n[0]=a/e,n[1]=-s/e,n[2]=-r/e,n[3]=i/e,n[4]=(r*c-a*l)/e,n[5]=-(i*c-s*l)/e,n}let zr;function ms(n){const t="matrix("+n.join(", ")+")";if(gs)return t;const e=zr||(zr=document.createElement("div"));return e.style.transform=t,e.style.transform}new Array(6);const St={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Yr(n){const t=[1/0,1/0,-1/0,-1/0];for(let e=0,i=n.length;e<i;++e)di(t,n[e]);return t}function ps(n,t,e){return e?(e[0]=n[0]-t,e[1]=n[1]-t,e[2]=n[2]+t,e[3]=n[3]+t,e):[n[0]-t,n[1]-t,n[2]+t,n[3]+t]}function Xr(n,t){return t?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t):n.slice()}function Wr(n,t,e){let i,s;return i=t<n[0]?n[0]-t:n[2]<t?t-n[2]:0,s=e<n[1]?n[1]-e:n[3]<e?e-n[3]:0,i*i+s*s}function vn(n,t){return Br(n,t[0],t[1])}function ui(n,t){return n[0]<=t[0]&&t[2]<=n[2]&&n[1]<=t[1]&&t[3]<=n[3]}function Br(n,t,e){return n[0]<=t&&t<=n[2]&&n[1]<=e&&e<=n[3]}function ys(n,t){const a=t[0],l=t[1];let c=St.UNKNOWN;return a<n[0]?c|=St.LEFT:a>n[2]&&(c|=St.RIGHT),l<n[1]?c|=St.BELOW:l>n[3]&&(c|=St.ABOVE),c===St.UNKNOWN&&(c=St.INTERSECTING),c}function ge(n,t,e,i,s){return s?(s[0]=n,s[1]=t,s[2]=e,s[3]=i,s):[n,t,e,i]}function Be(n){return ge(1/0,1/0,-1/0,-1/0,n)}function Yi(n,t){return n[0]==t[0]&&n[2]==t[2]&&n[1]==t[1]&&n[3]==t[3]}function di(n,t){t[0]<n[0]&&(n[0]=t[0]),t[0]>n[2]&&(n[2]=t[0]),t[1]<n[1]&&(n[1]=t[1]),t[1]>n[3]&&(n[3]=t[1])}function qr(n,t,e,i,s){for(;e<i;e+=s)Al(n,t[e],t[e+1]);return n}function Al(n,t,e){n[0]=Math.min(n[0],t),n[1]=Math.min(n[1],e),n[2]=Math.max(n[2],t),n[3]=Math.max(n[3],e)}function Kr(n,t){let e;return e=t(En(n)),!!(e||(e=t(Tn(n)),e)||(e=t(bn(n)),e)||(e=t(je(n)),e))&&e}function Cn(n){let t=0;return wn(n)||(t=_t(n)*$t(n)),t}function En(n){return[n[0],n[1]]}function Tn(n){return[n[2],n[1]]}function gi(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function Pl(n,t){let e;return"bottom-left"===t?e=En(n):"bottom-right"===t?e=Tn(n):"top-left"===t?e=je(n):"top-right"===t?e=bn(n):tt(!1,13),e}function xs(n,t,e,i,s){const[r,a,l,c,h,u,d,g]=vs(n,t,e,i);return ge(Math.min(r,l,h,d),Math.min(a,c,u,g),Math.max(r,l,h,d),Math.max(a,c,u,g),s)}function vs(n,t,e,i){const s=t*i[0]/2,r=t*i[1]/2,a=Math.cos(e),l=Math.sin(e),c=s*a,h=s*l,u=r*a,d=r*l,g=n[0],f=n[1];return[g-c+d,f-h-u,g-c-d,f-h+u,g+c-d,f+h+u,g+c+d,f+h-u,g-c+d,f-h-u]}function $t(n){return n[3]-n[1]}function fi(n,t,e){const i=e||[1/0,1/0,-1/0,-1/0];return Nt(n,t)?(i[0]=n[0]>t[0]?n[0]:t[0],i[1]=n[1]>t[1]?n[1]:t[1],i[2]=n[2]<t[2]?n[2]:t[2],i[3]=n[3]<t[3]?n[3]:t[3]):Be(i),i}function je(n){return[n[0],n[3]]}function bn(n){return[n[2],n[3]]}function _t(n){return n[2]-n[0]}function Nt(n,t){return n[0]<=t[2]&&n[2]>=t[0]&&n[1]<=t[3]&&n[3]>=t[1]}function wn(n){return n[2]<n[0]||n[3]<n[1]}function Vr(n,t){const e=t.getExtent(),i=gi(n);if(t.canWrapX()&&(i[0]<e[0]||i[0]>=e[2])){const s=_t(e),a=Math.floor((i[0]-e[0])/s)*s;n[0]-=a,n[2]-=a}return n}function Et(n,t,e){return Math.min(Math.max(n,t),e)}function kl(n,t,e,i,s,r){const a=s-e,l=r-i;if(0!==a||0!==l){const c=((n-e)*a+(t-i)*l)/(a*a+l*l);c>1?(e=s,i=r):c>0&&(e+=a*c,i+=l*c)}return _i(n,t,e,i)}function _i(n,t,e,i){const s=e-n,r=i-t;return s*s+r*r}function Rn(n){return n*Math.PI/180}function mi(n,t){const e=n%t;return e*t<0?e+t:e}function te(n,t,e){return n+e*(t-n)}function Sn(n,t){const e=Math.pow(10,t);return Math.round(n*e)/e}function In(n,t){return Math.floor(Sn(n,t))}function Mn(n,t){return Math.ceil(Sn(n,t))}const Hr=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,Jr=/^([a-z]*)$|^hsla?\(.*\)$/i;function Qr(n){return"string"==typeof n?n:eo(n)}const Nl=function(){const t={};let e=0;return function(i){let s;if(t.hasOwnProperty(i))s=t[i];else{if(e>=1024){let r=0;for(const a in t)3&r++||(delete t[a],--e)}s=function Gl(n){let t,e,i,s,r;if(Jr.exec(n)&&(n=function $r(n){const t=document.createElement("div");if(t.style.color=n,""!==t.style.color){document.body.appendChild(t);const e=getComputedStyle(t).color;return document.body.removeChild(t),e}return""}(n)),Hr.exec(n)){const a=n.length-1;let l;l=a<=4?1:2;const c=4===a||8===a;t=parseInt(n.substr(1+0*l,l),16),e=parseInt(n.substr(1+1*l,l),16),i=parseInt(n.substr(1+2*l,l),16),s=c?parseInt(n.substr(1+3*l,l),16):255,1==l&&(t=(t<<4)+t,e=(e<<4)+e,i=(i<<4)+i,c&&(s=(s<<4)+s)),r=[t,e,i,s/255]}else n.startsWith("rgba(")?(r=n.slice(5,-1).split(",").map(Number),to(r)):n.startsWith("rgb(")?(r=n.slice(4,-1).split(",").map(Number),r.push(1),to(r)):tt(!1,14);return r}(i),t[i]=s,++e}return s}}();function An(n){return Array.isArray(n)?n:Nl(n)}function to(n){return n[0]=Et(n[0]+.5|0,0,255),n[1]=Et(n[1]+.5|0,0,255),n[2]=Et(n[2]+.5|0,0,255),n[3]=Et(n[3],0,1),n}function eo(n){let t=n[0];t!=(0|t)&&(t=t+.5|0);let e=n[1];e!=(0|e)&&(e=e+.5|0);let i=n[2];return i!=(0|i)&&(i=i+.5|0),"rgba("+t+","+e+","+i+","+(void 0===n[3]?1:Math.round(100*n[3])/100)+")"}function io(n,t,e){return t+":"+n+":"+(e?Qr(e):"null")}const Pn=new class Ul{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_)!(3&t++)&&!this.cache_[e].hasListener()&&(delete this.cache_[e],--this.cacheSize_)}}get(t,e,i){const s=io(t,e,i);return s in this.cache_?this.cache_[s]:null}set(t,e,i,s){const r=io(t,e,i);this.cache_[r]=s,++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}},no=class zl extends re{constructor(t){super(),this.background_=t.background;const e=Object.assign({},t);"object"==typeof t.properties&&(delete e.properties,Object.assign(e,t.properties)),e.opacity=void 0!==t.opacity?t.opacity:1,tt("number"==typeof e.opacity,64),e.visible=void 0===t.visible||t.visible,e.zIndex=t.zIndex,e.maxResolution=void 0!==t.maxResolution?t.maxResolution:1/0,e.minResolution=void 0!==t.minResolution?t.minResolution:0,e.minZoom=void 0!==t.minZoom?t.minZoom:-1/0,e.maxZoom=void 0!==t.maxZoom?t.maxZoom:1/0,this.className_=void 0!==e.className?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:void 0===t||t},i=this.getZIndex();return e.opacity=Et(Math.round(100*this.getOpacity())/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=void 0!==i||e.managed?i:1/0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return ot()}getLayerStatesArray(t){return ot()}getExtent(){return this.get("extent")}getMaxResolution(){return this.get("maxResolution")}getMinResolution(){return this.get("minResolution")}getMinZoom(){return this.get("minZoom")}getMaxZoom(){return this.get("maxZoom")}getOpacity(){return this.get("opacity")}getSourceState(){return ot()}getVisible(){return this.get("visible")}getZIndex(){return this.get("zIndex")}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set("extent",t)}setMaxResolution(t){this.set("maxResolution",t)}setMinResolution(t){this.set("minResolution",t)}setMaxZoom(t){this.set("maxZoom",t)}setMinZoom(t){this.set("minZoom",t)}setOpacity(t){tt("number"==typeof t,64),this.set("opacity",t)}setVisible(t){this.set("visible",t)}setZIndex(t){this.set("zIndex",t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}},ee={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},Yl=42,Cs=256,qe={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937},so=class Wl{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||qe[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}},Xi=6378137,pi=Math.PI*Xi,Bl=[-pi,-pi,pi,pi],jl=[-180,-85,180,85],Ln=Xi*Math.log(Math.tan(Math.PI/2));class yi extends so{constructor(t){super({code:t,units:"m",extent:Bl,global:!0,worldExtent:jl,getPointResolution:function(e,i){return e/Math.cosh(i[1]/Xi)}})}}const ro=[new yi("EPSG:3857"),new yi("EPSG:102100"),new yi("EPSG:102113"),new yi("EPSG:900913"),new yi("http://www.opengis.net/def/crs/EPSG/0/3857"),new yi("http://www.opengis.net/gml/srs/epsg.xml#3857")];function ql(n,t,e){const i=n.length;e=e>1?e:2,void 0===t&&(t=e>2?n.slice():new Array(i));for(let s=0;s<i;s+=e){t[s]=pi*n[s]/180;let r=Xi*Math.log(Math.tan(Math.PI*(+n[s+1]+90)/360));r>Ln?r=Ln:r<-Ln&&(r=-Ln),t[s+1]=r}return t}function Kl(n,t,e){const i=n.length;e=e>1?e:2,void 0===t&&(t=e>2?n.slice():new Array(i));for(let s=0;s<i;s+=e)t[s]=180*n[s]/pi,t[s+1]=360*Math.atan(Math.exp(n[s+1]/Xi))/Math.PI-90;return t}const oo=[-180,-90,180,90],Hl=6378137*Math.PI/180;class Ke extends so{constructor(t,e){super({code:t,units:"degrees",extent:oo,axisOrientation:e,global:!0,metersPerUnit:Hl,worldExtent:oo})}}const ao=[new Ke("CRS:84"),new Ke("EPSG:4326","neu"),new Ke("urn:ogc:def:crs:OGC:1.3:CRS84"),new Ke("urn:ogc:def:crs:OGC:2:84"),new Ke("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Ke("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Ke("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let On={},ie={};function Fn(n,t,e){const i=n.getCode(),s=t.getCode();i in ie||(ie[i]={}),ie[i][s]=e}function Dn(n,t){let e=!0;for(let i=n.length-1;i>=0;--i)if(n[i]!=t[i]){e=!1;break}return e}function Es(n,t){const e=Math.cos(t),i=Math.sin(t),r=n[1]*e+n[0]*i;return n[0]=n[0]*e-n[1]*i,n[1]=r,n}function ho(n,t){if(t.canWrapX()){const e=_t(t.getExtent()),i=function rc(n,t,e){const i=t.getExtent();let s=0;return t.canWrapX()&&(n[0]<i[0]||n[0]>i[2])&&(e=e||_t(i),s=Math.floor((n[0]-i[0])/e)),s}(n,t,e);i&&(n[0]-=i*e)}return n}const kn=6371008.8;function Ts(n,t,e){e=e||kn;const i=Rn(n[1]),s=Rn(t[1]),r=(s-i)/2,a=Rn(t[0]-n[0])/2,l=Math.sin(r)*Math.sin(r)+Math.sin(a)*Math.sin(a)*Math.cos(i)*Math.cos(s);return 2*e*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}const Wi={info:1,warn:2,error:3,none:4};let Nn=Wi.info;function uo(...n){Nn>Wi.warn||console.warn(...n)}let ws=!0;function go(n){ws=!(void 0===n||n)}function Rs(n,t){if(void 0!==t)for(let e=0,i=n.length;e<i;++e)t[e]=n[e];else t=n.slice();return t}function fo(n,t){if(void 0!==t&&n!==t){for(let e=0,i=n.length;e<i;++e)t[e]=n[e];n=t}return n}function lc(n){(function Ql(n,t){On[n]=t})(n.getCode(),n),Fn(n,n,Rs)}function Pt(n){return"string"==typeof n?function Jl(n){return On[n]||On[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}(n):n||null}function _o(n,t,e,i){let s;const r=(n=Pt(n)).getPointResolutionFunc();if(r){if(s=r(t,e),i&&i!==n.getUnits()){const a=n.getMetersPerUnit();a&&(s=s*a/qe[i])}}else{const a=n.getUnits();if("degrees"==a&&!i||"degrees"==i)s=t;else{const l=Bi(n,Pt("EPSG:4326"));if(l===fo&&"degrees"!==a)s=t*n.getMetersPerUnit();else{let h=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];h=l(h,h,2),s=(Ts(h.slice(0,2),h.slice(2,4))+Ts(h.slice(4,6),h.slice(6,8)))/2}const c=i?qe[i]:n.getMetersPerUnit();void 0!==c&&(s/=c)}}return s}function mo(n){(function cc(n){n.forEach(lc)})(n),n.forEach(function(t){n.forEach(function(e){t!==e&&Fn(t,e,Rs)})})}function Ss(n,t){return n?"string"==typeof n?Pt(n):n:Pt(t)}function Is(n,t){return go(),Ve(n,"EPSG:4326",void 0!==t?t:"EPSG:3857")}function xi(n,t){if(n===t)return!0;const e=n.getUnits()===t.getUnits();return(n.getCode()===t.getCode()||Bi(n,t)===Rs)&&e}function Bi(n,t){let s=function $l(n,t){let e;return n in ie&&t in ie[n]&&(e=ie[n][t]),e}(n.getCode(),t.getCode());return s||(s=fo),s}function ji(n,t){return Bi(Pt(n),Pt(t))}function Ve(n,t,e){return ji(t,e)(n,void 0,n.length)}let Ot=null;function xo(){return Ot}function Ms(n,t){return n}function fe(n,t){return ws&&!Dn(n,[0,0])&&n[0]>=-180&&n[0]<=180&&n[1]>=-90&&n[1]<=90&&(ws=!1,uo("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),n}function As(n,t){return n}function He(n,t){return n}function vo(n,t,e){return function(i,s,r,a,l){if(!i)return;if(!s&&!t)return i;const c=t?0:r[0]*s,h=t?0:r[1]*s,u=l?l[0]:0,d=l?l[1]:0;let g=n[0]+c/2+u,f=n[2]-c/2+u,_=n[1]+h/2+d,m=n[3]-h/2+d;g>f&&(g=(f+g)/2,f=g),_>m&&(_=(m+_)/2,m=_);let p=Et(i[0],g,f),x=Et(i[1],_,m);if(a&&e&&s){const v=30*s;p+=-v*Math.log(1+Math.max(0,g-i[0])/v)+v*Math.log(1+Math.max(0,i[0]-f)/v),x+=-v*Math.log(1+Math.max(0,_-i[1])/v)+v*Math.log(1+Math.max(0,i[1]-m)/v)}return[p,x]}}function fc(n){return n}function Ps(n,t,e,i){const s=_t(t)/e[0],r=$t(t)/e[1];return i?Math.min(n,Math.max(s,r)):Math.min(n,Math.min(s,r))}function Ls(n,t,e){let i=Math.min(n,t);return i*=Math.log(1+50*Math.max(0,n/t-1))/50+1,e&&(i=Math.max(i,e),i/=Math.log(1+50*Math.max(0,e/n-1))/50+1),Et(i,e/2,2*t)}function Co(n,t,e,i,s){return e=void 0===e||e,function(r,a,l,c){if(void 0!==r){const h=i?Ps(n,i,l,s):n;return e&&c?Ls(r,h,t):Et(r,t,h)}}}function Os(n){if(void 0!==n)return 0}function Eo(n){if(void 0!==n)return n}function To(n){return Math.pow(n,3)}function vi(n){return 1-To(1-n)}function Fs(n){return 3*n*n-2*n*n*n}function xc(n){return n}function Je(n,t,e,i,s,r){r=r||[];let a=0;for(let l=t;l<e;l+=i){const c=n[l],h=n[l+1];r[a++]=s[0]*c+s[2]*h+s[4],r[a++]=s[1]*c+s[3]*h+s[5]}return r&&r.length!=a&&(r.length=a),r}function bo(n,t,e,i,s,r,a){a=a||[];const l=Math.cos(s),c=Math.sin(s),h=r[0],u=r[1];let d=0;for(let g=t;g<e;g+=i){const f=n[g]-h,_=n[g+1]-u;a[d++]=h+f*l-_*c,a[d++]=u+f*c+_*l;for(let m=g+2;m<g+i;++m)a[d++]=n[m]}return a&&a.length!=d&&(a.length=d),a}!function gc(){mo(ro),mo(ao),function hc(n,t,e,i){n.forEach(function(s){t.forEach(function(r){Fn(s,r,e),Fn(r,s,i)})})}(ao,ro,ql,Kl)}();const wo=[1,0,0,1,0,0],Tc=class Ec extends re{constructor(){super(),this.extent_=[1/0,1/0,-1/0,-1/0],this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=function hl(n){let e,i,s,t=!1;return function(){const r=Array.prototype.slice.call(arguments);return(!t||this!==s||!we(r,i))&&(t=!0,s=this,i=r,e=n.apply(this,arguments)),e}}(function(t,e,i){if(!i)return this.getSimplifiedGeometry(e);const s=this.clone();return s.applyTransform(i),s.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return ot()}closestPointXY(t,e,i,s){return ot()}containsXY(t,e){const i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e}getClosestPoint(t,e){return this.closestPointXY(t[0],t[1],e=e||[NaN,NaN],1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return ot()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Be(e),this.extentRevision_=this.getRevision()}return function Ll(n,t){return t?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t):n}(this.extent_,t)}rotate(t,e){ot()}scale(t,e,i){ot()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return ot()}getType(){return ot()}applyTransform(t){ot()}intersectsExtent(t){return ot()}translate(t,e){ot()}transform(t,e){const i=Pt(t),s="tile-pixels"==i.getUnits()?function(r,a,l){const c=i.getExtent(),h=i.getWorldExtent(),u=$t(h)/$t(c);return de(wo,h[0],h[3],u,-u,0,0,0),Je(r,0,r.length,l,wo,a),ji(i,e)(r,a,l)}:ji(i,e);return this.applyTransform(s),this}};function Ro(n){let t;return"XY"==n?t=2:"XYZ"==n||"XYM"==n?t=3:"XYZM"==n&&(t=4),t}const Ds=class bc extends Tc{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(t){return function Sl(n,t,e,i,s){return qr(Be(s),n,t,e,i)}(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return ot()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Ro(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){ot()}setLayout(t,e,i){let s;if(t)s=Ro(t);else{for(let r=0;r<i;++r){if(0===e.length)return this.layout="XY",void(this.stride=2);e=e[0]}s=e.length,t=function wc(n){let t;return 2==n?t="XY":3==n?t="XYZ":4==n&&(t="XYZM"),t}(s)}this.layout=t,this.stride=s}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const s=this.getStride();bo(i,0,i.length,s,t,e,i),this.changed()}}scale(t,e,i){void 0===e&&(e=t),i||(i=gi(this.getExtent()));const s=this.getFlatCoordinates();if(s){const r=this.getStride();(function vc(n,t,e,i,s,r,a,l){l=l||[];const c=a[0],h=a[1];let u=0;for(let d=t;d<e;d+=i){const f=n[d+1]-h;l[u++]=c+s*(n[d]-c),l[u++]=h+r*f;for(let _=d+2;_<d+i;++_)l[u++]=n[_]}l&&l.length!=u&&(l.length=u)})(s,0,s.length,r,t,e,i,s),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const s=this.getStride();(function Cc(n,t,e,i,s,r,a){a=a||[];let l=0;for(let c=t;c<e;c+=i){a[l++]=n[c]+s,a[l++]=n[c+1]+r;for(let h=c+2;h<c+i;++h)a[l++]=n[h]}a&&a.length!=l&&(a.length=l)})(i,0,i.length,s,t,e,i),this.changed()}}};function So(n,t,e,i,s,r,a){const l=n[t],c=n[t+1],h=n[e]-l,u=n[e+1]-c;let d;if(0===h&&0===u)d=t;else{const g=((s-l)*h+(r-c)*u)/(h*h+u*u);if(g>1)d=e;else{if(g>0){for(let f=0;f<i;++f)a[f]=te(n[t+f],n[e+f],g);return void(a.length=i)}d=t}}for(let g=0;g<i;++g)a[g]=n[d+g];a.length=i}function Io(n,t,e,i,s){let r=n[t],a=n[t+1];for(t+=i;t<e;t+=i){const l=n[t],c=n[t+1],h=_i(r,a,l,c);h>s&&(s=h),r=l,a=c}return s}function Ao(n,t,e,i,s,r,a,l,c,h,u){if(t==e)return h;let d,g;if(0===s){if(g=_i(a,l,n[t],n[t+1]),g<h){for(d=0;d<i;++d)c[d]=n[t+d];return c.length=i,g}return h}u=u||[NaN,NaN];let f=t+i;for(;f<e;)if(So(n,f-i,f,i,a,l,u),g=_i(a,l,u[0],u[1]),g<h){for(h=g,d=0;d<i;++d)c[d]=u[d];c.length=i,f+=i}else f+=i*Math.max((Math.sqrt(g)-Math.sqrt(h))/s|0,1);if(r&&(So(n,e-i,t,i,a,l,u),g=_i(a,l,u[0],u[1]),g<h)){for(h=g,d=0;d<i;++d)c[d]=u[d];c.length=i}return h}function Lo(n,t,e,i){for(let s=0,r=e.length;s<r;++s){const a=e[s];for(let l=0;l<i;++l)n[t++]=a[l]}return t}function Qe(n,t){return t*Math.round(n/t)}function Ac(n,t,e,i,s,r,a){if(t==e)return a;let h,u,l=Qe(n[t],s),c=Qe(n[t+1],s);t+=i,r[a++]=l,r[a++]=c;do{if(h=Qe(n[t],s),u=Qe(n[t+1],s),(t+=i)==e)return r[a++]=h,r[a++]=u,a}while(h==l&&u==c);for(;t<e;){const d=Qe(n[t],s),g=Qe(n[t+1],s);if(t+=i,d==h&&g==u)continue;const f=h-l,_=u-c,m=d-l,p=g-c;f*p==_*m&&(f<0&&m<f||f==m||f>0&&m>f)&&(_<0&&p<_||_==p||_>0&&p>_)?(h=d,u=g):(r[a++]=h,r[a++]=u,l=h,c=u,h=d,u=g)}return r[a++]=h,r[a++]=u,a}function Ci(n,t,e,i,s){s=void 0!==s?s:[];let r=0;for(let a=t;a<e;a+=i)s[r++]=n.slice(a,a+i);return s.length=r,s}function Gn(n,t,e,i,s){s=void 0!==s?s:[];let r=0;for(let a=0,l=e.length;a<l;++a){const c=e[a];s[r++]=Ci(n,t,c,i,s[r]),t=c}return s.length=r,s}function Do(n,t,e,i,s){s=void 0!==s?s:[];let r=0;for(let a=0,l=e.length;a<l;++a){const c=e[a];s[r++]=1===c.length&&c[0]===t?[]:Gn(n,t,c,i,s[r]),t=c[c.length-1]}return s.length=r,s}function ko(n,t,e,i){let s=0,r=n[e-i],a=n[e-i+1];for(;t<e;t+=i){const l=n[t],c=n[t+1];s+=a*l-r*c,r=l,a=c}return s/2}class Un extends Ds{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}clone(){return new Un(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,s){return s<Wr(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Io(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ao(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,s))}getArea(){return ko(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Ci(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=function ks(n,t,e,i,s,r,a){const l=(e-t)/i;if(l<3){for(;t<e;t+=i)r[a++]=n[t],r[a++]=n[t+1];return a}const c=new Array(l);c[0]=1,c[l-1]=1;const h=[t,e-i];let u=0;for(;h.length>0;){const d=h.pop(),g=h.pop();let f=0;const _=n[g],m=n[g+1],p=n[d],x=n[d+1];for(let v=g+i;v<d;v+=i){const b=kl(n[v],n[v+1],_,m,p,x);b>f&&(u=v,f=b)}f>s&&(c[(u-t)/i]=1,g+i<u&&h.push(g,u),u+i<d&&h.push(u,d))}for(let d=0;d<l;++d)c[d]&&(r[a++]=n[t+d*i],r[a++]=n[t+d*i+1]);return a}(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Un(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Lo(this.flatCoordinates,0,t,this.stride),this.changed()}}const No=Un;class Zs extends Ds{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Zs(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){const r=this.flatCoordinates,a=_i(t,e,r[0],r[1]);if(a<s){const l=this.stride;for(let c=0;c<l;++c)i[c]=r[c];return i.length=l,a}return s}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(t){return function Rl(n,t){const e=n[0],i=n[1];return ge(e,i,e,i,t)}(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return Br(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=function Sc(n,t,e,i){for(let s=0,r=e.length;s<r;++s)n[t++]=e[s];return t}(this.flatCoordinates,0,t),this.changed()}}const zn=Zs;function Pc(n,t,e,i,s){return!Kr(s,function(a){return!$e(n,t,e,i,a[0],a[1])})}function $e(n,t,e,i,s,r){let a=0,l=n[e-i],c=n[e-i+1];for(;t<e;t+=i){const h=n[t],u=n[t+1];c<=r?u>r&&(h-l)*(r-c)-(s-l)*(u-c)>0&&a++:u<=r&&(h-l)*(r-c)-(s-l)*(u-c)<0&&a--,l=h,c=u}return 0!==a}function Ns(n,t,e,i,s,r){if(0===e.length||!$e(n,t,e[0],i,s,r))return!1;for(let a=1,l=e.length;a<l;++a)if($e(n,e[a-1],e[a],i,s,r))return!1;return!0}function Gs(n,t,e,i,s){const r=qr([1/0,1/0,-1/0,-1/0],n,t,e,i);return!!Nt(s,r)&&(!!(ui(s,r)||r[0]>=s[0]&&r[2]<=s[2]||r[1]>=s[1]&&r[3]<=s[3])||function Lc(n,t,e,i,s){let r;for(t+=i;t<e;t+=i)if(r=s(n.slice(t-i,t),n.slice(t,t+i)),r)return r;return!1}(n,t,e,i,function(a,l){return function Ol(n,t,e){let i=!1;const s=ys(n,t),r=ys(n,e);if(s===St.INTERSECTING||r===St.INTERSECTING)i=!0;else{const a=n[0],l=n[1],c=n[2],h=n[3],g=e[0],f=e[1],_=(f-t[1])/(g-t[0]);let m,p;r&St.ABOVE&&!(s&St.ABOVE)&&(m=g-(f-h)/_,i=m>=a&&m<=c),!i&&r&St.RIGHT&&!(s&St.RIGHT)&&(p=f-(g-c)*_,i=p>=l&&p<=h),!i&&r&St.BELOW&&!(s&St.BELOW)&&(m=g-(f-l)/_,i=m>=a&&m<=c),!i&&r&St.LEFT&&!(s&St.LEFT)&&(p=f-(g-a)*_,i=p>=l&&p<=h)}return i}(s,a,l)}))}function Uo(n,t,e,i,s){return!!(Gs(n,t,e,i,s)||$e(n,t,e,i,s[0],s[1])||$e(n,t,e,i,s[0],s[3])||$e(n,t,e,i,s[2],s[1])||$e(n,t,e,i,s[2],s[3]))}function Oc(n,t,e,i){for(;t<e-i;){for(let s=0;s<i;++s){const r=n[t+s];n[t+s]=n[e-i+s],n[e-i+s]=r}t+=i,e-=i}}function Us(n,t,e,i){let s=0,r=n[e-i],a=n[e-i+1];for(;t<e;t+=i){const l=n[t],c=n[t+1];s+=(l-r)*(c+a),r=l,a=c}return 0===s?void 0:s>0}function zs(n,t,e,i,s){s=void 0!==s&&s;for(let r=0,a=e.length;r<a;++r){const l=e[r],c=Us(n,t,l,i);(0===r?s&&c||!s&&!c:s&&!c||!s&&c)&&Oc(n,t,l,i),t=l}return t}class ti extends Ds{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==e&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?Fr(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new ti(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<Wr(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function Mo(n,t,e,i,s){for(let r=0,a=e.length;r<a;++r){const l=e[r];s=Io(n,t,l,i,s),t=l}return s}(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function Po(n,t,e,i,s,r,a,l,c,h,u){u=u||[NaN,NaN];for(let d=0,g=e.length;d<g;++d){const f=e[d];h=Ao(n,t,f,i,s,r,a,l,c,h,u),t=f}return h}(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,s))}containsXY(t,e){return Ns(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return function Zo(n,t,e,i){let s=0;for(let r=0,a=e.length;r<a;++r){const l=e[r];s+=ko(n,t,l,i),t=l}return s}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),zs(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Gn(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=gi(this.getExtent());this.flatInteriorPoint_=function Go(n,t,e,i,s,r,a){let l,c,h,u,d,g,f;const _=s[r+1],m=[];for(let v=0,E=e.length;v<E;++v){const T=e[v];for(u=n[T-i],g=n[T-i+1],l=t;l<T;l+=i)d=n[l],f=n[l+1],(_<=g&&f<=_||g<=_&&_<=f)&&(h=(_-g)/(f-g)*(d-u)+u,m.push(h)),u=d,g=f}let p=NaN,x=-1/0;for(m.sort(We),u=m[0],l=1,c=m.length;l<c;++l){d=m[l];const v=Math.abs(d-u);v>x&&(h=(u+d)/2,Ns(n,t,e,i,h,_)&&(p=h,x=v)),u=d}return isNaN(p)&&(p=s[r]),a?(a.push(p,_,x),a):[p,_,x]}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new zn(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new No(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,i=this.ends_,s=[];let r=0;for(let a=0,l=i.length;a<l;++a){const c=i[a],h=new No(e.slice(r,c),t);s.push(h),r=c}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;!function Yo(n,t,e,i,s){s=void 0!==s&&s;for(let r=0,a=e.length;r<a;++r){const l=e[r],c=Us(n,t,l,i);if(0===r){if(s&&c||!s&&!c)return!1}else if(s&&!c||!s&&c)return!1;t=l}return!0}(t,0,this.ends_,this.stride)?(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=zs(this.orientedFlatCoordinates_,0,this.ends_,this.stride)):this.orientedFlatCoordinates_=t,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=function Fo(n,t,e,i,s,r,a,l){for(let c=0,h=e.length;c<h;++c){const u=e[c];a=Ac(n,t,u,i,s,r,a),l.push(a),t=u}return a}(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new ti(e,"XY",i)}getType(){return"Polygon"}intersectsExtent(t){return function zo(n,t,e,i,s){if(!Uo(n,t,e[0],i,s))return!1;if(1===e.length)return!0;for(let r=1,a=e.length;r<a;++r)if(Pc(n,e[r-1],e[r],i,s)&&!Gs(n,e[r-1],e[r],i,s))return!1;return!0}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=function Oo(n,t,e,i,s){s=s||[];let r=0;for(let a=0,l=e.length;a<l;++a){const c=Lo(n,t,e[a],i);s[r++]=c,t=c}return s.length=r,s}(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()}}const Fc=ti;function Xo(n){const t=n[0],e=n[1],i=n[2],s=n[3],r=[t,e,t,s,i,s,i,e,t,e];return new ti(r,"XY",[r.length])}function Yn(n,t){setTimeout(function(){n(t)},0)}function Xs(n,t,e,i,s){const r=Math.cos(-s);let a=Math.sin(-s),l=n[0]*r-n[1]*a,c=n[1]*r+n[0]*a;return l+=(t[0]/2-e[0])*i,c+=(e[1]-t[1]/2)*i,a=-a,[l*r-c*a,c*r+l*a]}const ae=class kc extends re{constructor(t){super(),t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.projection_=Ss(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.nextCenter_=null,this.cancelAnchor_=void 0,t.projection&&go(),t.center&&(t.center=fe(t.center)),t.extent&&(t.extent=He(t.extent)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const l in ee)delete e[l];this.setProperties(e,!0);const i=function Nc(n){let t,e,i,a=void 0!==n.minZoom?n.minZoom:0,l=void 0!==n.maxZoom?n.maxZoom:28;const c=void 0!==n.zoomFactor?n.zoomFactor:2,h=void 0!==n.multiWorld&&n.multiWorld,u=void 0===n.smoothResolutionConstraint||n.smoothResolutionConstraint,d=void 0!==n.showFullExtent&&n.showFullExtent,g=Ss(n.projection,"EPSG:3857"),f=g.getExtent();let _=n.constrainOnlyCenter,m=n.extent;if(!h&&!m&&g.isGlobal()&&(_=!1,m=f),void 0!==n.resolutions){const p=n.resolutions;e=p[a],i=void 0!==p[l]?p[l]:p[p.length-1],t=n.constrainResolution?function _c(n,t,e,i){return t=void 0===t||t,function(s,r,a,l){if(void 0!==s){const c=n[0],h=n[n.length-1],u=e?Ps(c,e,a,i):c;if(l)return t?Ls(s,u,h):Et(s,h,u);const d=Math.min(u,s),g=Math.floor(ds(n,d,r));return n[g]>u&&g<n.length-1?n[g+1]:n[g]}}}(p,u,!_&&m,d):Co(e,i,u,!_&&m,d)}else{const x=(f?Math.max(_t(f),$t(f)):360*qe.degrees/g.getMetersPerUnit())/Cs/Math.pow(2,0),v=x/Math.pow(2,28);e=n.maxResolution,void 0!==e?a=0:e=x/Math.pow(c,a),i=n.minResolution,void 0===i&&(i=void 0!==n.maxZoom?void 0!==n.maxResolution?e/Math.pow(c,l):x/Math.pow(c,l):v),l=a+Math.floor(Math.log(e/i)/Math.log(c)),i=e/Math.pow(c,l-a),t=n.constrainResolution?function mc(n,t,e,i,s,r){return i=void 0===i||i,e=void 0!==e?e:0,function(a,l,c,h){if(void 0!==a){const u=s?Ps(t,s,c,r):t;if(h)return i?Ls(a,u,e):Et(a,e,u);const d=1e-9,g=Math.ceil(Math.log(t/u)/Math.log(n)-d),f=-l*(.5-d)+.5,_=Math.min(u,a),m=Math.floor(Math.log(t/_)/Math.log(n)+f),p=Math.max(g,m);return Et(t/Math.pow(n,p),e,u)}}}(c,e,i,u,!_&&m,d):Co(e,i,u,!_&&m,d)}return{constraint:t,maxResolution:e,minResolution:i,minZoom:a,zoomFactor:c}}(t);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=i.minZoom;const s=function Zc(n){if(void 0!==n.extent)return vo(n.extent,n.constrainOnlyCenter,void 0===n.smoothExtentConstraint||n.smoothExtentConstraint);const t=Ss(n.projection,"EPSG:3857");if(!0!==n.multiWorld&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,vo(e,!1,!1)}return fc}(t),r=i.constraint,a=function Gc(n){if(void 0===n.enableRotation||n.enableRotation){const e=n.constrainRotation;return void 0===e||!0===e?function yc(n){return n=n||Rn(5),function(t,e){return e?t:void 0!==t?Math.abs(t)<=n?0:t:void 0}}():!1===e?Eo:"number"==typeof e?function pc(n){const t=2*Math.PI/n;return function(e,i){return i?e:void 0!==e?e=Math.floor(e/t+.5)*t:void 0}}(e):Eo}return Os}(t);this.constraints_={center:s,resolution:r,rotation:a},this.setRotation(void 0!==t.rotation?t.rotation:0),this.setCenterInternal(void 0!==t.center?t.center:null),void 0!==t.resolution?this.setResolution(t.resolution):void 0!==t.zoom&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const i=this.getCenterInternal();if(i){const s=t||[0,0,0,0];e=e||[0,0,0,0];const r=this.getResolution();this.setCenterInternal([i[0]+r/2*(s[3]-e[3]+e[1]-s[1]),i[1]-r/2*(s[0]-e[0]+e[2]-s[2])])}}getUpdatedOptions_(t){const e=this.getProperties();return void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let i=0;i<e.length;++i){let s=arguments[i];s.center&&(s=Object.assign({},s),s.center=fe(s.center,this.getProjection())),s.anchor&&(s=Object.assign({},s),s.anchor=fe(s.anchor,this.getProjection())),e[i]=s}this.animateInternal.apply(this,e)}animateInternal(t){let i,e=arguments.length;e>1&&"function"==typeof arguments[e-1]&&(i=arguments[e-1],--e);let s=0;for(;s<e&&!this.isDef();++s){const u=arguments[s];u.center&&this.setCenterInternal(u.center),void 0!==u.zoom?this.setZoom(u.zoom):u.resolution&&this.setResolution(u.resolution),void 0!==u.rotation&&this.setRotation(u.rotation)}if(s===e)return void(i&&Yn(i,!0));let r=Date.now(),a=this.targetCenter_.slice(),l=this.targetResolution_,c=this.targetRotation_;const h=[];for(;s<e;++s){const u=arguments[s],d={start:r,complete:!1,anchor:u.anchor,duration:void 0!==u.duration?u.duration:1e3,easing:u.easing||Fs,callback:i};if(u.center&&(d.sourceCenter=a,d.targetCenter=u.center.slice(),a=d.targetCenter),void 0!==u.zoom?(d.sourceResolution=l,d.targetResolution=this.getResolutionForZoom(u.zoom),l=d.targetResolution):u.resolution&&(d.sourceResolution=l,d.targetResolution=u.resolution,l=d.targetResolution),void 0!==u.rotation){d.sourceRotation=c;const g=mi(u.rotation-c+Math.PI,2*Math.PI)-Math.PI;d.targetRotation=c+g,c=d.targetRotation}(n=d).sourceCenter&&n.targetCenter&&!Dn(n.sourceCenter,n.targetCenter)||n.sourceResolution!==n.targetResolution||n.sourceRotation!==n.targetRotation?r+=d.duration:d.complete=!0,h.push(d)}var n;this.animations_.push(h),this.setHint(0,1),this.updateAnimations_()}getAnimating(){return this.hints_[0]>0}getInteracting(){return this.hints_[1]>0}cancelAnimations(){let t;this.setHint(0,-this.hints_[0]);for(let e=0,i=this.animations_.length;e<i;++e){const s=this.animations_[e];if(s[0].callback&&Yn(s[0].callback,!1),!t)for(let r=0,a=s.length;r<a;++r){const l=s[r];if(!l.complete){t=l.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let i=this.animations_.length-1;i>=0;--i){const s=this.animations_[i];let r=!0;for(let a=0,l=s.length;a<l;++a){const c=s[a];if(c.complete)continue;let u=c.duration>0?(t-c.start)/c.duration:1;u>=1?(c.complete=!0,u=1):r=!1;const d=c.easing(u);if(c.sourceCenter){const g=c.sourceCenter[0],f=c.sourceCenter[1],_=c.targetCenter[0],m=c.targetCenter[1];this.nextCenter_=c.targetCenter,this.targetCenter_=[g+d*(_-g),f+d*(m-f)]}if(c.sourceResolution&&c.targetResolution){const g=1===d?c.targetResolution:c.sourceResolution+d*(c.targetResolution-c.sourceResolution);if(c.anchor){const f=this.getViewportSize_(this.getRotation()),_=this.constraints_.resolution(g,0,f,!0);this.targetCenter_=this.calculateCenterZoom(_,c.anchor)}this.nextResolution_=c.targetResolution,this.targetResolution_=g,this.applyTargetState_(!0)}if(void 0!==c.sourceRotation&&void 0!==c.targetRotation){const g=1===d?mi(c.targetRotation+Math.PI,2*Math.PI)-Math.PI:c.sourceRotation+d*(c.targetRotation-c.sourceRotation);if(c.anchor){const f=this.constraints_.rotation(g,!0);this.targetCenter_=this.calculateCenterRotate(f,c.anchor)}this.nextRotation_=c.targetRotation,this.targetRotation_=g}if(this.applyTargetState_(!0),e=!0,!c.complete)break}if(r){this.animations_[i]=null,this.setHint(0,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const a=s[0].callback;a&&Yn(a,!0)}}this.animations_=this.animations_.filter(Boolean),e&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let i;const s=this.getCenterInternal();return void 0!==s&&(i=[s[0]-e[0],s[1]-e[1]],Es(i,t-this.getRotation()),function tc(n,t){n[0]+=+t[0],n[1]+=+t[1]}(i,e)),i}calculateCenterZoom(t,e){let i;const s=this.getCenterInternal(),r=this.getResolution();return void 0!==s&&void 0!==r&&(i=[e[0]-t*(e[0]-s[0])/r,e[1]-t*(e[1]-s[1])/r]),i}getViewportSize_(t){const e=this.viewportSize_;if(t){const i=e[0],s=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(s*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(s*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&Ms(t,this.getProjection())}getCenterInternal(){return this.get(ee.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){return As(this.calculateExtentInternal(t),this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();tt(e,1);const i=this.getResolution();tt(void 0!==i,2);const s=this.getRotation();return tt(void 0!==s,3),xs(e,i,s,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(ee.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(He(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const i=_t(t)/e[0],s=$t(t)/e[1];return Math.max(i,s)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),s=Math.log(e/this.minResolution_)/Math.log(t);return function(r){return e/Math.pow(t,r*s)}}getRotation(){return this.get(ee.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),r=Math.log(i/this.minResolution_)/e;return function(a){return Math.log(i/a)/e/r}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),i=this.getRotation();let s=this.getCenterInternal();const r=this.padding_;if(r){const a=this.getViewportSizeMinusPadding_();s=Xs(s,this.getViewportSize_(),[a[0]/2+r[3],a[1]/2+r[0]],e,i)}return{center:s.slice(0),projection:void 0!==t?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return void 0!==e&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let i,s,e=this.minZoom_||0;if(this.resolutions_){const r=ds(this.resolutions_,t,1);e=r,i=this.resolutions_[r],s=r==this.resolutions_.length-1?2:i/this.resolutions_[r+1]}else i=this.maxResolution_,s=this.zoomFactor_;return e+Math.log(i/t)/Math.log(s)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=Et(Math.floor(t),0,this.resolutions_.length-2);return this.resolutions_[e]/Math.pow(this.resolutions_[e]/this.resolutions_[e+1],Et(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let i;if(tt(Array.isArray(t)||"function"==typeof t.getSimplifiedGeometry,24),Array.isArray(t))tt(!wn(t),25),i=Xo(He(t,this.getProjection()));else if("Circle"===t.getType()){const s=He(t.getExtent(),this.getProjection());i=Xo(s),i.rotate(this.getRotation(),gi(s))}else{const s=xo();i=s?t.clone().transform(s,this.getProjection()):t}this.fitInternal(i,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),i=Math.cos(e),s=Math.sin(-e),r=t.getFlatCoordinates(),a=t.getStride();let l=1/0,c=1/0,h=-1/0,u=-1/0;for(let d=0,g=r.length;d<g;d+=a){const f=r[d]*i-r[d+1]*s,_=r[d]*s+r[d+1]*i;l=Math.min(l,f),c=Math.min(c,_),h=Math.max(h,f),u=Math.max(u,_)}return[l,c,h,u]}fitInternal(t,e){let i=(e=e||{}).size;i||(i=this.getViewportSizeMinusPadding_());const s=void 0!==e.padding?e.padding:[0,0,0,0],r=void 0!==e.nearest&&e.nearest;let a;a=void 0!==e.minResolution?e.minResolution:void 0!==e.maxZoom?this.getResolutionForZoom(e.maxZoom):0;const l=this.rotatedExtentForGeometry(t);let c=this.getResolutionForExtentInternal(l,[i[0]-s[1]-s[3],i[1]-s[0]-s[2]]);c=isNaN(c)?a:Math.max(c,a),c=this.getConstrainedResolution(c,r?0:1);const h=this.getRotation(),u=Math.sin(h),d=Math.cos(h),g=gi(l);g[0]+=(s[1]-s[3])/2*c,g[1]+=(s[0]-s[2])/2*c;const m=this.getConstrainedCenter([g[0]*d-g[1]*u,g[1]*d+g[0]*u],c),p=e.callback?e.callback:hi;void 0!==e.duration?this.animateInternal({resolution:c,center:m,duration:e.duration,easing:e.easing},p):(this.targetResolution_=c,this.targetCenter_=m,this.applyTargetState_(!1,!0),Yn(p,!0))}centerOn(t,e,i){this.centerOnInternal(fe(t,this.getProjection()),e,i)}centerOnInternal(t,e,i){this.setCenterInternal(Xs(t,e,i,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,i,s){let r;const a=this.padding_;if(a&&t){const l=this.getViewportSizeMinusPadding_(-i),c=Xs(t,s,[l[0]/2+a[3],l[1]/2+a[0]],e,i);r=[t[0]-c[0],t[1]-c[1]]}return r}isDef(){return!!this.getCenterInternal()&&void 0!==this.getResolution()}adjustCenter(t){const e=Ms(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&fe(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const i=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*t,0,s,i);e&&(this.targetCenter_=this.calculateCenterZoom(r,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=fe(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const i=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(s,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&fe(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const i=this.getAnimating()||this.getInteracting()||e,s=this.constraints_.rotation(this.targetRotation_,i),r=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,0,r,i),l=this.constraints_.center(this.targetCenter_,a,r,i,this.calculateCenterShift(this.targetCenter_,a,s,r));this.get(ee.ROTATION)!==s&&this.set(ee.ROTATION,s),this.get(ee.RESOLUTION)!==a&&(this.set(ee.RESOLUTION,a),this.set("zoom",this.getZoom(),!0)),(!l||!this.get(ee.CENTER)||!Dn(this.get(ee.CENTER),l))&&this.set(ee.CENTER,l),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,i){t=void 0!==t?t:200;const s=e||0,r=this.constraints_.rotation(this.targetRotation_),a=this.getViewportSize_(r),l=this.constraints_.resolution(this.targetResolution_,s,a),c=this.constraints_.center(this.targetCenter_,l,a,!1,this.calculateCenterShift(this.targetCenter_,l,r,a));if(0===t&&!this.cancelAnchor_)return this.targetResolution_=l,this.targetRotation_=r,this.targetCenter_=c,void this.applyTargetState_();i=i||(0===t?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==l||this.getRotation()!==r||!this.getCenterInternal()||!Dn(this.getCenterInternal(),c))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:c,resolution:l,duration:t,easing:vi,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(1,1)}endInteraction(t,e,i){i=i&&fe(i,this.getProjection()),this.endInteractionInternal(t,e,i)}endInteractionInternal(t,e,i){this.getInteracting()&&(this.setHint(1,-1),this.resolveConstraints(t,e,i))}getConstrainedCenter(t,e){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){const i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))}getConstrainedResolution(t,e){e=e||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,i)}};function Ws(n,t){if(!n.visible)return!1;const e=t.resolution;if(e<n.minResolution||e>=n.maxResolution)return!1;const i=t.zoom;return i>n.minZoom&&i<=n.maxZoom}const Xn=class zc extends no{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener("source",this.handleSourcePropertyChange_),this.setSource(t.source?t.source:null)}getLayersArray(t){return(t=t||[]).push(this),t}getLayerStatesArray(t){return(t=t||[]).push(this.getLayerState()),t}getSource(){return this.get("source")||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!this.sourceReady_&&"ready"===this.getSource().getState()&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(pt(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=rt(t,V.CHANGE,this.handleSourceChange_,this),"ready"===t.getState()&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return this.renderer_&&this.rendered?this.renderer_.getData(t):null}isVisible(t){let e;const i=this.getMapInternal();let s;!t&&i&&(t=i.getView()),e=t instanceof ae?{viewState:t.getState(),extent:t.calculateExtent()}:t,!e.layerStatesArray&&i&&(e.layerStatesArray=i.getLayerGroup().getLayerStatesArray()),s=e.layerStatesArray?e.layerStatesArray.find(a=>a.layer===this):this.getLayerState();const r=this.getExtent();return Ws(s,e.viewState)&&(!r||Nt(r,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];let e;const i=this.getSource();if(i&&(e=i.getAttributions()),!e)return[];let r=e(t instanceof ae?t.getViewStateAndExtent():t);return Array.isArray(r)||(r=[r]),r}render(t,e){const i=this.getRenderer();return i.prepareFrame(t)?(this.rendered=!0,i.renderFrame(t,e)):null}unrender(){this.rendered=!1}setMapInternal(t){t||this.unrender(),this.set("map",t)}getMapInternal(){return this.get("map")}setMap(t){this.mapPrecomposeKey_&&(pt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(pt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=rt(t,"precompose",function(e){const s=e.frameState.layerStatesArray,r=this.getLayerState(!1);tt(!s.some(function(a){return a.layer===r.layer}),67),s.push(r)},this),this.mapRenderKey_=rt(this,V.CHANGE,t.render,t),this.changed())}setSource(t){this.set("source",t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}};function Xc(n,t){Pn.expire()}const Wc=class Yc extends us{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){ot()}calculateMatrices2D(t){const e=t.viewState,i=t.coordinateToPixelTransform,s=t.pixelToCoordinateTransform;de(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),xn(s,i)}forEachFeatureAtCoordinate(t,e,i,s,r,a,l,c){let h;const u=e.viewState;function d(T,b,R,P){return r.call(a,b,T?R:null,P)}const g=u.projection,f=ho(t.slice(),g),_=[[0,0]];if(g.canWrapX()&&s){const b=_t(g.getExtent());_.push([-b,0],[b,0])}const m=e.layerStatesArray,p=m.length,x=[],v=[];for(let T=0;T<_.length;T++)for(let b=p-1;b>=0;--b){const R=m[b],P=R.layer;if(P.hasRenderer()&&Ws(R,u)&&l.call(c,P)){const I=P.getRenderer(),z=P.getSource();if(I&&z){const X=z.getWrapX()?f:t,at=d.bind(null,R.managed);v[0]=X[0]+_[T][0],v[1]=X[1]+_[T][1],h=I.forEachFeatureAtCoordinate(v,e,i,at,x)}if(h)return h}}if(0===x.length)return;const E=1/x.length;return x.forEach((T,b)=>T.distanceSq+=b*E),x.sort((T,b)=>T.distanceSq-b.distanceSq),x.some(T=>h=T.callback(T.feature,T.layer,T.geometry)),h}hasFeatureAtCoordinate(t,e,i,s,r,a){return void 0!==this.forEachFeatureAtCoordinate(t,e,i,s,Ni,this,r,a)}getMap(){return this.map_}renderFrame(t){ot()}scheduleExpireIconCache(t){Pn.canExpireCache()&&t.postRenderFunctions.push(Xc)}},Wo=class Bc extends ue{constructor(t,e,i,s){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=s}},Wn="ol-hidden",Bn="ol-unselectable",Bs="ol-control",Bo="ol-collapsed",jc=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),jo=["style","variant","weight","size","lineHeight","family"],qo=function(n){const t=n.match(jc);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,s=jo.length;i<s;++i){const r=t[i+1];void 0!==r&&(e[jo[i]]=r)}return e.families=e.family.split(/,\s?/),e};function Ft(n,t,e,i){let s;return s=e&&e.length?e.shift():gs?new OffscreenCanvas(n||300,t||300):document.createElement("canvas"),n&&(s.width=n),t&&(s.height=t),s.getContext("2d",i)}function jn(n){const t=n.canvas;t.width=1,t.height=1,n.clearRect(0,0,1,1)}function Ko(n,t){const e=t.parentNode;e&&e.replaceChild(n,t)}function js(n){return n&&n.parentNode?n.parentNode.removeChild(n):null}const Vo="10px sans-serif",_e="#000",qn="round",qi=[],Ei="round",Hi="#000",Ji="center",Kn="middle",ei=[0,0,0,0],me=new re;let qs,Ti=null;const Ks={},Vc=function(){const t="32px ",e=["monospace","serif"],i=e.length,s="wmytzilWMYTZIL@#/&?$%10\uf013";let r,a;function l(h,u,d){let g=!0;for(let f=0;f<i;++f){const _=e[f];if(a=Vn(h+" "+u+" "+t+_,s),d!=_){const m=Vn(h+" "+u+" "+t+d+","+_,s);g=g&&m!=a}}return!!g}function c(){let h=!0;const u=me.getKeys();for(let d=0,g=u.length;d<g;++d){const f=u[d];me.get(f)<100&&(l.apply(this,f.split("\n"))?(Gi(Ks),Ti=null,qs=void 0,me.set(f,100)):(me.set(f,me.get(f)+1,!0),h=!1))}h&&(clearInterval(r),r=void 0)}return function(h){const u=qo(h);if(!u)return;const d=u.families;for(let g=0,f=d.length;g<f;++g){const _=d[g],m=u.style+"\n"+u.weight+"\n"+_;void 0===me.get(m)&&(me.set(m,100,!0),l(u.style,u.weight,_)||(me.set(m,0,!0),void 0===r&&(r=setInterval(c,32))))}}}(),Hc=function(){let n;return function(t){let e=Ks[t];if(null==e){if(gs){const i=qo(t),s=Ho(t,"\u017dg");e=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else n||(n=document.createElement("div"),n.innerHTML="M",n.style.minHeight="0",n.style.maxHeight="none",n.style.height="auto",n.style.padding="0",n.style.border="none",n.style.position="absolute",n.style.display="block",n.style.left="-99999px"),n.style.font=t,document.body.appendChild(n),e=n.offsetHeight,document.body.removeChild(n);Ks[t]=e}return e}}();function Ho(n,t){return Ti||(Ti=Ft(1,1)),n!=qs&&(Ti.font=n,qs=Ti.font),Ti.measureText(t)}function Vn(n,t){return Ho(n,t).width}function Jo(n,t,e){if(t in e)return e[t];const i=t.split("\n").reduce((s,r)=>Math.max(s,Vn(n,r)),0);return e[t]=i,i}const eh=class th extends Wc{constructor(t){super(t),this.fontChangeListenerKey_=rt(me,"propertychange",t.redrawText.bind(t)),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=Bn+" ol-layers";const i=t.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const i=this.getMap();if(i.hasListener(t)){const s=new Wo(t,void 0,e);i.dispatchEvent(s)}}disposeInternal(){pt(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t)return void(this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1));this.calculateMatrices2D(t),this.dispatchRenderEvent("precompose",t);const e=t.layerStatesArray.sort(function(a,l){return a.zIndex-l.zIndex}),i=t.viewState;this.children_.length=0;const s=[];let r=null;for(let a=0,l=e.length;a<l;++a){const c=e[a];t.layerIndex=a;const h=c.layer,u=h.getSourceState();if(!Ws(c,i)||"ready"!=u&&"undefined"!=u){h.unrender();continue}const d=h.render(t,r);d&&(d!==r&&(this.children_.push(d),r=d),"getDeclutter"in h&&s.push(h))}for(let a=s.length-1;a>=0;--a)s[a].renderDeclutter(t);(function Kc(n,t){const e=n.childNodes;for(let i=0;;++i){const s=e[i],r=t[i];if(!s&&!r)break;if(s!==r){if(!s){n.appendChild(r);continue}if(!r){n.removeChild(s),--i;continue}n.insertBefore(r,s)}}})(this.element_,this.children_),this.dispatchRenderEvent("postcompose",t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}};class Ie extends ue{constructor(t,e){super(t),this.layer=e}}class Hs extends no{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let i=t.layers;super(e),this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener("layers",this.handleLayersChanged_),i?Array.isArray(i)?i=new oe(i.slice(),{unique:!0}):tt("function"==typeof i.getArray,43):i=new oe(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(pt),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(rt(t,"add",this.handleLayersAdd_,this),rt(t,"remove",this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(pt);Gi(this.listenerKeys_);const e=t.getArray();for(let i=0,s=e.length;i<s;i++){const r=e[i];this.registerLayerListeners_(r),this.dispatchEvent(new Ie("addlayer",r))}this.changed()}registerLayerListeners_(t){const e=[rt(t,"propertychange",this.handleLayerChange_,this),rt(t,V.CHANGE,this.handleLayerChange_,this)];t instanceof Hs&&e.push(rt(t,"addlayer",this.handleLayerGroupAdd_,this),rt(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[ct(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new Ie("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Ie("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new Ie("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,i=ct(e);this.listenerKeys_[i].forEach(pt),delete this.listenerKeys_[i],this.dispatchEvent(new Ie("removelayer",e)),this.changed()}getLayers(){return this.get("layers")}setLayers(t){const e=this.getLayers();if(e){const i=e.getArray();for(let s=0,r=i.length;s<r;++s)this.dispatchEvent(new Ie("removelayer",i[s]))}this.set("layers",t)}getLayersArray(t){return t=void 0!==t?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=void 0!==t?t:[],i=e.length;this.getLayers().forEach(function(a){a.getLayerStatesArray(e)});const s=this.getLayerState();let r=s.zIndex;!t&&void 0===s.zIndex&&(r=0);for(let a=i,l=e.length;a<l;a++){const c=e[a];c.opacity*=s.opacity,c.visible=c.visible&&s.visible,c.maxResolution=Math.min(c.maxResolution,s.maxResolution),c.minResolution=Math.max(c.minResolution,s.minResolution),c.minZoom=Math.max(c.minZoom,s.minZoom),c.maxZoom=Math.min(c.maxZoom,s.maxZoom),void 0!==s.extent&&(c.extent=void 0!==c.extent?fi(c.extent,s.extent):s.extent),void 0===c.zIndex&&(c.zIndex=r)}return e}getSourceState(){return"ready"}}const Hn=Hs,bi=class ih extends ue{constructor(t,e,i){super(t),this.map=e,this.frameState=void 0!==i?i:null}},Me=class nh extends bi{constructor(t,e,i,s,r,a){super(t,e,r),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=void 0!==s&&s,this.activePointers=a}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}},xt={SINGLECLICK:"singleclick",CLICK:V.CLICK,DBLCLICK:V.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},rh=class sh extends _n{constructor(t,e){super(t),this.map_=t,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=void 0===e?1:e,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=rt(i,"pointerdown",this.handlePointerDown_,this),this.relayedListenerKey_=rt(i,"pointermove",this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(V.TOUCHMOVE,this.boundHandleTouchMove_,!!Ur&&{passive:!1})}emulateClick_(t){let e=new Me(xt.CLICK,this.map_,t);this.dispatchEvent(e),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new Me(xt.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new Me(xt.SINGLECLICK,this.map_,t);this.dispatchEvent(i)},250)}updateActivePointers_(t){const e=t,i=e.pointerId;if(e.type==xt.POINTERUP||e.type==xt.POINTERCANCEL){delete this.trackedTouches_[i];for(const s in this.trackedTouches_)if(this.trackedTouches_[s].target!==e.target){delete this.trackedTouches_[s];break}}else(e.type==xt.POINTERDOWN||e.type==xt.POINTERMOVE)&&(this.trackedTouches_[i]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new Me(xt.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),0===this.activePointers_.length&&(this.dragListenerKeys_.forEach(pt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return 0===t.button}handlePointerDown_(t){this.emulateClicks_=0===this.activePointers_.length,this.updateActivePointers_(t);const e=new Me(xt.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),0===this.dragListenerKeys_.length){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(rt(i,xt.POINTERMOVE,this.handlePointerMove_,this),rt(i,xt.POINTERUP,this.handlePointerUp_,this),rt(this.element_,xt.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(rt(this.element_.getRootNode(),xt.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new Me(xt.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new Me(xt.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&("boolean"!=typeof t.cancelable||!0===t.cancelable)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(pt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(V.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(pt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(pt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},Lt_LAYERGROUP="layergroup",Lt_SIZE="size",Lt_TARGET="target",Lt_VIEW="view",Jn=1/0,ah=class oh{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Gi(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,i=t[0];1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const s=this.keyFunction_(i);return delete this.queuedElements_[s],i}enqueue(t){tt(!(this.keyFunction_(t)in this.queuedElements_),31);const e=this.priorityFunction_(t);return e!=Jn&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(t){return 2*t+1}getRightChildIndex_(t){return 2*t+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return 0===this.elements_.length}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,i=this.priorities_,s=e.length,r=e[t],a=i[t],l=t;for(;t<s>>1;){const c=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),u=h<s&&i[h]<i[c]?h:c;e[t]=e[u],i[t]=i[u],t=u}e[t]=r,i[t]=a,this.siftDown_(l,t)}siftDown_(t,e){const i=this.elements_,s=this.priorities_,r=i[e],a=s[e];for(;e>t;){const l=this.getParentIndex_(e);if(!(s[l]>a))break;i[e]=i[l],s[e]=s[l],e=l}i[e]=r,s[e]=a}reprioritize(){const t=this.priorityFunction_,e=this.elements_,i=this.priorities_;let s=0;const r=e.length;let a,l,c;for(l=0;l<r;++l)a=e[l],c=t(a),c==Jn?delete this.queuedElements_[this.keyFunction_(a)]:(i[s]=c,e[s++]=a);e.length=s,i.length=s,this.heapify_()}},ch=class lh extends ah{constructor(t,e){super(function(i){return t.apply(null,i)},function(i){return i[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(V.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,i=e.getState();if(2===i||3===i||4===i){3!==i&&e.removeEventListener(V.CHANGE,this.boundHandleTileChange_);const s=e.getKey();s in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[s],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let s,r,a,i=0;for(;this.tilesLoading_<t&&i<e&&this.getCount()>0;)r=this.dequeue()[0],a=r.getKey(),s=r.getState(),0===s&&!(a in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[a]=!0,++this.tilesLoading_,++i,r.load())}},Qs=class uh extends re{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){js(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&js(this.element);for(let e=0,i=this.listenerKeys.length;e<i;++e)pt(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==hi&&this.listenerKeys.push(rt(t,"postrender",this.render,this)),t.render())}render(t){}setTarget(t){this.target_="string"==typeof t?document.getElementById(t):t}},gh=class dh extends Qs{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=void 0===t.collapsed||t.collapsed,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=void 0!==t.collapsible,this.collapsible_=void 0===t.collapsible||t.collapsible,this.collapsible_||(this.collapsed_=!1);const e=void 0!==t.className?t.className:"ol-attribution",i=void 0!==t.tipLabel?t.tipLabel:"Attributions",s=void 0!==t.expandClassName?t.expandClassName:e+"-expand",r=void 0!==t.collapseLabel?t.collapseLabel:"\u203a",a=void 0!==t.collapseClassName?t.collapseClassName:e+"-collapse";"string"==typeof r?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=a):this.collapseLabel_=r;const l=void 0!==t.label?t.label:"i";"string"==typeof l?(this.label_=document.createElement("span"),this.label_.textContent=l,this.label_.className=s):this.label_=l;const c=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(c),this.toggleButton_.addEventListener(V.CLICK,this.handleClick_.bind(this),!1);const u=this.element;u.className=e+" "+Bn+" "+Bs+(this.collapsed_&&this.collapsible_?" "+Bo:"")+(this.collapsible_?"":" ol-uncollapsible"),u.appendChild(this.toggleButton_),u.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=Array.from(new Set(this.getMap().getAllLayers().flatMap(s=>s.getAttributions(t)))),i=!this.getMap().getAllLayers().some(s=>s.getSource()&&!1===s.getSource().getAttributionsCollapsible());return this.overrideCollapsible_||this.setCollapsible(i),e}updateElement_(t){if(!t)return void(this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1));const e=this.collectSourceAttributions_(t),i=e.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!we(e,this.renderedAttributions_)){!function qc(n){for(;n.lastChild;)n.removeChild(n.lastChild)}(this.ulElement_);for(let s=0,r=e.length;s<r;++s){const a=document.createElement("li");a.innerHTML=e[s],this.ulElement_.appendChild(a)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Bo),this.collapsed_?Ko(this.collapseLabel_,this.label_):Ko(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}},_h=class fh extends Qs{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=void 0!==t.className?t.className:"ol-rotate",i=void 0!==t.label?t.label:"\u21e7",s=void 0!==t.compassClassName?t.compassClassName:"ol-compass";this.label_=null,"string"==typeof i?(this.label_=document.createElement("span"),this.label_.className=s,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(s));const r=t.tipLabel?t.tipLabel:"Reset rotation",a=document.createElement("button");a.className=e+"-reset",a.setAttribute("type","button"),a.title=r,a.appendChild(this.label_),a.addEventListener(V.CLICK,this.handleClick_.bind(this),!1);const c=this.element;c.className=e+" "+Bn+" "+Bs,c.appendChild(a),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=void 0!==t.duration?t.duration:250,this.autoHide_=void 0===t.autoHide||t.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Wn)}handleClick_(t){t.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const i=e.getRotation();void 0!==i&&(this.duration_>0&&i%(2*Math.PI)!=0?e.animate({rotation:0,duration:this.duration_,easing:vi}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const i=e.viewState.rotation;if(i!=this.rotation_){const s="rotate("+i+"rad)";if(this.autoHide_){const r=this.element.classList.contains(Wn);r||0!==i?r&&0!==i&&this.element.classList.remove(Wn):this.element.classList.add(Wn)}this.label_.style.transform=s}this.rotation_=i}},ph=class mh extends Qs{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=void 0!==t.className?t.className:"ol-zoom",i=void 0!==t.delta?t.delta:1,s=void 0!==t.zoomInClassName?t.zoomInClassName:e+"-in",r=void 0!==t.zoomOutClassName?t.zoomOutClassName:e+"-out",a=void 0!==t.zoomInLabel?t.zoomInLabel:"+",l=void 0!==t.zoomOutLabel?t.zoomOutLabel:"\u2013",c=void 0!==t.zoomInTipLabel?t.zoomInTipLabel:"Zoom in",h=void 0!==t.zoomOutTipLabel?t.zoomOutTipLabel:"Zoom out",u=document.createElement("button");u.className=s,u.setAttribute("type","button"),u.title=c,u.appendChild("string"==typeof a?document.createTextNode(a):a),u.addEventListener(V.CLICK,this.handleClick_.bind(this,i),!1);const d=document.createElement("button");d.className=r,d.setAttribute("type","button"),d.title=h,d.appendChild("string"==typeof l?document.createTextNode(l):l),d.addEventListener(V.CLICK,this.handleClick_.bind(this,-i),!1);const f=this.element;f.className=e+" "+Bn+" "+Bs,f.appendChild(u),f.appendChild(d),this.duration_=void 0!==t.duration?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const i=this.getMap().getView();if(!i)return;const s=i.getZoom();if(void 0!==s){const r=i.getConstrainedZoom(s+t);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:r,duration:this.duration_,easing:vi})):i.setZoom(r)}}};function Qo(n){n=n||{};const t=new oe;return(void 0===n.zoom||n.zoom)&&t.push(new ph(n.zoomOptions)),(void 0===n.rotate||n.rotate)&&t.push(new _h(n.rotateOptions)),(void 0===n.attribution||n.attribution)&&t.push(new gh(n.attributionOptions)),t}function $s(n,t,e,i){const s=n.getZoom();if(void 0===s)return;const r=n.getConstrainedZoom(s+t),a=n.getResolutionForZoom(r);n.getAnimating()&&n.cancelAnimations(),n.animate({resolution:a,anchor:e,duration:void 0!==i?i:250,easing:vi})}const $i=class yh extends re{constructor(t){super(),t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get("active")}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set("active",t)}setMap(t){this.map_=t}},Ch=class vh extends $i{constructor(t){super(),this.delta_=(t=t||{}).delta?t.delta:1,this.duration_=void 0!==t.duration?t.duration:250}handleEvent(t){let e=!1;if(t.type==xt.DBLCLICK){const i=t.originalEvent,r=t.coordinate,a=i.shiftKey?-this.delta_:this.delta_;$s(t.map.getView(),a,r,this.duration_),i.preventDefault(),e=!0}return!e}};function tr(n){const t=n.length;let e=0,i=0;for(let s=0;s<t;s++)e+=n[s].clientX,i+=n[s].clientY;return{clientX:e/t,clientY:i/t}}const tn=class Eh extends $i{constructor(t){super(t=t||{}),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==xt.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==xt.POINTERUP){const i=this.handleUpEvent(t);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(t.type==xt.POINTERDOWN){const i=this.handleDownEvent(t);this.handlingDownUpSequence=i,e=this.stopDown(i)}else t.type==xt.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}};function er(n){const t=arguments;return function(e){let i=!0;for(let s=0,r=t.length;s<r&&(i=i&&t[s](e),i);++s);return i}}const Th=function(n){const t=n.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},ta=function(n){return!n.map.getTargetElement().hasAttribute("tabindex")||function(n){const t=n.map.getTargetElement(),e=n.map.getOwnerDocument().activeElement;return t.contains(e)}(n)},wh=Ni,ea=function(n){const t=n.originalEvent;return 0==t.button&&!(xl&&vl&&t.ctrlKey)},ia=function(n){const t=n.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},Rh=function(n){const t=n.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},na=function(n){const t=n.originalEvent,e=t.target.tagName;return"INPUT"!==e&&"SELECT"!==e&&"TEXTAREA"!==e&&!t.target.isContentEditable},ir=function(n){const t=n.originalEvent;return tt(void 0!==t,56),"mouse"==t.pointerType},Sh=function(n){const t=n.originalEvent;return tt(void 0!==t,56),t.isPrimary&&0===t.button},Mh=class Ih extends tn{constructor(t){super({stopDown:fn}),this.kinetic_=(t=t||{}).kinetic,this.lastCentroid=null,this.panning_=!1;const e=t.condition?t.condition:er(ia,Sh);this.condition_=t.onFocusOnly?er(ta,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const i=this.targetPointers,s=e.getEventPixel(tr(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(s[0],s[1]),this.lastCentroid){const r=[this.lastCentroid[0]-s[0],s[1]-this.lastCentroid[1]],l=t.map.getView();(function nc(n,t){n[0]*=t,n[1]*=t})(r,l.getResolution()),Es(r,l.getRotation()),l.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=s,this.lastPointersCount_=i.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,i=e.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const s=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),a=i.getCenterInternal(),l=e.getPixelFromCoordinateInternal(a),c=e.getCoordinateFromPixelInternal([l[0]-s*Math.cos(r),l[1]-s*Math.sin(r)]);i.animateInternal({center:i.getConstrainedCenter(c),duration:500,easing:vi})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const i=t.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},Ph=class Ah extends tn{constructor(t){t=t||{},super({stopDown:fn}),this.condition_=t.condition?t.condition:Th,this.lastAngle_=void 0,this.duration_=void 0!==t.duration?t.duration:250}handleDragEvent(t){if(!ir(t))return;const e=t.map,i=e.getView();if(i.getConstraints().rotation===Os)return;const s=e.getSize(),r=t.pixel,a=Math.atan2(s[1]/2-r[1],r[0]-s[0]/2);void 0!==this.lastAngle_&&i.adjustRotationInternal(-(a-this.lastAngle_)),this.lastAngle_=a}handleUpEvent(t){return!ir(t)||(t.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(t){return!!(ir(t)&&ea(t)&&this.condition_(t))&&(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0)}},Oh=class Lh extends us{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,i="px",s=this.element_.style;s.left=Math.min(t[0],e[0])+i,s.top=Math.min(t[1],e[1])+i,s.width=Math.abs(e[0]-t[0])+i,s.height=Math.abs(e[1]-t[1])+i}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const t=this.startPixel_,e=this.endPixel_,s=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);s[4]=s[0].slice(),this.geometry_?this.geometry_.setCoordinates([s]):this.geometry_=new Fc([s])}getGeometry(){return this.geometry_}};class nr extends ue{constructor(t,e,i){super(t),this.coordinate=e,this.mapBrowserEvent=i}}const Dh=class Fh extends tn{constructor(t){super(),this.box_=new Oh((t=t||{}).className||"ol-dragbox"),this.minArea_=void 0!==t.minArea?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:ea,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,i){const s=i[0]-e[0],r=i[1]-e[1];return s*s+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new nr("boxdrag",t.coordinate,t))}handleUpEvent(t){this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new nr(e?"boxend":"boxcancel",t.coordinate,t)),!1}handleDownEvent(t){return!!this.condition_(t)&&(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new nr("boxstart",t.coordinate,t)),!0)}onBoxEnd(t){}},Zh=class kh extends Dh{constructor(t){super({condition:(t=t||{}).condition?t.condition:Rh,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=void 0!==t.duration?t.duration:200,this.out_=void 0!==t.out&&t.out}onBoxEnd(t){const i=this.getMap().getView();let s=this.getGeometry();if(this.out_){const r=i.rotatedExtentForGeometry(s),a=i.getResolutionForExtentInternal(r),l=i.getResolution()/a;s=s.clone(),s.scale(l*l)}i.fitInternal(s,{duration:this.duration_,easing:vi})}},Gh=class Nh extends $i{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return ia(e)&&na(e)},this.condition_=void 0!==t.condition?t.condition:this.defaultCondition_,this.duration_=void 0!==t.duration?t.duration:100,this.pixelDelta_=void 0!==t.pixelDelta?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==V.KEYDOWN){const i=t.originalEvent,s=i.key;if(this.condition_(t)&&("ArrowDown"==s||"ArrowLeft"==s||"ArrowRight"==s||"ArrowUp"==s)){const a=t.map.getView(),l=a.getResolution()*this.pixelDelta_;let c=0,h=0;"ArrowDown"==s?h=-l:"ArrowLeft"==s?c=-l:"ArrowRight"==s?c=l:h=l;const u=[c,h];Es(u,a.getRotation()),function xh(n,t,e){const i=n.getCenterInternal();i&&n.animateInternal({duration:void 0!==e?e:250,easing:xc,center:n.getConstrainedCenter([i[0]+t[0],i[1]+t[1]])})}(a,u,this.duration_),i.preventDefault(),e=!0}}return!e}},zh=class Uh extends $i{constructor(t){super(),this.condition_=(t=t||{}).condition?t.condition:na,this.delta_=t.delta?t.delta:1,this.duration_=void 0!==t.duration?t.duration:100}handleEvent(t){let e=!1;if(t.type==V.KEYDOWN||t.type==V.KEYPRESS){const i=t.originalEvent,s=i.key;if(this.condition_(t)&&("+"===s||"-"===s)){const a="+"===s?this.delta_:-this.delta_;$s(t.map.getView(),a,void 0,this.duration_),i.preventDefault(),e=!0}}return!e}},Bh=class Wh extends $i{constructor(t){super(t=t||{}),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=void 0!==t.maxDelta?t.maxDelta:1,this.duration_=void 0!==t.duration?t.duration:250,this.timeout_=void 0!==t.timeout?t.timeout:80,this.useAnchor_=void 0===t.useAnchor||t.useAnchor,this.constrainResolution_=void 0!==t.constrainResolution&&t.constrainResolution;const e=t.condition?t.condition:wh;this.condition_=t.onFocusOnly?er(ta,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.mode_=void 0,this.trackpadEventGap_=400,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();t&&t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t)||t.type!==V.WHEEL)return!0;const i=t.map,s=t.originalEvent;let r;if(s.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate),t.type==V.WHEEL&&(r=s.deltaY,yl&&s.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=Gr),s.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)),0===r)return!1;this.lastDelta_=r;const a=Date.now();void 0===this.startTime_&&(this.startTime_=a),(!this.mode_||a-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const l=i.getView();if("trackpad"===this.mode_&&!l.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(l.getAnimating()&&l.cancelAnimations(),l.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),l.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=a,!1;this.totalDelta_+=r;const c=Math.max(this.timeout_-(a-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),c),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let i=-Et(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),$s(e,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}},qh=class jh extends tn{constructor(t){const e=t=t||{};e.stopDown||(e.stopDown=fn),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==t.threshold?t.threshold:.3,this.duration_=void 0!==t.duration?t.duration:250}handleDragEvent(t){let e=0;const i=this.targetPointers[0],s=this.targetPointers[1],r=Math.atan2(s.clientY-i.clientY,s.clientX-i.clientX);if(void 0!==this.lastAngle_){const c=r-this.lastAngle_;this.rotationDelta_+=c,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=c}this.lastAngle_=r;const a=t.map,l=a.getView();l.getConstraints().rotation!==Os&&(this.anchor_=a.getCoordinateFromPixelInternal(a.getEventPixel(tr(this.targetPointers))),this.rotating_&&(a.render(),l.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return!(this.targetPointers.length<2&&(t.map.getView().endInteraction(this.duration_),1))}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}},Vh=class Kh extends tn{constructor(t){const e=t=t||{};e.stopDown||(e.stopDown=fn),super(e),this.anchor_=null,this.duration_=void 0!==t.duration?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const i=this.targetPointers[0],s=this.targetPointers[1],r=i.clientX-s.clientX,a=i.clientY-s.clientY,l=Math.sqrt(r*r+a*a);void 0!==this.lastDistance_&&(e=this.lastDistance_/l),this.lastDistance_=l;const c=t.map,h=c.getView();1!=e&&(this.lastScaleDelta_=e),this.anchor_=c.getCoordinateFromPixelInternal(c.getEventPixel(tr(this.targetPointers))),c.render(),h.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){return!(this.targetPointers.length<2)||(t.map.getView().endInteraction(this.duration_,this.lastScaleDelta_>1?1:-1),!1)}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}};function sa(n){return n[0]>0&&n[1]>0}function Bt(n,t){return Array.isArray(n)?n:(void 0===t?t=[n,n]:(t[0]=n,t[1]=n),t)}function ra(n){n instanceof Xn?n.setMapInternal(null):n instanceof Hn&&n.getLayers().forEach(ra)}function oa(n,t){if(n instanceof Xn)n.setMapInternal(t);else if(n instanceof Hn){const e=n.getLayers().getArray();for(let i=0,s=e.length;i<s;++i)oa(e[i],t)}}const tu=class Qh extends re{constructor(t){super();const e=function $h(n){let t=null;void 0!==n.keyboardEventTarget&&(t="string"==typeof n.keyboardEventTarget?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);const e={},i=n.layers&&"function"==typeof n.layers.getLayers?n.layers:new Hn({layers:n.layers});let s,r,a;return e[Lt_LAYERGROUP]=i,e[Lt_TARGET]=n.target,e[Lt_VIEW]=n.view instanceof ae?n.view:new ae,void 0!==n.controls&&(Array.isArray(n.controls)?s=new oe(n.controls.slice()):(tt("function"==typeof n.controls.getArray,47),s=n.controls)),void 0!==n.interactions&&(Array.isArray(n.interactions)?r=new oe(n.interactions.slice()):(tt("function"==typeof n.interactions.getArray,48),r=n.interactions)),void 0!==n.overlays?Array.isArray(n.overlays)?a=new oe(n.overlays.slice()):(tt("function"==typeof n.overlays.getArray,49),a=n.overlays):a=new oe,{controls:s,interactions:r,keyboardEventTarget:t,overlays:a,values:e}}(t=t||{});this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=void 0!==t.maxTilesLoading?t.maxTilesLoading:16,this.pixelRatio_=void 0!==t.pixelRatio?t.pixelRatio:Gr,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=[1,0,0,1,0,0],this.pixelToCoordinateTransform_=[1,0,0,1,0,0],this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||Qo(),this.interactions=e.interactions||function Hh(n){n=n||{};const t=new oe,e=new class Yh{constructor(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let i=e-3;for(;i>0&&this.points_[i+2]>t;)i-=3;const s=this.points_[e+2]-this.points_[i+2];if(s<1e3/60)return!1;const r=this.points_[e]-this.points_[i],a=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(a,r),this.initialVelocity_=Math.sqrt(r*r+a*a)/s,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}(-.005,.05,100);return(void 0===n.altShiftDragRotate||n.altShiftDragRotate)&&t.push(new Ph),(void 0===n.doubleClickZoom||n.doubleClickZoom)&&t.push(new Ch({delta:n.zoomDelta,duration:n.zoomDuration})),(void 0===n.dragPan||n.dragPan)&&t.push(new Mh({onFocusOnly:n.onFocusOnly,kinetic:e})),(void 0===n.pinchRotate||n.pinchRotate)&&t.push(new qh),(void 0===n.pinchZoom||n.pinchZoom)&&t.push(new Vh({duration:n.zoomDuration})),(void 0===n.keyboard||n.keyboard)&&(t.push(new Gh),t.push(new zh({delta:n.zoomDelta,duration:n.zoomDuration}))),(void 0===n.mouseWheelZoom||n.mouseWheelZoom)&&t.push(new Bh({onFocusOnly:n.onFocusOnly,duration:n.zoomDuration})),(void 0===n.shiftDragZoom||n.shiftDragZoom)&&t.push(new Zh({duration:n.zoomDuration})),t}({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new ch(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Lt_LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Lt_VIEW,this.handleViewChanged_),this.addChangeListener(Lt_SIZE,this.handleSizeChanged_),this.addChangeListener(Lt_TARGET,this.handleTargetChanged_),this.setProperties(e.values);const i=this;t.view&&!(t.view instanceof ae)&&t.view.then(function(s){i.setView(new ae(s))}),this.controls.addEventListener("add",s=>{s.element.setMap(this)}),this.controls.addEventListener("remove",s=>{s.element.setMap(null)}),this.interactions.addEventListener("add",s=>{s.element.setMap(this)}),this.interactions.addEventListener("remove",s=>{s.element.setMap(null)}),this.overlays_.addEventListener("add",s=>{this.addOverlayInternal_(s.element)}),this.overlays_.addEventListener("remove",s=>{const r=s.element.getId();void 0!==r&&delete this.overlayIdIndex_[r.toString()],s.element.setMap(null)}),this.controls.forEach(s=>{s.setMap(this)}),this.interactions.forEach(s=>{s.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){oa(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();void 0!==e&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,i){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(t);return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,void 0!==(i=void 0!==i?i:{}).hitTolerance?i.hitTolerance:0,!1!==i.checkWrapped,e,null,void 0!==i.layerFilter?i.layerFilter:Ni,null)}getFeaturesAtPixel(t,e){const i=[];return this.forEachFeatureAtPixel(t,function(s){i.push(s)},e),i}getAllLayers(){const t=[];return function e(i){i.forEach(function(s){s instanceof Hn?e(s.getLayers()):t.push(s)})}(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(t);return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,void 0!==(e=void 0!==e?e:{}).hitTolerance?e.hitTolerance:0,!1!==e.checkWrapped,void 0!==e.layerFilter?e.layerFilter:Ni,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const i=this.viewport_.getBoundingClientRect(),s=this.getSize(),l="changedTouches"in t?t.changedTouches[0]:t;return[(l.clientX-i.left)/(i.width/s[0]),(l.clientY-i.top)/(i.height/s[1])]}getTarget(){return this.get(Lt_TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return Ms(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?Rt(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return void 0!==e?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Lt_LAYERGROUP)}setLayers(t){const e=this.getLayerGroup();if(t instanceof oe)return void e.setLayers(t);const i=e.getLayers();i.clear(),i.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const s=t[e];if(!s.visible)continue;const r=s.layer.getRenderer();if(r&&!r.ready)return!0;const a=s.layer.getSource();if(a&&a.loading)return!0}return!1}getPixelFromCoordinate(t){const e=fe(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?Rt(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Lt_SIZE)}getView(){return this.get(Lt_VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,i,s){return function hh(n,t,e,i,s){if(!n||!(e in n.wantedTiles)||!n.wantedTiles[e][t.getKey()])return Jn;const r=n.viewState.center,a=i[0]-r[0],l=i[1]-r[1];return 65536*Math.log(s)+Math.sqrt(a*a+l*l)/s}(this.frameState_,t,e,i,s)}handleBrowserEvent(t,e){const i=new Me(e=e||t.type,this,t);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,i=e.type;if("pointerdown"===i||i===V.WHEEL||i===V.KEYDOWN){const s=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():s,a=e.target;if(this.overlayContainerStopEvent_.contains(a)||!(r===s?s.documentElement:r).contains(a))return}if(t.frameState=this.frameState_,!1!==this.dispatchEvent(t)){const s=this.getInteractions().getArray().slice();for(let r=s.length-1;r>=0;r--){const a=s[r];if(a.getMap()===this&&a.getActive()&&this.getTargetElement()&&(!a.handleEvent(t)||t.propagationStopped))break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let s=this.maxTilesLoading_,r=s;if(t){const a=t.viewHints;if(a[0]||a[1]){const l=Date.now()-t.time>8;s=l?0:8,r=l?0:2}}e.getTilesLoading()<s&&(e.reprioritize(),e.loadMoreTiles(s,r))}t&&this.renderer_&&!t.animate&&(!0===this.renderComplete_?(this.hasListener("rendercomplete")&&this.renderer_.dispatchRenderEvent("rendercomplete",t),!1===this.loaded_&&(this.loaded_=!0,this.dispatchEvent(new bi("loadend",this,t)))):!0===this.loaded_&&(this.loaded_=!1,this.dispatchEvent(new bi("loadstart",this,t))));const i=this.postRenderFunctions_;for(let s=0,r=i.length;s<r;++s)i[s](this,t);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,s=this.targetChangeHandlerKeys_.length;i<s;++i)pt(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(V.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(V.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,js(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const t=this.getTarget(),e="string"==typeof t?document.getElementById(t):t;if(this.targetElement_=e,e){e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new eh(this)),this.mapBrowserEventHandler_=new rh(this,this.moveTolerance_);for(const r in xt)this.mapBrowserEventHandler_.addEventListener(xt[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(V.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(V.WHEEL,this.boundHandleBrowserEvent_,!!Ur&&{passive:!1});const i=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.targetChangeHandlerKeys_=[rt(i,V.KEYDOWN,this.handleBrowserEvent,this),rt(i,V.KEYPRESS,this.handleBrowserEvent,this)];const s=e.getRootNode();s instanceof ShadowRoot&&this.resizeObserver_.observe(s.host),this.resizeObserver_.observe(e)}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(pt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(pt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=rt(t,"propertychange",this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=rt(t,V.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(pt),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new Ie("addlayer",t)),this.layerGroupPropertyListenerKeys_=[rt(t,"propertychange",this.render,this),rt(t,V.CHANGE,this.render,this),rt(t,"addlayer",this.handleLayerAdd_,this),rt(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const s=t[e].layer;s.hasRenderer()&&s.getRenderer().handleFontsChanged()}}render(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){ra(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),i=this.getView(),s=this.frameState_;let r=null;if(void 0!==e&&sa(e)&&i&&i.isDef()){const a=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),l=i.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:xs(l.center,l.resolution,l.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:l,viewHints:a,wantedTiles:{},mapId:ct(this),renderTargets:{}},l.nextCenter&&l.nextResolution){const c=isNaN(l.nextRotation)?l.rotation:l.nextRotation;r.nextExtent=xs(l.nextCenter,l.nextResolution,c,e)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),s&&(!this.previousExtent_||!wn(this.previousExtent_)&&!Yi(r.extent,this.previousExtent_))&&(this.dispatchEvent(new bi("movestart",this,s)),this.previousExtent_=Be(this.previousExtent_)),this.previousExtent_&&!r.viewHints[0]&&!r.viewHints[1]&&!Yi(r.extent,this.previousExtent_)&&(this.dispatchEvent(new bi("moveend",this,r)),Xr(r.extent,this.previousExtent_))),this.dispatchEvent(new bi("postrender",this,r)),this.renderComplete_=this.hasListener("loadstart")||this.hasListener("loadend")||this.hasListener("rendercomplete")?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new Ie("removelayer",e)),this.set(Lt_LAYERGROUP,t)}setSize(t){this.set(Lt_SIZE,t)}setTarget(t){this.set(Lt_TARGET,t)}setView(t){if(!t||t instanceof ae)return void this.set(Lt_VIEW,t);this.set(Lt_VIEW,new ae);const e=this;t.then(function(i){e.setView(new ae(i))})}updateSize(){const t=this.getTargetElement();let e;if(t){const s=getComputedStyle(t),r=t.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),a=t.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth);!isNaN(r)&&!isNaN(a)&&(e=[r,a],!sa(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&uo("No map visible because the map container's width or height are 0."))}const i=this.getSize();e&&(!i||!we(e,i))&&(this.setSize(e),this.updateViewportSize_())}updateViewportSize_(){const t=this.getView();if(t){let e;const i=getComputedStyle(this.viewport_);i.width&&i.height&&(e=[parseInt(i.width,10),parseInt(i.height,10)]),t.setViewportSize(e)}}},iu=class eu extends Xn{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.setPreload(void 0!==t.preload?t.preload:0),this.setUseInterimTilesOnError(void 0===t.useInterimTilesOnError||t.useInterimTilesOnError)}getPreload(){return this.get("preload")}setPreload(t){this.set("preload",t)}getUseInterimTilesOnError(){return this.get("useInterimTilesOnError")}setUseInterimTilesOnError(t){this.set("useInterimTilesOnError",t)}getData(t){return super.getData(t)}},Ct_IDLE=0,Ct_LOADING=1,Ct_LOADED=2,Ct_ERROR=3,su=class nu extends Dr{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return ot()}getData(t){return null}prepareFrame(t){return ot()}renderFrame(t,e){return ot()}loadedTileCallback(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i}createLoadedTileFinder(t,e,i){return(s,r)=>{const a=this.loadedTileCallback.bind(this,i,s);return t.forEachLoadedTile(e,s,r,a)}}forEachFeatureAtCoordinate(t,e,i,s,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){t.target.getState()===Ct_LOADED&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=Ct_LOADED&&e!=Ct_ERROR&&t.addEventListener(V.CHANGE,this.boundHandleImageChange_),e==Ct_IDLE&&(t.load(),e=t.getState()),e==Ct_LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&"ready"===t.getSourceState()&&t.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}},aa=[];let wi=null;const la=class ou extends su{constructor(t){super(t),this.container=null,this.tempTransform=[1,0,0,1,0,0],this.pixelTransform=[1,0,0,1,0,0],this.inversePixelTransform=[1,0,0,1,0,0],this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,i){let s;wi||function ru(){wi=Ft(1,1,void 0,{willReadFrequently:!0})}(),wi.clearRect(0,0,1,1);try{wi.drawImage(t,e,i,1,1,0,0,1,1),s=wi.getImageData(0,0,1,1).data}catch{return wi=null,null}return s}getBackground(t){let i=this.getLayer().getBackground();return"function"==typeof i&&(i=i(t.viewState.resolution)),i||void 0}useContainer(t,e,i){const s=this.getLayer().getClassName();let r,a;if(t&&t.className===s&&(!i||t&&t.style.backgroundColor&&we(An(t.style.backgroundColor),An(i)))){const l=t.firstElementChild;l instanceof HTMLCanvasElement&&(a=l.getContext("2d"))}if(a&&a.canvas.style.transform===e?(this.container=t,this.context=a,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){r=document.createElement("div"),r.className=s;let l=r.style;l.position="absolute",l.width="100%",l.height="100%",a=Ft();const c=a.canvas;r.appendChild(c),l=c.style,l.position="absolute",l.left="0",l.transformOrigin="top left",this.container=r,this.context=a}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){const s=je(i),r=bn(i),a=Tn(i),l=En(i);Rt(e.coordinateToPixelTransform,s),Rt(e.coordinateToPixelTransform,r),Rt(e.coordinateToPixelTransform,a),Rt(e.coordinateToPixelTransform,l);const c=this.inversePixelTransform;Rt(c,s),Rt(c,r),Rt(c,a),Rt(c,l),t.save(),t.beginPath(),t.moveTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.lineTo(Math.round(l[0]),Math.round(l[1])),t.clip()}dispatchRenderEvent_(t,e,i){const s=this.getLayer();if(s.hasListener(t)){const r=new Wo(t,this.inversePixelTransform,i,e);s.dispatchEvent(r)}}preRender(t,e){this.frameState=e,this.dispatchRenderEvent_("prerender",t,e)}postRender(t,e){this.dispatchRenderEvent_("postrender",t,e)}getRenderTransform(t,e,i,s,r,a,l){const u=s/e;return de(this.tempTransform,r/2,a/2,u,-u,-i,-t[0]+l,-t[1])}disposeInternal(){delete this.frameState,super.disposeInternal()}},ca=class au extends _n{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=void 0===i.transition?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(V.CHANGE)}release(){3===this.state&&this.setState(4)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let t=this.interimTile;do{if(2==t.getState())return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){if(!this.interimTile)return;let t=this.interimTile,e=this;do{if(2==t.getState()){t.interimTile=null;break}1==t.getState()?e=t:0==t.getState()?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(3!==this.state&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){ot()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(i){if(-1===i)return 1}else i=e,this.transitionStarts_[t]=i;const s=e-i+1e3/60;return s>=this.transition_?1:To(s/this.transition_)}inTransition(t){return!!this.transition_&&-1!==this.transitionStarts_[t]}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}};function sr(n,t,e){const i=n;let s=!0,r=!1,a=!1;const l=[mn(i,V.LOAD,function(){a=!0,r||t()})];return i.src&&Cl?(r=!0,i.decode().then(function(){s&&t()}).catch(function(c){s&&(a?t():e())})):l.push(mn(i,V.ERROR,e)),function(){s=!1,l.forEach(pt)}}const ha=class lu extends ca{constructor(t,e,i,s,r,a){super(t,e,a),this.crossOrigin_=s,this.src_=i,this.key=i,this.image_=new Image,null!==s&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(t){this.image_=t,this.state=2,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=3,this.unlistenImage_(),this.image_=function cu(){const n=Ft(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}(),this.changed()}handleImageLoad_(){const t=this.image_;this.state=t.naturalWidth&&t.naturalHeight?2:4,this.unlistenImage_(),this.changed()}load(){3==this.state&&(this.state=0,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),0==this.state&&(this.state=1,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=sr(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}};let rr;const Ri=[];function da(n,t,e,i,s){n.beginPath(),n.moveTo(0,0),n.lineTo(t,e),n.lineTo(i,s),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(t,i)+1,Math.max(e,s)),n.restore()}function or(n,t){return Math.abs(n[4*t]-210)>2||Math.abs(n[4*t+3]-191.25)>2}function ga(n,t,e,i){const s=Ve(e,t,n);let r=_o(t,i,e);const a=t.getMetersPerUnit();void 0!==a&&(r*=a);const l=n.getMetersPerUnit();void 0!==l&&(r/=l);const c=n.getExtent();if(!c||vn(c,s)){const h=_o(n,r,s)/r;isFinite(h)&&h>0&&(r/=h)}return r}const ar=class pu extends ca{constructor(t,e,i,s,r,a,l,c,h,u,d,g){super(r,0,{interpolate:!!g}),this.renderEdges_=void 0!==d&&d,this.pixelRatio_=l,this.gutter_=c,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=s,this.wrappedTileCoord_=a||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const f=s.getTileCoordExtent(this.wrappedTileCoord_),_=this.targetTileGrid_.getExtent();let m=this.sourceTileGrid_.getExtent();const p=_?fi(f,_):f;if(0===Cn(p))return void(this.state=4);const x=t.getExtent();x&&(m=m?fi(m,x):x);const v=s.getResolution(this.wrappedTileCoord_[0]),E=function _u(n,t,e,i){const s=gi(e);let r=ga(n,t,s,i);return(!isFinite(r)||r<=0)&&Kr(e,function(a){return r=ga(n,t,a,i),isFinite(r)&&r>0}),r}(t,i,p,v);if(!isFinite(E)||E<=0)return void(this.state=4);if(this.triangulation_=new class du{constructor(t,e,i,s,r,a){this.sourceProj_=t,this.targetProj_=e;let l={};const c=ji(this.targetProj_,this.sourceProj_);this.transformInv_=function(v){const E=v[0]+"/"+v[1];return l[E]||(l[E]=c(v)),l[E]},this.maxSourceExtent_=s,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&_t(s)>=_t(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?_t(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?_t(this.targetProj_.getExtent()):null;const h=je(i),u=bn(i),d=Tn(i),g=En(i),f=this.transformInv_(h),_=this.transformInv_(u),m=this.transformInv_(d),p=this.transformInv_(g),x=10+(a?Math.max(0,Math.ceil(Math.log2(Cn(i)/(a*a*256*256)))):0);if(this.addQuad_(h,u,d,g,f,_,m,p,x),this.wrapsXInSource_){let v=1/0;this.triangles_.forEach(function(E,T,b){v=Math.min(v,E.source[0][0],E.source[1][0],E.source[2][0])}),this.triangles_.forEach(E=>{if(Math.max(E.source[0][0],E.source[1][0],E.source[2][0])-v>this.sourceWorldWidth_/2){const T=[[E.source[0][0],E.source[0][1]],[E.source[1][0],E.source[1][1]],[E.source[2][0],E.source[2][1]]];T[0][0]-v>this.sourceWorldWidth_/2&&(T[0][0]-=this.sourceWorldWidth_),T[1][0]-v>this.sourceWorldWidth_/2&&(T[1][0]-=this.sourceWorldWidth_),T[2][0]-v>this.sourceWorldWidth_/2&&(T[2][0]-=this.sourceWorldWidth_);const b=Math.min(T[0][0],T[1][0],T[2][0]);Math.max(T[0][0],T[1][0],T[2][0])-b<this.sourceWorldWidth_/2&&(E.source=T)}})}l={}}addTriangle_(t,e,i,s,r,a){this.triangles_.push({source:[s,r,a],target:[t,e,i]})}addQuad_(t,e,i,s,r,a,l,c,h){const u=Yr([r,a,l,c]),d=this.sourceWorldWidth_?_t(u)/this.sourceWorldWidth_:null,g=this.sourceWorldWidth_,f=this.sourceProj_.canWrapX()&&d>.5&&d<1;let _=!1;if(h>0&&(this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(_=_t(Yr([t,e,i,s]))/this.targetWorldWidth_>.25||_),!f&&this.sourceProj_.isGlobal()&&d&&(_=d>.25||_)),!_&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!Nt(u,this.maxSourceExtent_))return;let m=0;if(!(_||isFinite(r[0])&&isFinite(r[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(l[0])&&isFinite(l[1])&&isFinite(c[0])&&isFinite(c[1])))if(h>0)_=!0;else if(m=(isFinite(r[0])&&isFinite(r[1])?0:8)+(isFinite(a[0])&&isFinite(a[1])?0:4)+(isFinite(l[0])&&isFinite(l[1])?0:2)+(isFinite(c[0])&&isFinite(c[1])?0:1),1!=m&&2!=m&&4!=m&&8!=m)return;if(h>0){if(!_){const x=this.transformInv_([(t[0]+i[0])/2,(t[1]+i[1])/2]);let v;v=f?(mi(r[0],g)+mi(l[0],g))/2-mi(x[0],g):(r[0]+l[0])/2-x[0];const E=(r[1]+l[1])/2-x[1];_=v*v+E*E>this.errorThresholdSquared_}if(_){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const p=[(e[0]+i[0])/2,(e[1]+i[1])/2],x=this.transformInv_(p),v=[(s[0]+t[0])/2,(s[1]+t[1])/2],E=this.transformInv_(v);this.addQuad_(t,e,p,v,r,a,x,E,h-1),this.addQuad_(v,p,i,s,E,x,l,c,h-1)}else{const p=[(t[0]+e[0])/2,(t[1]+e[1])/2],x=this.transformInv_(p),v=[(i[0]+s[0])/2,(i[1]+s[1])/2],E=this.transformInv_(v);this.addQuad_(t,p,v,s,r,x,E,c,h-1),this.addQuad_(p,e,i,v,x,a,l,E,h-1)}return}}if(f){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}11&m||this.addTriangle_(t,i,s,r,l,c),14&m||this.addTriangle_(t,i,e,r,l,a),m&&(13&m||this.addTriangle_(e,s,t,a,c,r),7&m||this.addTriangle_(e,s,i,a,c,l))}calculateSourceExtent(){const t=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach(function(e,i,s){const r=e.source;di(t,r[0]),di(t,r[1]),di(t,r[2])}),t}getTriangles(){return this.triangles_}}(t,i,p,m,E*(void 0!==u?u:.5),v),0===this.triangulation_.getTriangles().length)return void(this.state=4);this.sourceZ_=e.getZForResolution(E);let b=this.triangulation_.calculateSourceExtent();if(m&&(t.canWrapX()?(b[1]=Et(b[1],m[1],m[3]),b[3]=Et(b[3],m[1],m[3])):b=fi(b,m)),Cn(b)){const R=e.getTileRangeForExtentAndZ(b,this.sourceZ_);for(let P=R.minX;P<=R.maxX;P++)for(let I=R.minY;I<=R.maxY;I++){const z=h(this.sourceZ_,P,I,l);z&&this.sourceTiles_.push(z)}0===this.sourceTiles_.length&&(this.state=4)}else this.state=4}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{e&&2==e.getState()&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}),this.sourceTiles_.length=0,0===t.length)this.state=3;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),s="number"==typeof i?i:i[0],r="number"==typeof i?i:i[1],a=this.targetTileGrid_.getResolution(e),l=this.sourceTileGrid_.getResolution(this.sourceZ_),c=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=function mu(n,t,e,i,s,r,a,l,c,h,u,d){const g=Ft(Math.round(e*n),Math.round(e*t),Ri);if(d||(g.imageSmoothingEnabled=!1),0===c.length)return g.canvas;function f(T){return Math.round(T*e)/e}g.scale(e,e),g.globalCompositeOperation="lighter";const _=[1/0,1/0,-1/0,-1/0];c.forEach(function(T,b,R){!function Il(n,t){t[0]<n[0]&&(n[0]=t[0]),t[2]>n[2]&&(n[2]=t[2]),t[1]<n[1]&&(n[1]=t[1]),t[3]>n[3]&&(n[3]=t[3])}(_,T.extent)});const m=_t(_),p=$t(_),x=Ft(Math.round(e*m/i),Math.round(e*p/i),Ri);d||(x.imageSmoothingEnabled=!1);const v=e/i;c.forEach(function(T,b,R){const P=T.extent[0]-_[0],I=-(T.extent[3]-_[3]),z=_t(T.extent),X=$t(T.extent);T.image.width>0&&T.image.height>0&&x.drawImage(T.image,h,h,T.image.width-2*h,T.image.height-2*h,P*v,I*v,z*v,X*v)});const E=je(a);return l.getTriangles().forEach(function(T,b,R){const P=T.source,I=T.target;let z=P[0][0],X=P[0][1],at=P[1][0],st=P[1][1],K=P[2][0],bt=P[2][1];const H=f((I[0][0]-E[0])/r),k=f(-(I[0][1]-E[1])/r),M=f((I[1][0]-E[0])/r),Z=f(-(I[1][1]-E[1])/r),lt=f((I[2][0]-E[0])/r),dt=f(-(I[2][1]-E[1])/r),It=z,w=X;z=0,X=0,at-=It,st-=w,K-=It,bt-=w;const ht=function Zl(n){const t=n.length;for(let i=0;i<t;i++){let s=i,r=Math.abs(n[i][i]);for(let l=i+1;l<t;l++){const c=Math.abs(n[l][i]);c>r&&(r=c,s=l)}if(0===r)return null;const a=n[s];n[s]=n[i],n[i]=a;for(let l=i+1;l<t;l++){const c=-n[l][i]/n[i][i];for(let h=i;h<t+1;h++)i==h?n[l][h]=0:n[l][h]+=c*n[i][h]}}const e=new Array(t);for(let i=t-1;i>=0;i--){e[i]=n[i][t]/n[i][i];for(let s=i-1;s>=0;s--)n[s][t]-=n[s][i]*e[i]}return e}([[at,st,0,0,M-H],[K,bt,0,0,lt-H],[0,0,at,st,Z-k],[0,0,K,bt,dt-k]]);if(ht){if(g.save(),g.beginPath(),function fu(){if(void 0===rr){const n=Ft(6,6,Ri);n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",da(n,4,5,4,0),da(n,4,5,0,5);const t=n.getImageData(0,0,3,3).data;rr=or(t,0)||or(t,4)||or(t,8),jn(n),Ri.push(n.canvas)}return rr}()||!d){g.moveTo(M,Z);const ft=4,Ze=H-M,he=k-Z;for(let Mt=0;Mt<ft;Mt++)g.lineTo(M+f((Mt+1)*Ze/ft),Z+f(Mt*he/(ft-1))),Mt!=ft-1&&g.lineTo(M+f((Mt+1)*Ze/ft),Z+f((Mt+1)*he/(ft-1)));g.lineTo(lt,dt)}else g.moveTo(M,Z),g.lineTo(H,k),g.lineTo(lt,dt);g.clip(),g.transform(ht[0],ht[2],ht[1],ht[3],H,k),g.translate(_[0]-It,_[3]-w),g.scale(i/e,-i/e),g.drawImage(x.canvas,0,0),g.restore()}}),jn(x),Ri.push(x.canvas),u&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,l.getTriangles().forEach(function(T,b,R){const P=T.target,I=(P[0][0]-E[0])/r,z=-(P[0][1]-E[1])/r,X=(P[1][0]-E[0])/r,at=-(P[1][1]-E[1])/r,st=(P[2][0]-E[0])/r,K=-(P[2][1]-E[1])/r;g.beginPath(),g.moveTo(X,at),g.lineTo(I,z),g.lineTo(st,K),g.closePath(),g.stroke()}),g.restore()),g.canvas}(s,r,this.pixelRatio_,l,this.sourceTileGrid_.getExtent(),a,c,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=2}this.changed()}load(){if(0==this.state){this.state=1,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(e=>{const i=e.getState();if(0==i||1==i){t++;const s=rt(e,V.CHANGE,function(r){const a=e.getState();(2==a||3==a||4==a)&&(pt(s),t--,0===t&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(s)}}),0===t?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,i,s){0==e.getState()&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(pt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(jn(this.canvas_.getContext("2d")),Ri.push(this.canvas_),this.canvas_=null),super.release()}};class fa{constructor(t,e,i,s){this.minX=t,this.maxX=e,this.minY=i,this.maxY=s}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function Si(n,t,e,i,s){return void 0!==s?(s.minX=n,s.maxX=t,s.minY=e,s.maxY=i,s):new fa(n,t,e,i)}const _a=fa,xu=class yu extends la{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedProjection=null,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=[1/0,1/0,-1/0,-1/0],this.tmpTileRange_=new _a(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),i=t.getState(),s=e.getUseInterimTilesOnError();return 2==i||4==i||3==i&&!s}getTile(t,e,i,s){const r=s.pixelRatio,a=s.viewState.projection,l=this.getLayer();let h=l.getSource().getTile(t,e,i,r,a);return 3==h.getState()&&l.getUseInterimTilesOnError()&&l.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(h)||(h=h.getInterimTile()),h}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),s=Rt(e.pixelToCoordinateTransform,t.slice()),r=i.getExtent();if(r&&!vn(r,s))return null;const a=e.pixelRatio,l=e.viewState.projection,c=e.viewState,h=i.getRenderSource(),u=h.getTileGridForProjection(c.projection),d=h.getTilePixelRatio(e.pixelRatio);for(let g=u.getZForResolution(c.resolution);g>=u.getMinZoom();--g){const f=u.getTileCoordForCoordAndZ(s,g),_=h.getTile(g,f[1],f[2],a,l);if(!(_ instanceof ha||_ instanceof ar)||_ instanceof ar&&4===_.getState())return null;if(2!==_.getState())continue;const m=u.getOrigin(g),p=Bt(u.getTileSize(g)),x=u.getResolution(g),v=Math.floor(d*((s[0]-m[0])/x-f[1]*p[0])),E=Math.floor(d*((m[1]-s[1])/x-f[2]*p[1])),T=Math.round(d*h.getGutterForProjection(c.projection));return this.getImageData(_.getImage(),v+T,E+T)}return null}loadedTileCallback(t,e,i){return!!this.isDrawableTile(i)&&super.loadedTileCallback(t,e,i)}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex],s=t.viewState,r=s.projection,a=s.resolution,l=s.center,c=s.rotation,h=t.pixelRatio,u=this.getLayer(),d=u.getSource(),g=d.getRevision(),f=d.getTileGridForProjection(r),_=f.getZForResolution(a,d.zDirection),m=f.getResolution(_);let p=t.extent;const x=t.viewState.resolution,v=d.getTilePixelRatio(h),E=Math.round(_t(p)/x*h),T=Math.round($t(p)/x*h),b=i.extent&&He(i.extent);b&&(p=fi(p,He(i.extent)));const R=m*E/2/v,P=m*T/2/v,I=[l[0]-R,l[1]-P,l[0]+R,l[1]+P],z=f.getTileRangeForExtentAndZ(p,_),X={};X[_]={};const at=this.createLoadedTileFinder(d,r,X),st=this.tmpExtent,K=this.tmpTileRange_;this.newTiles_=!1;const bt=c?vs(s.center,x,c,t.size):void 0;for(let zt=z.minX;zt<=z.maxX;++zt)for(let ht=z.minY;ht<=z.maxY;++ht){if(c&&!f.tileCoordIntersectsViewport([_,zt,ht],bt))continue;const ft=this.getTile(_,zt,ht,t);if(this.isDrawableTile(ft)){const Mt=ct(this);if(2==ft.getState()){X[_][ft.tileCoord.toString()]=ft;let xe=ft.inTransition(Mt);xe&&1!==i.opacity&&(ft.endTransition(Mt),xe=!1),!this.newTiles_&&(xe||!this.renderedTiles.includes(ft))&&(this.newTiles_=!0)}if(1===ft.getAlpha(Mt,t.time))continue}const Ze=f.getTileCoordChildTileRange(ft.tileCoord,K,st);let he=!1;Ze&&(he=at(_+1,Ze)),he||f.forEachTileCoordParentTileRange(ft.tileCoord,at,K,st)}const H=m/a*h/v;de(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/h,1/h,c,-E/2,-T/2);const k=ms(this.pixelTransform);this.useContainer(e,k,this.getBackground(t));const M=this.context,Z=M.canvas;xn(this.inversePixelTransform,this.pixelTransform),de(this.tempTransform,E/2,T/2,H,H,0,-E/2,-T/2),Z.width!=E||Z.height!=T?(Z.width=E,Z.height=T):this.containerReused||M.clearRect(0,0,E,T),b&&this.clipUnrotated(M,t,b),d.getInterpolate()||(M.imageSmoothingEnabled=!1),this.preRender(M,t),this.renderedTiles.length=0;let dt,It,w,lt=Object.keys(X).map(Number);lt.sort(We),1!==i.opacity||this.containerReused&&!d.getOpaque(t.viewState.projection)?(dt=[],It=[]):lt=lt.reverse();for(let zt=lt.length-1;zt>=0;--zt){const ht=lt[zt],ft=d.getTilePixelSize(ht,h,r),he=f.getResolution(ht)/m,Mt=ft[0]*he*H,xe=ft[1]*he*H,Pi=f.getTileCoordForCoordAndZ(je(I),ht),ns=f.getTileCoordExtent(Pi),Li=Rt(this.tempTransform,[v*(ns[0]-I[0])/m,v*(I[3]-ns[3])/m]),ss=v*d.getGutterForProjection(r),Ne=X[ht];for(const hn in Ne){const Ge=Ne[hn],rs=Ge.tileCoord,os=Pi[1]-rs[1],as=Math.round(Li[0]-(os-1)*Mt),Oi=Pi[2]-rs[2],Rr=Math.round(Li[1]-(Oi-1)*xe),Gt=Math.round(Li[0]-os*Mt),qt=Math.round(Li[1]-Oi*xe),se=as-Gt,ve=Rr-qt,Fi=_===ht,oi=Fi&&1!==Ge.getAlpha(ct(this),t.time);let Ue=!1;if(!oi)if(dt){w=[Gt,qt,Gt+se,qt,Gt+se,qt+ve,Gt,qt+ve];for(let Di=0,ls=dt.length;Di<ls;++Di)if(_!==ht&&ht<It[Di]){const Dt=dt[Di];Nt([Gt,qt,Gt+se,qt+ve],[Dt[0],Dt[3],Dt[4],Dt[7]])&&(Ue||(M.save(),Ue=!0),M.beginPath(),M.moveTo(w[0],w[1]),M.lineTo(w[2],w[3]),M.lineTo(w[4],w[5]),M.lineTo(w[6],w[7]),M.moveTo(Dt[6],Dt[7]),M.lineTo(Dt[4],Dt[5]),M.lineTo(Dt[2],Dt[3]),M.lineTo(Dt[0],Dt[1]),M.clip())}dt.push(w),It.push(ht)}else M.clearRect(Gt,qt,se,ve);this.drawTileImage(Ge,t,Gt,qt,se,ve,ss,Fi),dt&&!oi?(Ue&&M.restore(),this.renderedTiles.unshift(Ge)):this.renderedTiles.push(Ge),this.updateUsedTiles(t.usedTiles,d,Ge)}}return this.renderedRevision=g,this.renderedResolution=m,this.extentChanged=!this.renderedExtent_||!Yi(this.renderedExtent_,I),this.renderedExtent_=I,this.renderedPixelRatio=h,this.renderedProjection=r,this.manageTilePyramid(t,d,f,h,r,p,_,u.getPreload()),this.scheduleExpireCache(t,d),this.postRender(M,t),i.extent&&M.restore(),M.imageSmoothingEnabled=!0,k!==Z.style.transform&&(Z.style.transform=k),this.container}drawTileImage(t,e,i,s,r,a,l,c){const h=this.getTileImage(t);if(!h)return;const u=ct(this),d=e.layerStatesArray[e.layerIndex],g=d.opacity*(c?t.getAlpha(u,e.time):1),f=g!==this.context.globalAlpha;f&&(this.context.save(),this.context.globalAlpha=g),this.context.drawImage(h,l,l,h.width-2*l,h.height-2*l,i,s,r,a),f&&this.context.restore(),g!==d.opacity?e.animate=!0:c&&t.endTransition(u)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const i=function(s,r,a){const l=ct(s);l in a.usedTiles&&s.expireCache(a.viewState.projection,a.usedTiles[l])}.bind(null,e);t.postRenderFunctions.push(i)}}updateUsedTiles(t,e,i){const s=ct(e);s in t||(t[s]={}),t[s][i.getKey()]=!0}manageTilePyramid(t,e,i,s,r,a,l,c,h){const u=ct(e);u in t.wantedTiles||(t.wantedTiles[u]={});const d=t.wantedTiles[u],g=t.tileQueue,f=i.getMinZoom(),_=t.viewState.rotation,m=_?vs(t.viewState.center,t.viewState.resolution,_,t.size):void 0;let x,v,E,T,b,R,p=0;for(R=f;R<=l;++R)for(v=i.getTileRangeForExtentAndZ(a,R,v),E=i.getResolution(R),T=v.minX;T<=v.maxX;++T)for(b=v.minY;b<=v.maxY;++b)_&&!i.tileCoordIntersectsViewport([R,T,b],m)||(l-R<=c?(++p,x=e.getTile(R,T,b,s,r),0==x.getState()&&(d[x.getKey()]=!0,g.isKeyQueued(x.getKey())||g.enqueue([x,u,i.getTileCoordCenter(x.tileCoord),E])),void 0!==h&&h(x)):e.useTile(R,T,b,r));e.updateCacheSize(p,r)}},Cu=class vu extends iu{constructor(t){super(t)}createRenderer(){return new xu(this)}},Tu=class Eu{constructor(t){this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const i=this.entries_[t];return tt(void 0!==i,15),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(t){const e=this.entries_[t];return tt(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let i,e=0;for(i=this.newest_;i;i=i.older)t[e++]=i.key_;return t}getValues(){const t=new Array(this.count_);let i,e=0;for(i=this.newest_;i;i=i.older)t[e++]=i.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){if(this.containsKey(t))return this.entries_[t].value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){tt(!(t in this.entries_),16);const i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}};function ma(n,t,e,i){return void 0!==i?(i[0]=n,i[1]=t,i[2]=e,i):[n,t,e]}function en(n,t,e){return n+"/"+t+"/"+e}function pa(n){return en(n[0],n[1],n[2])}const ya=class Su extends Tu{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(0===this.getCount())return;const i=function bu(n){return n.split("/").map(Number)}(this.peekFirstKey())[0];this.forEach(s=>{s.tileCoord[0]!==i&&(this.remove(pa(s.tileCoord)),s.release())})}};function xa(n){return n?Array.isArray(n)?function(t){return n}:"function"==typeof n?n:function(t){return[n]}:null}const va=class Iu extends re{constructor(t){super(),this.projection=Pt(t.projection),this.attributions_=xa(t.attributions),this.attributionsCollapsible_=void 0===t.attributionsCollapsible||t.attributionsCollapsible,this.loading=!1,this.state_=void 0!==t.state?t.state:"ready",this.wrapX_=void 0!==t.wrapX&&t.wrapX,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(i,s){e.viewResolver=i,e.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=xa(t),this.changed()}setState(t){this.state_=t,this.changed()}},Ii=[0,0,0],Ca=class Mu{constructor(t){let e;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,tt(function cl(n,t,e){const i=t||We;return n.every(function(s,r){if(0===r)return!0;const a=i(n[r-1],s);return!(a>0||e&&0===a)})}(this.resolutions_,function(s,r){return r-s},!0),17),!t.origins)for(let s=0,r=this.resolutions_.length-1;s<r;++s)if(e){if(this.resolutions_[s]/this.resolutions_[s+1]!==e){e=void 0;break}}else e=this.resolutions_[s]/this.resolutions_[s+1];this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,tt(this.origins_.length==this.resolutions_.length,20));const i=t.extent;void 0!==i&&!this.origin_&&!this.origins_&&(this.origin_=je(i)),tt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,tt(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:Cs,tt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==i?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map(function(s,r){const a=new _a(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(i){const l=this.getTileRangeForExtentAndZ(i,r);a.minX=Math.max(l.minX,a.minX),a.maxX=Math.min(l.maxX,a.maxX),a.minY=Math.max(l.minY,a.minY),a.maxY=Math.min(l.maxY,a.maxY)}return a},this):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const s=this.getTileRangeForExtentAndZ(t,e);for(let r=s.minX,a=s.maxX;r<=a;++r)for(let l=s.minY,c=s.maxY;l<=c;++l)i([e,r,l])}forEachTileCoordParentTileRange(t,e,i,s){let r,a,l,c=null,h=t[0]-1;for(2===this.zoomFactor_?(a=t[1],l=t[2]):c=this.getTileCoordExtent(t,s);h>=this.minZoom;){if(2===this.zoomFactor_?(a=Math.floor(a/2),l=Math.floor(l/2),r=Si(a,a,l,l,i)):r=this.getTileRangeForExtentAndZ(c,h,i),e(h,r))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){const r=2*t[1],a=2*t[2];return Si(r,r+1,a,a+1,e)}const s=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const s=t[0],r=t[1],a=t[2];if(e===s)return Si(r,a,r,a,i);if(this.zoomFactor_){const c=Math.pow(this.zoomFactor_,e-s),h=Math.floor(r*c),u=Math.floor(a*c);return e<s?Si(h,h,u,u,i):Si(h,Math.floor(c*(r+1))-1,u,Math.floor(c*(a+1))-1,i)}const l=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(l,e,i)}getTileRangeForExtentAndZ(t,e,i){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,Ii);const s=Ii[1],r=Ii[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,Ii),Si(s,Ii[1],r,Ii[2],i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),s=Bt(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*s[0]*i,e[1]-(t[2]+.5)*s[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),s=this.getResolution(t[0]),r=Bt(this.getTileSize(t[0]),this.tmpSize_),a=i[0]+t[1]*r[0]*s,l=i[1]-(t[2]+1)*r[1]*s;return ge(a,l,a+r[0]*s,l+r[1]*s,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,s,r){const a=this.getZForResolution(i),l=i/this.getResolution(a),c=this.getOrigin(a),h=Bt(this.getTileSize(a),this.tmpSize_);let u=l*(t-c[0])/i/h[0],d=l*(c[1]-e)/i/h[1];return s?(u=Mn(u,5)-1,d=Mn(d,5)-1):(u=In(u,5),d=In(d,5)),ma(a,u,d,r)}getTileCoordForXYAndZ_(t,e,i,s,r){const a=this.getOrigin(i),l=this.getResolution(i),c=Bt(this.getTileSize(i),this.tmpSize_);let h=(t-a[0])/l/c[0],u=(a[1]-e)/l/c[1];return s?(h=Mn(h,5)-1,u=Mn(u,5)-1):(h=In(h,5),u=In(u,5)),ma(i,h,u,r)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){return Et(ds(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return Uo(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let s=this.minZoom;s<e;++s)i[s]=this.getTileRangeForExtentAndZ(t,s);this.fullTileRanges_=i}};function Ea(n){let t=n.getDefaultTileGrid();return t||(t=function Ou(n,t,e,i){return function Pu(n,t,e,i){i=void 0!==i?i:"top-left";const s=Ta(n,t,e);return new Ca({extent:n,origin:Pl(n,i),resolutions:s,tileSize:e})}(cr(n),t,e,i)}(n),n.setDefaultTileGrid(t)),t}function Ta(n,t,e,i){t=void 0!==t?t:Yl,e=Bt(void 0!==e?e:Cs);const s=$t(n),r=_t(n);i=i>0?i:Math.max(r/e[0],s/e[1]);const a=t+1,l=new Array(a);for(let c=0;c<a;++c)l[c]=i/Math.pow(2,c);return l}function cr(n){let t=(n=Pt(n)).getExtent();if(!t){const e=180*qe.degrees/n.getMetersPerUnit();t=ge(-e,-e,e,e)}return t}class Du extends ue{constructor(t,e){super(t),this.tile=e}}const ku=class Fu extends va{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.opaque_=void 0!==t.opaque&&t.opaque,this.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,this.tileGrid=void 0!==t.tileGrid?t.tileGrid:null,this.tileGrid&&Bt(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),[256,256]),this.tileCache=new ya(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const i=this.getTileCacheForProjection(t);i&&i.expireCache(e)}forEachLoadedTile(t,e,i,s){const r=this.getTileCacheForProjection(t);if(!r)return!1;let l,c,h,a=!0;for(let u=i.minX;u<=i.maxX;++u)for(let d=i.minY;d<=i.maxY;++d)c=en(e,u,d),h=!1,r.containsKey(c)&&(l=r.get(c),h=2===l.getState(),h&&(h=!1!==s(l))),h||(a=!1);return a}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,i,s,r){return ot()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Ea(t)}getTileCacheForProjection(t){const e=this.getProjection();return tt(null===e||xi(e,t),68),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const s=this.getTileGridForProjection(i),r=this.getTilePixelRatio(e),a=Bt(s.getTileSize(t),this.tmpSize);return 1==r?a:function Jh(n,t,e){return void 0===e&&(e=[0,0]),e[0]=n[0]*t+.5|0,e[1]=n[1]*t+.5|0,e}(a,r,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=void 0!==e?e:this.getProjection();const i=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=function Au(n,t,e){const i=t[0],s=n.getTileCoordCenter(t),r=cr(e);if(!vn(r,s)){const a=_t(r),l=Math.ceil((r[0]-s[0])/a);return s[0]+=a*l,n.getTileCoordForCoordAndZ(s,i)}return t}(i,t,e)),function Ru(n,t){const e=n[0],i=n[1],s=n[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const r=t.getFullTileRange(e);return!r||r.containsXY(i,s)}(t,i)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const i=this.getTileCacheForProjection(e);t>i.highWaterMark&&(i.highWaterMark=t)}useTile(t,e,i,s){}};function Zu(n,t){const e=/\{z\}/g,i=/\{x\}/g,s=/\{y\}/g,r=/\{-y\}/g;return function(a,l,c){if(a)return n.replace(e,a[0].toString()).replace(i,a[1].toString()).replace(s,a[2].toString()).replace(r,function(){const u=t.getFullTileRange(a[0]);return tt(u,55),(u.getHeight()-a[2]-1).toString()})}}class hr extends ku{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===hr.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=ct(e),s=e.getState();let r;1==s?(this.tileLoadingKeys_[i]=!0,r="tileloadstart"):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=3==s?"tileloaderror":2==s?"tileloadend":void 0),null!=r&&this.dispatchEvent(new Du(r,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=function Uu(n){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(n);if(e){const i=e[1].charCodeAt(0),s=e[2].charCodeAt(0);let r;for(r=i;r<=s;++r)t.push(n.replace(e[0],String.fromCharCode(r)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(n),e){const i=parseInt(e[2],10);for(let s=parseInt(e[1],10);s<=i;s++)t.push(n.replace(e[0],s.toString()));return t}return t.push(n),t}(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(function Nu(n,t){const e=n.length,i=new Array(e);for(let s=0;s<e;++s)i[s]=Zu(n[s],t);return function Gu(n){return 1===n.length?n[0]:function(t,e,i){if(!t)return;const s=function wu(n){return(n[1]<<n[0])+n[2]}(t),r=mi(s,n.length);return n[r](t,e,i)}}(i)}(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}useTile(t,e,i){const s=en(t,e,i);this.tileCache.containsKey(s)&&this.tileCache.get(s)}}const zu=hr;function Xu(n,t){n.getImage().src=t}const Wu=class Yu extends zu{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Xu,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:void 0===t.interpolate||t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,this.tileClass=void 0!==t.tileClass?t.tileClass:ha,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(const s in this.tileCacheForProjection){const r=this.tileCacheForProjection[s];r.expireCache(r==i?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!xi(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return!(this.getProjection()&&t&&!xi(this.getProjection(),t))&&super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||xi(e,t)))return this.tileGrid;const i=ct(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Ea(t)),this.tileGridForProjection[i]}getTileCacheForProjection(t){const e=this.getProjection();if(!e||xi(e,t))return this.tileCache;const i=ct(t);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new ya(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(t,e,i,s,r,a){const l=[t,e,i],c=this.getTileCoordForTileUrlFunction(l,r),h=c?this.tileUrlFunction(c,s,r):void 0,u=new this.tileClass(l,void 0!==h?0:4,void 0!==h?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return u.key=a,u.addEventListener(V.CHANGE,this.handleTileChange.bind(this)),u}getTile(t,e,i,s,r){const a=this.getProjection();if(!a||!r||xi(a,r))return this.getTileInternal(t,e,i,s,a||r);const l=this.getTileCacheForProjection(r),c=[t,e,i];let h;const u=pa(c);l.containsKey(u)&&(h=l.get(u));const d=this.getKey();if(h&&h.key==d)return h;const g=this.getTileGridForProjection(a),f=this.getTileGridForProjection(r),_=this.getTileCoordForTileUrlFunction(c,r),m=new ar(a,g,r,f,c,_,this.getTilePixelRatio(s),this.getGutter(),(p,x,v,E)=>this.getTileInternal(p,x,v,E,a),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return m.key=d,h?(m.interimTile=h,m.refreshInterimChain(),l.replace(u,m)):l.set(u,m),m}getTileInternal(t,e,i,s,r){let a=null;const l=en(t,e,i),c=this.getKey();if(this.tileCache.containsKey(l)){if(a=this.tileCache.get(l),a.key!=c){const h=a;a=this.createTile_(t,e,i,s,r,c),a.interimTile=0==h.getState()?h.interimTile:h,a.refreshInterimChain(),this.tileCache.replace(l,a)}}else a=this.createTile_(t,e,i,s,r,c),this.tileCache.set(l,a);return a}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){const i=Pt(t);if(i){const s=ct(i);s in this.tileGridForProjection||(this.tileGridForProjection[s]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}},ju=class Bu extends Wu{constructor(t){const e=void 0!==(t=t||{}).projection?t.projection:"EPSG:3857",i=void 0!==t.tileGrid?t.tileGrid:function Lu(n){const t=n||{},e=t.extent||Pt("EPSG:3857").getExtent(),i={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:Ta(e,t.maxZoom,t.tileSize,t.maxResolution)};return new Ca(i)}({extent:cr(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=void 0!==t.gutter?t.gutter:0}getGutter(){return this.gutter_}},Vu=class Ku extends ju{constructor(t){let e;e=void 0!==(t=t||{}).attributions?t.attributions:['&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.'],super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:void 0!==t.crossOrigin?t.crossOrigin:"anonymous",interpolate:t.interpolate,maxZoom:void 0!==t.maxZoom?t.maxZoom:19,opaque:void 0===t.opaque||t.opaque,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:void 0!==t.url?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",wrapX:t.wrapX,zDirection:t.zDirection})}};var ba=N(2402);class ur{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=Bt(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new ur({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return ot()}getImage(t){return ot()}getHitDetectionImage(){return ot()}getPixelRatio(t){return 1}getImageState(){return ot()}getImageSize(){return ot()}getOrigin(){return ot()}getSize(){return ot()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Bt(t)}listenImageChange(t){ot()}load(){ot()}unlistenImageChange(t){ot()}}const wa=ur;function le(n){return Array.isArray(n)?eo(n):n}class dr extends wa{constructor(t){super({opacity:1,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=void 0!==t.fill?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=void 0!==t.radius?t.radius:t.radius1,this.radius2_=t.radius2,this.angle_=void 0!==t.angle?t.angle:0,this.stroke_=void 0!==t.stroke?t.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const t=this.getScale(),e=new dr({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_;if(!t)return null;const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(t){let e=this.canvas_[t];if(!e){const i=this.renderOptions_,s=Ft(i.size*t,i.size*t);this.draw_(i,s,t),e=s.canvas,this.canvas_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return Ct_LOADED}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(0===e||this.points_===1/0||"bevel"!==t&&"miter"!==t)return e;let s=this.radius_,r=void 0===this.radius2_?s:this.radius2_;if(s<r){const R=s;s=r,r=R}const l=2*Math.PI/(void 0===this.radius2_?this.points_:2*this.points_),c=r*Math.sin(l),u=s-Math.sqrt(r*r-c*c),d=Math.sqrt(c*c+u*u),g=d/c;if("miter"===t&&g<=i)return g*e;const f=e/2/g,_=e/2*(u/d),p=Math.sqrt((s+f)*(s+f)+_*_)-s;if(void 0===this.radius2_||"bevel"===t)return 2*p;const x=s*Math.sin(l),E=r-Math.sqrt(s*s-x*x),b=Math.sqrt(x*x+E*E)/x;return b<=i?2*Math.max(p,b*e/2-r-s):2*p}createRenderOptions(){let r,t=Ei,e=0,i=null,s=0,a=0;this.stroke_&&(r=this.stroke_.getColor(),null===r&&(r=Hi),r=le(r),a=this.stroke_.getWidth(),void 0===a&&(a=1),i=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset(),t=this.stroke_.getLineJoin(),void 0===t&&(t=Ei),e=this.stroke_.getMiterLimit(),void 0===e&&(e=10));const l=this.calculateLineJoinSize_(t,a,e),c=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:r,strokeWidth:a,size:Math.ceil(2*c+l),lineDash:i,lineDashOffset:s,lineJoin:t,miterLimit:e}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let s=this.fill_.getColor();null===s&&(s=_e),e.fillStyle=le(s),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){if(this.fill_){let e=this.fill_.getColor(),i=0;if("string"==typeof e&&(e=An(e)),null===e?i=1:Array.isArray(e)&&(i=4===e.length?e[3]:1),0===i){const s=Ft(t.size,t.size);this.hitDetectionCanvas_=s.canvas,this.drawHitDetectionCanvas_(t,s)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(t){let e=this.points_;const i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const s=void 0===this.radius2_?i:this.radius2_;void 0!==this.radius2_&&(e*=2);const r=this.angle_-Math.PI/2,a=2*Math.PI/e;for(let l=0;l<e;l++){const c=r+l*a,h=l%2==0?i:s;t.lineTo(h*Math.cos(c),h*Math.sin(c))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=_e,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}}const Ra=dr;class gr extends Ra{constructor(t){super({points:1/0,fill:(t=t||{radius:5}).fill,radius:t.radius,stroke:t.stroke,scale:void 0!==t.scale?t.scale:1,rotation:void 0!==t.rotation?t.rotation:0,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new gr({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}const fr=gr;class _r{constructor(t){this.color_=void 0!==(t=t||{}).color?t.color:null}clone(){const t=this.getColor();return new _r({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){this.color_=t}}const ni=_r;class mr{constructor(t){this.color_=void 0!==(t=t||{}).color?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=void 0!==t.lineDash?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new mr({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}const Mi=mr;class Le{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Sa,void 0!==t.geometry&&this.setGeometry(t.geometry),this.fill_=void 0!==t.fill?t.fill:null,this.image_=void 0!==t.image?t.image:null,this.renderer_=void 0!==t.renderer?t.renderer:null,this.hitDetectionRenderer_=void 0!==t.hitDetectionRenderer?t.hitDetectionRenderer:null,this.stroke_=void 0!==t.stroke?t.stroke:null,this.text_=void 0!==t.text?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&"object"==typeof t&&(t=t.clone()),new Le({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Sa,this.geometry_=t}setZIndex(t){this.zIndex_=t}}let pr=null;function Ju(n,t){if(!pr){const e=new ni({color:"rgba(255,255,255,0.4)"}),i=new Mi({color:"#3399CC",width:1.25});pr=[new Le({image:new fr({fill:e,stroke:i,radius:5}),fill:e,stroke:i})]}return pr}function Sa(n){return n.getGeometry()}const si=Le;let nn=null;class Qu extends _n{constructor(t,e,i,s,r,a){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=s,this.canvas_={},this.color_=a,this.unlisten_=null,this.imageState_=r,this.size_=i,this.src_=e}initializeImage_(){this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(void 0===this.tainted_&&this.imageState_===Ct_LOADED){nn||(nn=Ft(1,1,void 0,{willReadFrequently:!0})),nn.drawImage(this.image_,0,0);try{nn.getImageData(0,0,1,1),this.tainted_=!1}catch{nn=null,this.tainted_=!0}}return!0===this.tainted_}dispatchChangeEvent_(){this.dispatchEvent(V.CHANGE)}handleImageError_(){this.imageState_=Ct_ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=Ct_LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=Ft(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===Ct_IDLE){this.image_||this.initializeImage_(),this.imageState_=Ct_LOADING;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=sr(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==Ct_LOADED)return;const e=this.image_,i=document.createElement("canvas");i.width=Math.ceil(e.width*t),i.height=Math.ceil(e.height*t);const s=i.getContext("2d");s.scale(t,t),s.drawImage(e,0,0),s.globalCompositeOperation="multiply",s.fillStyle=Qr(this.color_),s.fillRect(0,0,i.width/t,i.height/t),s.globalCompositeOperation="destination-in",s.drawImage(e,0,0),this.canvas_[t]=i}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function Ia(n,t,e,i){return void 0!==e&&void 0!==i?[e/n,i/t]:void 0!==e?e/n:void 0!==i?i/t:1}class yr extends wa{constructor(t){super({opacity:void 0!==(t=t||{}).opacity?t.opacity:1,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,displacement:void 0!==t.displacement?t.displacement:[0,0],rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,declutterMode:t.declutterMode}),this.anchor_=void 0!==t.anchor?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==t.anchorOrigin?t.anchorOrigin:"top-left",this.anchorXUnits_=void 0!==t.anchorXUnits?t.anchorXUnits:"fraction",this.anchorYUnits_=void 0!==t.anchorYUnits?t.anchorYUnits:"fraction",this.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:null;const a=void 0!==t.img?t.img:null;this.imgSize_=t.imgSize;let l=t.src;tt(!(void 0!==l&&a),4),tt(!a||a&&this.imgSize_,5),(void 0===l||0===l.length)&&a&&(l=a.src||ct(a)),tt(void 0!==l&&l.length>0,6),tt(!((void 0!==t.width||void 0!==t.height)&&void 0!==t.scale),69);const c=void 0!==t.src?Ct_IDLE:Ct_LOADED;if(this.color_=void 0!==t.color?An(t.color):null,this.iconImage_=function $u(n,t,e,i,s,r){let a=Pn.get(t,i,r);return a||(a=new Qu(n,t,e,i,s,r),Pn.set(t,i,r,a)),a}(a,l,void 0!==this.imgSize_?this.imgSize_:null,this.crossOrigin_,c,this.color_),this.offset_=void 0!==t.offset?t.offset:[0,0],this.offsetOrigin_=void 0!==t.offsetOrigin?t.offsetOrigin:"top-left",this.origin_=null,this.size_=void 0!==t.size?t.size:null,void 0!==t.width||void 0!==t.height){let h,u;if(t.size)[h,u]=t.size;else{const d=this.getImage(1);if(!(d instanceof HTMLCanvasElement||d.src&&d.complete)){this.initialOptions_=t;const g=()=>{if(this.unlistenImageChange(g),!this.initialOptions_)return;const f=this.iconImage_.getSize();this.setScale(Ia(f[0],f[1],t.width,t.height))};return void this.listenImageChange(g)}h=d.width,u=d.height}void 0!==h&&this.setScale(Ia(h,u,t.width,t.height))}}clone(){let t,e,i;return this.initialOptions_?(e=this.initialOptions_.width,i=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new yr({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:i,size:null!==this.size_?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const s=this.getSize();if("fraction"==this.anchorXUnits_||"fraction"==this.anchorYUnits_){if(!s)return null;t=this.anchor_.slice(),"fraction"==this.anchorXUnits_&&(t[0]*=s[0]),"fraction"==this.anchorYUnits_&&(t[1]*=s[1])}if("top-left"!=this.anchorOrigin_){if(!s)return null;t===this.anchor_&&(t=this.anchor_.slice()),("top-right"==this.anchorOrigin_||"bottom-right"==this.anchorOrigin_)&&(t[0]=-t[0]+s[0]),("bottom-left"==this.anchorOrigin_||"bottom-right"==this.anchorOrigin_)&&(t[1]=-t[1]+s[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if("top-left"!=this.offsetOrigin_){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),("top-right"==this.offsetOrigin_||"bottom-right"==this.offsetOrigin_)&&(t[0]=i[0]-e[0]-t[0]),("bottom-left"==this.offsetOrigin_||"bottom-right"==this.offsetOrigin_)&&(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();return this.size_?this.size_[0]*t[0]:this.iconImage_.getImageState()==Ct_LOADED?this.iconImage_.getSize()[0]*t[0]:void 0}getHeight(){const t=this.getScaleArray();return this.size_?this.size_[1]*t[1]:this.iconImage_.getImageState()==Ct_LOADED?this.iconImage_.getSize()[1]*t[1]:void 0}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(V.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(V.CHANGE,t)}}const sn=yr;class xr{constructor(t){this.font_=(t=t||{}).font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=Bt(void 0!==t.scale?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=void 0!==t.fill?t.fill:new ni({color:"#333"}),this.maxAngle_=void 0!==t.maxAngle?t.maxAngle:Math.PI/4,this.placement_=void 0!==t.placement?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=void 0!==t.stroke?t.stroke:null,this.offsetX_=void 0!==t.offsetX?t.offsetX:0,this.offsetY_=void 0!==t.offsetY?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=void 0===t.padding?null:t.padding}clone(){const t=this.getScale();return new xr({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Bt(void 0!==t?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}const ts=xr;function Ma(n){return new si({fill:rn(n,""),stroke:on(n,""),text:ed(n),image:id(n)})}function rn(n,t){const e=n[t+"fill-color"];if(e)return new ni({color:e})}function on(n,t){const e=n[t+"stroke-width"],i=n[t+"stroke-color"];if(e||i)return new Mi({width:e,color:i,lineCap:n[t+"stroke-line-cap"],lineJoin:n[t+"stroke-line-join"],lineDash:n[t+"stroke-line-dash"],lineDashOffset:n[t+"stroke-line-dash-offset"],miterLimit:n[t+"stroke-miter-limit"]})}function ed(n){const t=n["text-value"];return t?new ts({text:t,font:n["text-font"],maxAngle:n["text-max-angle"],offsetX:n["text-offset-x"],offsetY:n["text-offset-y"],overflow:n["text-overflow"],placement:n["text-placement"],repeat:n["text-repeat"],scale:n["text-scale"],rotateWithView:n["text-rotate-with-view"],rotation:n["text-rotation"],textAlign:n["text-align"],justify:n["text-justify"],textBaseline:n["text-baseline"],padding:n["text-padding"],fill:rn(n,"text-"),backgroundFill:rn(n,"text-background-"),stroke:on(n,"text-"),backgroundStroke:on(n,"text-background-")}):void 0}function id(n){const t=n["icon-src"],e=n["icon-img"];if(t||e)return new sn({src:t,img:e,imgSize:n["icon-img-size"],anchor:n["icon-anchor"],anchorOrigin:n["icon-anchor-origin"],anchorXUnits:n["icon-anchor-x-units"],anchorYUnits:n["icon-anchor-y-units"],color:n["icon-color"],crossOrigin:n["icon-cross-origin"],offset:n["icon-offset"],displacement:n["icon-displacement"],opacity:n["icon-opacity"],scale:n["icon-scale"],width:n["icon-width"],height:n["icon-height"],rotation:n["icon-rotation"],rotateWithView:n["icon-rotate-with-view"],size:n["icon-size"],declutterMode:n["icon-declutter-mode"]});const i=n["shape-points"];if(i){const r="shape-";return new Ra({points:i,fill:rn(n,r),stroke:on(n,r),radius:n["shape-radius"],radius1:n["shape-radius1"],radius2:n["shape-radius2"],angle:n["shape-angle"],displacement:n["shape-displacement"],rotation:n["shape-rotation"],rotateWithView:n["shape-rotate-with-view"],scale:n["shape-scale"],declutterMode:n["shape-declutter-mode"]})}const s=n["circle-radius"];if(s){const r="circle-";return new fr({radius:s,fill:rn(n,r),stroke:on(n,r),displacement:n["circle-displacement"],scale:n["circle-scale"],rotation:n["circle-rotation"],rotateWithView:n["circle-rotate-with-view"],declutterMode:n["circle-declutter-mode"]})}}const sd=class nd extends Xn{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=void 0!==t.declutter&&t.declutter,this.renderBuffer_=void 0!==t.renderBuffer?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=void 0!==t.updateWhileAnimating&&t.updateWhileAnimating,this.updateWhileInteracting_=void 0!==t.updateWhileInteracting&&t.updateWhileInteracting}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get("renderOrder")}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t){t.declutterTree||(t.declutterTree=new ba(9)),this.getRenderer().renderDeclutter(t)}setRenderOrder(t){this.set("renderOrder",t)}setStyle(t){let e;if(void 0===t)e=Ju;else if(null===t)e=null;else if("function"==typeof t)e=t;else if(t instanceof si)e=t;else if(Array.isArray(t)){const i=t.length,s=new Array(i);for(let r=0;r<i;++r){const a=t[r];s[r]=a instanceof si?a:Ma(a)}e=s}else e=Ma(t);this.style_=e,this.styleFunction_=null===t?void 0:function Hu(n){let t;if("function"==typeof n)t=n;else{let e;Array.isArray(n)?e=n:(tt("function"==typeof n.getZIndex,41),e=[n]),t=function(){return e}}return t}(this.style_),this.changed()}},an={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},es=[an.FILL],Oe=[an.STROKE],ri=[an.BEGIN_PATH],Pa=[an.CLOSE_PATH],Y=an,La=class rd{drawCustom(t,e,i,s){}drawGeometry(t){}setStyle(t){}drawCircle(t,e){}drawFeature(t,e){}drawGeometryCollection(t,e){}drawLineString(t,e){}drawMultiLineString(t,e){}drawMultiPoint(t,e){}drawMultiPolygon(t,e){}drawPoint(t,e){}drawPolygon(t,e){}drawText(t,e){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}},ln=class od extends La{constructor(t,e,i,s){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return 1==e?t:t.map(function(i){return i*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,r=this.coordinates;let a=r.length;for(let l=0,c=t.length;l<c;l+=e)s[0]=t[l],s[1]=t[l+1],vn(i,s)&&(r[a++]=s[0],r[a++]=s[1]);return a}appendFlatLineCoordinates(t,e,i,s,r,a){const l=this.coordinates;let c=l.length;const h=this.getBufferedMaxExtent();a&&(e+=s);let u=t[e],d=t[e+1];const g=this.tmpCoordinate_;let _,m,p,f=!0;for(_=e+s;_<i;_+=s)g[0]=t[_],g[1]=t[_+1],p=ys(h,g),p!==m?(f&&(l[c++]=u,l[c++]=d,f=!1),l[c++]=g[0],l[c++]=g[1]):p===St.INTERSECTING?(l[c++]=g[0],l[c++]=g[1],f=!1):f=!0,u=g[0],d=g[1],m=p;return(r&&f||_===e+s)&&(l[c++]=u,l[c++]=d),c}drawCustomCoordinates_(t,e,i,s,r){for(let a=0,l=i.length;a<l;++a){const c=i[a],h=this.appendFlatLineCoordinates(t,e,c,s,!1,!1);r.push(h),e=c}return e}drawCustom(t,e,i,s){this.beginGeometry(t,e);const r=t.getType(),a=t.getStride(),l=this.coordinates.length;let c,h,u,d,g;switch(r){case"MultiPolygon":c=t.getOrientedFlatCoordinates(),d=[];const f=t.getEndss();g=0;for(let _=0,m=f.length;_<m;++_){const p=[];g=this.drawCustomCoordinates_(c,g,f[_],a,p),d.push(p)}this.instructions.push([Y.CUSTOM,l,d,t,i,Do]),this.hitDetectionInstructions.push([Y.CUSTOM,l,d,t,s||i,Do]);break;case"Polygon":case"MultiLineString":u=[],c="Polygon"==r?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),g=this.drawCustomCoordinates_(c,0,t.getEnds(),a,u),this.instructions.push([Y.CUSTOM,l,u,t,i,Gn]),this.hitDetectionInstructions.push([Y.CUSTOM,l,u,t,s||i,Gn]);break;case"LineString":case"Circle":c=t.getFlatCoordinates(),h=this.appendFlatLineCoordinates(c,0,c.length,a,!1,!1),this.instructions.push([Y.CUSTOM,l,h,t,i,Ci]),this.hitDetectionInstructions.push([Y.CUSTOM,l,h,t,s||i,Ci]);break;case"MultiPoint":c=t.getFlatCoordinates(),h=this.appendFlatPointCoordinates(c,a),h>l&&(this.instructions.push([Y.CUSTOM,l,h,t,i,Ci]),this.hitDetectionInstructions.push([Y.CUSTOM,l,h,t,s||i,Ci]));break;case"Point":c=t.getFlatCoordinates(),this.coordinates.push(c[0],c[1]),h=this.coordinates.length,this.instructions.push([Y.CUSTOM,l,h,t,i]),this.hitDetectionInstructions.push([Y.CUSTOM,l,h,t,s||i])}this.endGeometry(e)}beginGeometry(t,e){this.beginGeometryInstruction1_=[Y.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Y.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;let e;t.reverse();const i=t.length;let s,r,a=-1;for(e=0;e<i;++e)s=t[e],r=s[0],r==Y.END_GEOMETRY?a=e:r==Y.BEGIN_GEOMETRY&&(s[2]=e,ll(this.hitDetectionInstructions,a,e),a=-1)}setFillStrokeStyle(t,e){const i=this.state;if(t){const s=t.getColor();i.fillStyle=le(s||_e)}else i.fillStyle=void 0;if(e){const s=e.getColor();i.strokeStyle=le(s||Hi);const r=e.getLineCap();i.lineCap=void 0!==r?r:qn;const a=e.getLineDash();i.lineDash=a?a.slice():qi;const l=e.getLineDashOffset();i.lineDashOffset=l||0;const c=e.getLineJoin();i.lineJoin=void 0!==c?c:Ei;const h=e.getWidth();i.lineWidth=void 0!==h?h:1;const u=e.getMiterLimit();i.miterLimit=void 0!==u?u:10,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){const e=t.fillStyle,i=[Y.SET_FILL_STYLE,e];return"string"!=typeof e&&i.push(!0),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[Y.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;("string"!=typeof i||t.currentFillStyle!=i)&&(void 0!==i&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,s=t.lineCap,r=t.lineDash,a=t.lineDashOffset,l=t.lineJoin,c=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=s||r!=t.currentLineDash&&!we(t.currentLineDash,r)||t.currentLineDashOffset!=a||t.currentLineJoin!=l||t.currentLineWidth!=c||t.currentMiterLimit!=h)&&(void 0!==i&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=s,t.currentLineDash=r,t.currentLineDashOffset=a,t.currentLineJoin=l,t.currentLineWidth=c,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[Y.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){return!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Xr(this.maxExtent),this.maxLineWidth>0)&&ps(this.bufferedMaxExtent_,this.resolution*(this.maxLineWidth+1)/2,this.bufferedMaxExtent_),this.bufferedMaxExtent_}},Oa=class ud extends ln{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinatess_(t,e,i,s){const r=this.state,a=void 0!==r.fillStyle,l=void 0!==r.strokeStyle,c=i.length;this.instructions.push(ri),this.hitDetectionInstructions.push(ri);for(let h=0;h<c;++h){const u=i[h],d=this.coordinates.length,g=this.appendFlatLineCoordinates(t,e,u,s,!0,!l),f=[Y.MOVE_TO_LINE_TO,d,g];this.instructions.push(f),this.hitDetectionInstructions.push(f),l&&(this.instructions.push(Pa),this.hitDetectionInstructions.push(Pa)),e=u}return a&&(this.instructions.push(es),this.hitDetectionInstructions.push(es)),l&&(this.instructions.push(Oe),this.hitDetectionInstructions.push(Oe)),e}drawCircle(t,e){const i=this.state;if(void 0===i.fillStyle&&void 0===i.strokeStyle)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([Y.SET_FILL_STYLE,_e]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([Y.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const a=t.getFlatCoordinates(),l=t.getStride(),c=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const h=[Y.CIRCLE,c];this.instructions.push(ri,h),this.hitDetectionInstructions.push(ri,h),void 0!==i.fillStyle&&(this.instructions.push(es),this.hitDetectionInstructions.push(es)),void 0!==i.strokeStyle&&(this.instructions.push(Oe),this.hitDetectionInstructions.push(Oe)),this.endGeometry(e)}drawPolygon(t,e){const i=this.state;if(void 0===i.fillStyle&&void 0===i.strokeStyle)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([Y.SET_FILL_STYLE,_e]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([Y.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const a=t.getEnds(),l=t.getOrientedFlatCoordinates(),c=t.getStride();this.drawFlatCoordinatess_(l,0,a,c),this.endGeometry(e)}drawMultiPolygon(t,e){const i=this.state;if(void 0===i.fillStyle&&void 0===i.strokeStyle)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([Y.SET_FILL_STYLE,_e]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([Y.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const a=t.getEndss(),l=t.getOrientedFlatCoordinates(),c=t.getStride();let h=0;for(let u=0,d=a.length;u<d;++u)h=this.drawFlatCoordinatess_(l,h,a[u],c);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(0!==t){const e=this.coordinates;for(let i=0,s=e.length;i<s;++i)e[i]=Qe(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)}};function dd(n,t,e,i,s){const r=[];let a=e,l=0,c=t.slice(e,2);for(;l<n&&a+s<i;){const[h,u]=c.slice(-2),d=t[a+s],g=t[a+s+1],f=Math.sqrt((d-h)*(d-h)+(g-u)*(g-u));if(l+=f,l>=n){const _=(n-l+f)/f,m=te(h,d,_),p=te(u,g,_);c.push(m,p),r.push(c),c=[m,p],l==n&&(a+=s),l=0}else if(l<n)c.push(t[a+s],t[a+s+1]),a+=s;else{const _=f-l,m=te(h,d,_/f),p=te(u,g,_/f);c.push(m,p),r.push(c),c=[m,p],l=0,a+=s}}return l>0&&r.push(c),r}function gd(n,t,e,i,s){let u,d,g,f,_,m,p,x,v,E,r=e,a=e,l=0,c=0,h=e;for(d=e;d<i;d+=s){const T=t[d],b=t[d+1];void 0!==_&&(v=T-_,E=b-m,f=Math.sqrt(v*v+E*E),void 0!==p&&(c+=g,u=Math.acos((p*v+x*E)/(g*f)),u>n&&(c>l&&(l=c,r=h,a=d),c=0,h=d-s)),g=f,p=v,x=E),_=T,m=b}return c+=f,c>l?[h,d]:[r,a]}const cn={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},_d={Circle:Oa,Default:ln,Image:class ad extends ln{constructor(t,e,i,s){super(t,e,i,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),s=t.getStride(),r=this.coordinates.length,a=this.appendFlatPointCoordinates(i,s);this.instructions.push([Y.DRAW_IMAGE,r,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Y.DRAW_IMAGE,r,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),s=t.getStride(),r=this.coordinates.length,a=this.appendFlatPointCoordinates(i,s);this.instructions.push([Y.DRAW_IMAGE,r,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Y.DRAW_IMAGE,r,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),s=t.getSize(),r=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=t.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=s[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}},LineString:class cd extends ln{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinates_(t,e,i,s){const r=this.coordinates.length,a=this.appendFlatLineCoordinates(t,e,i,s,!1,!1),l=[Y.MOVE_TO_LINE_TO,r,a];return this.instructions.push(l),this.hitDetectionInstructions.push(l),i}drawLineString(t,e){const i=this.state;if(void 0===i.strokeStyle||void 0===i.lineWidth)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([Y.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,qi,0],ri);const a=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(Oe),this.endGeometry(e)}drawMultiLineString(t,e){const i=this.state;if(void 0===i.strokeStyle||void 0===i.lineWidth)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([Y.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],ri);const a=t.getEnds(),l=t.getFlatCoordinates(),c=t.getStride();let h=0;for(let u=0,d=a.length;u<d;++u)h=this.drawFlatCoordinates_(l,h,a[u],c);this.hitDetectionInstructions.push(Oe),this.endGeometry(e)}finish(){const t=this.state;return null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(Oe),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(Oe),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(ri)}},Polygon:Oa,Text:class fd extends ln{constructor(t,e,i,s){super(t,e,i,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e){const r=this.textState_;if(""===this.text_||!r||!this.textFillState_&&!this.textStrokeState_)return;const a=this.coordinates;let l=a.length;const c=t.getType();let h=null,u=t.getStride();if("line"!==r.placement||"LineString"!=c&&"MultiLineString"!=c&&"Polygon"!=c&&"MultiPolygon"!=c){let d=r.overflow?null:[];switch(c){case"Point":case"MultiPoint":h=t.getFlatCoordinates();break;case"LineString":h=t.getFlatMidpoint();break;case"Circle":h=t.getCenter();break;case"MultiLineString":h=t.getFlatMidpoints(),u=2;break;case"Polygon":h=t.getFlatInteriorPoint(),r.overflow||d.push(h[2]/this.resolution),u=3;break;case"MultiPolygon":const p=t.getFlatInteriorPoints();h=[];for(let x=0,v=p.length;x<v;x+=3)r.overflow||d.push(p[x+2]/this.resolution),h.push(p[x],p[x+1]);if(0===h.length)return;u=2}const g=this.appendFlatPointCoordinates(h,u);if(g===l)return;if(d&&(g-l)/2!=h.length/u){let p=l/2;d=d.filter((x,v)=>{const E=a[2*(p+v)]===h[v*u]&&a[2*(p+v)+1]===h[v*u+1];return E||--p,E})}this.saveTextStates_(),(r.backgroundFill||r.backgroundStroke)&&(this.setFillStrokeStyle(r.backgroundFill,r.backgroundStroke),r.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),r.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);let f=r.padding;if(f!=ei&&(r.scale[0]<0||r.scale[1]<0)){let p=r.padding[0],x=r.padding[1],v=r.padding[2],E=r.padding[3];r.scale[0]<0&&(x=-x,E=-E),r.scale[1]<0&&(p=-p,v=-v),f=[p,x,v,E]}const _=this.pixelRatio;this.instructions.push([Y.DRAW_IMAGE,l,g,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,f==ei?ei:f.map(function(p){return p*_}),!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]);const m=1/_;this.hitDetectionInstructions.push([Y.DRAW_IMAGE,l,g,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[m,m],NaN,void 0,this.declutterImageWithText_,f,!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]),this.endGeometry(e)}else{if(!Nt(this.getBufferedMaxExtent(),t.getExtent()))return;let d;if(h=t.getFlatCoordinates(),"LineString"==c)d=[h.length];else if("MultiLineString"==c)d=t.getEnds();else if("Polygon"==c)d=t.getEnds().slice(0,1);else if("MultiPolygon"==c){const m=t.getEndss();d=[];for(let p=0,x=m.length;p<x;++p)d.push(m[p][0])}this.beginGeometry(t,e);const g=r.repeat,f=g?void 0:r.textAlign;let _=0;for(let m=0,p=d.length;m<p;++m){let x;x=g?dd(g*this.resolution,h,_,d[m],u):[h.slice(_,d[m])];for(let v=0,E=x.length;v<E;++v){const T=x[v];let b=0,R=T.length;if(null==f){const I=gd(r.maxAngle,T,0,T.length,2);b=I[0],R=I[1]}for(let I=b;I<R;I+=u)a.push(T[I],T[I+1]);const P=a.length;_=d[m],this.drawChars_(l,P),l=P}}this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,s=this.strokeKey_;t&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:e.font,textAlign:e.textAlign||Ji,justify:e.justify,textBaseline:e.textBaseline||Kn,scale:e.scale});const a=this.fillKey_;i&&(a in this.fillStates||(this.fillStates[a]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,s=this.textState_,r=this.strokeKey_,a=this.textKey_,l=this.fillKey_;this.saveTextStates_();const c=this.pixelRatio,h=cn[s.textBaseline],u=this.textOffsetY_*c,d=this.text_,g=i?i.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([Y.DRAW_CHARS,t,e,h,s.overflow,l,s.maxAngle,c,u,r,g*c,d,a,1]),this.hitDetectionInstructions.push([Y.DRAW_CHARS,t,e,h,s.overflow,l,s.maxAngle,1,u,r,g,d,a,1/c])}setTextStyle(t,e){let i,s,r;if(t){const a=t.getFill();a?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=le(a.getColor()||_e)):(s=null,this.textFillState_=s);const l=t.getStroke();if(l){r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const _=l.getLineDash(),m=l.getLineDashOffset(),p=l.getWidth(),x=l.getMiterLimit();r.lineCap=l.getLineCap()||qn,r.lineDash=_?_.slice():qi,r.lineDashOffset=void 0===m?0:m,r.lineJoin=l.getLineJoin()||Ei,r.lineWidth=void 0===p?1:p,r.miterLimit=void 0===x?10:x,r.strokeStyle=le(l.getColor()||Hi)}else r=null,this.textStrokeState_=r;i=this.textState_;const c=t.getFont()||Vo;Vc(c);const h=t.getScaleArray();i.overflow=t.getOverflow(),i.font=c,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||Kn,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||ei,i.scale=void 0===h?[1,1]:h;const u=t.getOffsetX(),d=t.getOffsetY(),g=t.getRotateWithView(),f=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===u?0:u,this.textOffsetY_=void 0===d?0:d,this.textRotateWithView_=void 0!==g&&g,this.textRotation_=void 0===f?0:f,this.strokeKey_=r?("string"==typeof r.strokeStyle?r.strokeStyle:ct(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=s?"string"==typeof s.fillStyle?s.fillStyle:"|"+ct(s.fillStyle):""}else this.text_="";this.declutterImageWithText_=e}}},Fa=class md{constructor(t,e,i,s){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=s,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const s in i){const r=i[s].finish();t[e][s]=r}}return t}getBuilder(t,e){const i=void 0!==t?t.toString():"0";let s=this.buildersByZIndex_[i];void 0===s&&(s={},this.buildersByZIndex_[i]=s);let r=s[e];return void 0===r&&(r=new(0,_d[e])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[e]=r),r}};function pd(n,t,e,i,s,r,a,l,c,h,u,d){let g=n[t],f=n[t+1],_=0,m=0,p=0,x=0;function v(){_=g,m=f,g=n[t+=i],f=n[t+1],x+=p,p=Math.sqrt((g-_)*(g-_)+(f-m)*(f-m))}do{v()}while(t<e-i&&x+p<r);let E=0===p?0:(r-x)/p;const T=te(_,g,E),b=te(m,f,E),R=t-i,P=x,I=r+l*c(h,s,u);for(;t<e-i&&x+p<I;)v();E=0===p?0:(I-x)/p;const z=te(_,g,E),X=te(m,f,E);let at;if(d){const k=[T,b,z,X];bo(k,0,4,2,d,k,k),at=k[0]>k[2]}else at=T>z;const st=Math.PI,K=[],bt=R+i===t;let H;if(p=0,x=P,g=n[t=R],f=n[t+1],bt)return v(),H=Math.atan2(f-m,g-_),at&&(H+=H>0?-st:st),K[0]=[(z+T)/2,(X+b)/2,(I-r)/2,H,s],K;for(let k=0,M=(s=s.replace(/\n/g," ")).length;k<M;){v();let Z=Math.atan2(f-m,g-_);if(at&&(Z+=Z>0?-st:st),void 0!==H){let ht=Z-H;if(ht+=ht>st?-2*st:ht<-st?2*st:0,Math.abs(ht)>a)return null}H=Z;const lt=k;let dt=0;for(;k<M;++k){const ft=l*c(h,s[at?M-k-1:k],u);if(t+i<e&&x+p<r+dt+ft/2)break;dt+=ft}if(k===lt)continue;const It=at?s.substring(M-lt,M-k):s.substring(lt,k);E=0===p?0:(r+dt/2-x)/p;const w=te(_,g,E),zt=te(m,f,E);K.push([w,zt,dt/2,Z,It]),r+=dt}return K}function Da(n,t,e,i){let s=n[t],r=n[t+1],a=0;for(let l=t+i;l<e;l+=i){const c=n[l],h=n[l+1];a+=Math.sqrt((c-s)*(c-s)+(h-r)*(h-r)),s=c,r=h}return a}const Ai=[1/0,1/0,-1/0,-1/0],Fe=[],pe=[],ye=[],De=[];function ka(n){return n[3].declutterBox}const yd=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function Za(n,t){return("start"===t||"end"===t)&&!yd.test(n)&&(t="start"===t?"left":"right"),cn[t]}function xd(n,t,e){return e>0&&n.push("\n",""),n.push(t,""),n}const Cd=class vd{constructor(t,e,i,s){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={}}createLabel(t,e,i,s){const r=t+e+i+s;if(this.labels_[r])return this.labels_[r];const a=s?this.strokeStates[s]:null,l=i?this.fillStates[i]:null,c=this.textStates[e],h=this.pixelRatio,u=[c.scale[0]*h,c.scale[1]*h],d=Array.isArray(t),g=c.justify?cn[c.justify]:Za(Array.isArray(t)?t[0]:t,c.textAlign||Ji),f=s&&a.lineWidth?a.lineWidth:0,_=d?t:t.split("\n").reduce(xd,[]),{width:m,height:p,widths:x,heights:v,lineWidths:E}=function Jc(n,t){const e=[],i=[],s=[];let r=0,a=0,l=0,c=0;for(let h=0,u=t.length;h<=u;h+=2){const d=t[h];if("\n"===d||h===u){r=Math.max(r,a),s.push(a),a=0,l+=c;continue}const g=t[h+1]||n.font,f=Vn(g,d);e.push(f),a+=f;const _=Hc(g);i.push(_),c=Math.max(c,_)}return{width:r,height:l,widths:e,heights:i,lineWidths:s}}(c,_),T=m+f,b=[],R=(T+2)*u[0],P=(p+f)*u[1],I={width:R<0?Math.floor(R):Math.ceil(R),height:P<0?Math.floor(P):Math.ceil(P),contextInstructions:b};(1!=u[0]||1!=u[1])&&b.push("scale",u),s&&(b.push("strokeStyle",a.strokeStyle),b.push("lineWidth",f),b.push("lineCap",a.lineCap),b.push("lineJoin",a.lineJoin),b.push("miterLimit",a.miterLimit),b.push("setLineDash",[a.lineDash]),b.push("lineDashOffset",a.lineDashOffset)),i&&b.push("fillStyle",l.fillStyle),b.push("textBaseline","middle"),b.push("textAlign","center");const z=.5-g;let X=g*T+z*f;const at=[],st=[];let M,K=0,bt=0,H=0,k=0;for(let Z=0,lt=_.length;Z<lt;Z+=2){const dt=_[Z];if("\n"===dt){bt+=K,K=0,X=g*T+z*f,++k;continue}const It=_[Z+1]||c.font;It!==M&&(s&&at.push("font",It),i&&st.push("font",It),M=It),K=Math.max(K,v[H]);const w=[dt,X+z*x[H]+g*(x[H]-E[k]),.5*(f+K)+bt];X+=x[H],s&&at.push("strokeText",w),i&&st.push("fillText",w),++H}return Array.prototype.push.apply(b,at),Array.prototype.push.apply(b,st),this.labels_[r]=I,I}replayTextBackground_(t,e,i,s,r,a,l){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,s),t.lineTo.apply(t,r),t.lineTo.apply(t,e),a&&(this.alignFill_=a[2],this.fill_(t)),l&&(this.setStrokeStyle_(t,l),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,s,r,a,l,c,h,u,d,g,f,_,m,p){let x=i-(l*=g[0]),v=s-(c*=g[1]);const E=r+h>t?t-h:r,T=a+u>e?e-u:a,b=_[3]+E*g[0]+_[1],R=_[0]+T*g[1]+_[2],P=x-_[3],I=v-_[0];let z;return(m||0!==d)&&(Fe[0]=P,De[0]=P,Fe[1]=I,pe[1]=I,pe[0]=P+b,ye[0]=pe[0],ye[1]=I+R,De[1]=ye[1]),0!==d?(z=de([1,0,0,1,0,0],i,s,1,1,d,-i,-s),Rt(z,Fe),Rt(z,pe),Rt(z,ye),Rt(z,De),ge(Math.min(Fe[0],pe[0],ye[0],De[0]),Math.min(Fe[1],pe[1],ye[1],De[1]),Math.max(Fe[0],pe[0],ye[0],De[0]),Math.max(Fe[1],pe[1],ye[1],De[1]),Ai)):ge(Math.min(P,P+b),Math.min(I,I+R),Math.max(P,P+b),Math.max(I,I+R),Ai),f&&(x=Math.round(x),v=Math.round(v)),{drawImageX:x,drawImageY:v,drawImageW:E,drawImageH:T,originX:h,originY:u,declutterBox:{minX:Ai[0],minY:Ai[1],maxX:Ai[2],maxY:Ai[3],value:p},canvasTransform:z,scale:g}}replayImageOrLabel_(t,e,i,s,r,a,l){const h=s.declutterBox,u=t.canvas,d=l?l[2]*s.scale[0]/2:0;return h.minX-d<=u.width/e&&h.maxX+d>=0&&h.minY-d<=u.height/e&&h.maxY+d>=0&&(!(!a&&!l)&&this.replayTextBackground_(t,Fe,pe,ye,De,a,l),function Qc(n,t,e,i,s,r,a,l,c,h,u){n.save(),1!==e&&(n.globalAlpha*=e),t&&n.setTransform.apply(n,t),i.contextInstructions?(n.translate(c,h),n.scale(u[0],u[1]),function $c(n,t){const e=n.contextInstructions;for(let i=0,s=e.length;i<s;i+=2)Array.isArray(e[i+1])?t[e[i]].apply(t,e[i+1]):t[e[i]]=e[i+1]}(i,n)):u[0]<0||u[1]<0?(n.translate(c,h),n.scale(u[0],u[1]),n.drawImage(i,s,r,a,l,0,0,a,l)):n.drawImage(i,s,r,a,l,c,h,a*u[0],l*u[1]),n.restore()}(t,s.canvasTransform,r,i,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(t){if(this.alignFill_){const e=Rt(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(e[0]%i,e[1]%i),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,s){const r=this.textStates[e],a=this.createLabel(t,e,s,i),l=this.strokeStates[i],c=this.pixelRatio,h=Za(Array.isArray(t)?t[0]:t,r.textAlign||Ji),u=cn[r.textBaseline||Kn],d=l&&l.lineWidth?l.lineWidth:0;return{label:a,anchorX:h*(a.width/c-2*r.scale[0])+2*(.5-h)*d,anchorY:u*a.height/c+2*(.5-u)*d}}execute_(t,e,i,s,r,a,l,c){let h;this.pixelCoordinates_&&we(i,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=Je(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),function El(n,t){n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5]}(this.renderedTransform_,i));let u=0;const d=s.length;let f,_,m,p,x,v,E,T,b,R,P,I,g=0,z=0,X=0,at=null,st=null;const K=this.coordinateCache_,bt=this.viewRotation_,H=Math.round(1e12*Math.atan2(-i[1],i[0]))/1e12,k={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:bt},M=this.instructions!=s||this.overlaps?0:200;let Z,lt,dt,It;for(;u<d;){const w=s[u];switch(w[0]){case Y.BEGIN_GEOMETRY:Z=w[1],It=w[3],Z.getGeometry()?void 0===l||Nt(l,It.getExtent())?++u:u=w[2]+1:u=w[2];break;case Y.BEGIN_PATH:z>M&&(this.fill_(t),z=0),X>M&&(t.stroke(),X=0),!z&&!X&&(t.beginPath(),p=NaN,x=NaN),++u;break;case Y.CIRCLE:g=w[1];const ht=h[g],ft=h[g+1],Mt=h[g+2]-ht,xe=h[g+3]-ft,Pi=Math.sqrt(Mt*Mt+xe*xe);t.moveTo(ht+Pi,ft),t.arc(ht,ft,Pi,0,2*Math.PI,!0),++u;break;case Y.CLOSE_PATH:t.closePath(),++u;break;case Y.CUSTOM:g=w[1],f=w[2];const Li=w[4],ss=6==w.length?w[5]:void 0;k.geometry=w[3],k.feature=Z,u in K||(K[u]=[]);const Ne=K[u];ss?ss(h,g,f,2,Ne):(Ne[0]=h[g],Ne[1]=h[g+1],Ne.length=2),Li(Ne,k),++u;break;case Y.DRAW_IMAGE:g=w[1],f=w[2],T=w[3],_=w[4],m=w[5];let hn=w[6];const Ge=w[7],rs=w[8],os=w[9],as=w[10];let Oi=w[11];const Rr=w[12];let Gt=w[13];const qt=w[14],se=w[15];if(!T&&w.length>=20){b=w[19],R=w[20],P=w[21],I=w[22];const Yt=this.drawLabelWithPointPlacement_(b,R,P,I);T=Yt.label,w[3]=T,_=(Yt.anchorX-w[23])*this.pixelRatio,w[4]=_,m=(Yt.anchorY-w[24])*this.pixelRatio,w[5]=m,hn=T.height,w[6]=hn,Gt=T.width,w[13]=Gt}let ve,Fi,oi,Ue;w.length>25&&(ve=w[25]),w.length>17?(Fi=w[16],oi=w[17],Ue=w[18]):(Fi=ei,oi=!1,Ue=!1),as&&H?Oi+=bt:!as&&!H&&(Oi-=bt);let Di=0;for(;g<f;g+=2){if(ve&&ve[Di++]<Gt/this.pixelRatio)continue;const Yt=this.calculateImageOrLabelDimensions_(T.width,T.height,h[g],h[g+1],Gt,hn,_,m,rs,os,Oi,Rr,r,Fi,oi||Ue,Z),ki=[t,e,T,Yt,Ge,oi?at:null,Ue?st:null];if(c){if("none"===qt)continue;if("obstacle"===qt){c.insert(Yt.declutterBox);continue}{let Kt,Ce;if(se){const Xt=f-g;if(!se[Xt]){se[Xt]=ki;continue}if(Kt=se[Xt],delete se[Xt],Ce=ka(Kt),c.collides(Ce))continue}if(c.collides(Yt.declutterBox))continue;Kt&&(c.insert(Ce),this.replayImageOrLabel_.apply(this,Kt)),c.insert(Yt.declutterBox)}}this.replayImageOrLabel_.apply(this,ki)}++u;break;case Y.DRAW_CHARS:const ls=w[1],Dt=w[2],Sr=w[3],Yg=w[4];I=w[5];const Xg=w[6],Qa=w[7],$a=w[8];P=w[9];const Ir=w[10];b=w[11],R=w[12];const tl=[w[13],w[13]],Mr=this.textStates[R],un=Mr.font,dn=[Mr.scale[0]*Qa,Mr.scale[1]*Qa];let gn;un in this.widths_?gn=this.widths_[un]:(gn={},this.widths_[un]=gn);const el=Da(h,ls,Dt,2),il=Math.abs(dn[0])*Jo(un,b,gn);if(Yg||il<=el){const Kt=pd(h,ls,Dt,2,b,(el-il)*cn[this.textStates[R].textAlign],Xg,Math.abs(dn[0]),Jo,un,gn,H?0:this.viewRotation_);t:if(Kt){const Ce=[];let Xt,cs,hs,Ut,Vt;if(P)for(Xt=0,cs=Kt.length;Xt<cs;++Xt){Vt=Kt[Xt],hs=Vt[4],Ut=this.createLabel(hs,R,"",P),_=Vt[2]+(dn[0]<0?-Ir:Ir),m=Sr*Ut.height+2*(.5-Sr)*Ir*dn[1]/dn[0]-$a;const Ee=this.calculateImageOrLabelDimensions_(Ut.width,Ut.height,Vt[0],Vt[1],Ut.width,Ut.height,_,m,0,0,Vt[3],tl,!1,ei,!1,Z);if(c&&c.collides(Ee.declutterBox))break t;Ce.push([t,e,Ut,Ee,1,null,null])}if(I)for(Xt=0,cs=Kt.length;Xt<cs;++Xt){Vt=Kt[Xt],hs=Vt[4],Ut=this.createLabel(hs,R,I,""),_=Vt[2],m=Sr*Ut.height-$a;const Ee=this.calculateImageOrLabelDimensions_(Ut.width,Ut.height,Vt[0],Vt[1],Ut.width,Ut.height,_,m,0,0,Vt[3],tl,!1,ei,!1,Z);if(c&&c.collides(Ee.declutterBox))break t;Ce.push([t,e,Ut,Ee,1,null,null])}c&&c.load(Ce.map(ka));for(let Ee=0,Wg=Ce.length;Ee<Wg;++Ee)this.replayImageOrLabel_.apply(this,Ce[Ee])}}++u;break;case Y.END_GEOMETRY:if(void 0!==a){Z=w[1];const Yt=a(Z,It);if(Yt)return Yt}++u;break;case Y.FILL:M?z++:this.fill_(t),++u;break;case Y.MOVE_TO_LINE_TO:for(g=w[1],f=w[2],lt=h[g],dt=h[g+1],v=lt+.5|0,E=dt+.5|0,(v!==p||E!==x)&&(t.moveTo(lt,dt),p=v,x=E),g+=2;g<f;g+=2)lt=h[g],dt=h[g+1],v=lt+.5|0,E=dt+.5|0,(g==f-2||v!==p||E!==x)&&(t.lineTo(lt,dt),p=v,x=E);++u;break;case Y.SET_FILL_STYLE:at=w,this.alignFill_=w[2],z&&(this.fill_(t),z=0,X&&(t.stroke(),X=0)),t.fillStyle=w[1],++u;break;case Y.SET_STROKE_STYLE:st=w,X&&(t.stroke(),X=0),this.setStrokeStyle_(t,w),++u;break;case Y.STROKE:M?X++:t.stroke(),++u;break;default:++u}}z&&this.fill_(t),X&&t.stroke()}execute(t,e,i,s,r,a){this.viewRotation_=s,this.execute_(t,e,i,this.instructions,r,void 0,void 0,a)}executeHitDetection(t,e,i,s,r){return this.viewRotation_=i,this.execute_(t,1,e,this.hitDetectionInstructions,!0,s,r)}},vr=["Polygon","Circle","LineString","Image","Text","Default"],Cr={},Na=class Ed{constructor(t,e,i,s,r,a){this.maxExtent_=t,this.overlaps_=s,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=a,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=[1,0,0,1,0,0],this.createExecutors_(r)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t){for(const e in t){let i=this.executorsByZIndex_[e];void 0===i&&(i={},this.executorsByZIndex_[e]=i);const s=t[e];for(const r in s)i[r]=new Cd(this.resolution_,this.pixelRatio_,this.overlaps_,s[r])}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let s=0,r=t.length;s<r;++s)if(t[s]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,s,r,a){const l=2*(s=Math.round(s))+1,c=de(this.hitDetectionTransform_,s+.5,s+.5,1/e,-1/e,-i,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=Ft(l,l,void 0,{willReadFrequently:!0}));const u=this.hitDetectionContext_;let d;u.canvas.width!==l||u.canvas.height!==l?(u.canvas.width=l,u.canvas.height=l):h||u.clearRect(0,0,l,l),void 0!==this.renderBuffer_&&(d=[1/0,1/0,-1/0,-1/0],di(d,t),ps(d,e*(this.renderBuffer_+s),d));const g=function Td(n){if(void 0!==Cr[n])return Cr[n];const t=2*n+1,e=n*n,i=new Array(e+1);for(let r=0;r<=n;++r)for(let a=0;a<=n;++a){const l=r*r+a*a;if(l>e)break;let c=i[l];c||(c=[],i[l]=c),c.push(4*((n+r)*t+(n+a))+3),r>0&&c.push(4*((n-r)*t+(n+a))+3),a>0&&(c.push(4*((n+r)*t+(n-a))+3),r>0&&c.push(4*((n-r)*t+(n-a))+3))}const s=[];for(let r=0,a=i.length;r<a;++r)i[r]&&s.push(...i[r]);return Cr[n]=s,s}(s);let f;function _(b,R){const P=u.getImageData(0,0,l,l).data;for(let I=0,z=g.length;I<z;I++)if(P[g[I]]>0){if(!a||"Image"!==f&&"Text"!==f||a.includes(b)){const X=(g[I]-3)/4,at=s-X%l,st=s-(X/l|0),K=r(b,R,at*at+st*st);if(K)return K}u.clearRect(0,0,l,l);break}}const m=Object.keys(this.executorsByZIndex_).map(Number);let p,x,v,E,T;for(m.sort(We),p=m.length-1;p>=0;--p){const b=m[p].toString();for(v=this.executorsByZIndex_[b],x=vr.length-1;x>=0;--x)if(f=vr[x],E=v[f],void 0!==E&&(T=E.executeHitDetection(u,c,i,_,d),T))return T}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],s=e[1],r=e[2],a=e[3],l=[i,s,i,a,r,a,r,s];return Je(l,0,8,2,t,l),l}isEmpty(){return Ui(this.executorsByZIndex_)}execute(t,e,i,s,r,a,l){const c=Object.keys(this.executorsByZIndex_).map(Number);let h,u,d,g,f,_;for(c.sort(We),this.maxExtent_&&(t.save(),this.clip(t,i)),a=a||vr,l&&c.reverse(),h=0,u=c.length;h<u;++h){const m=c[h].toString();for(f=this.executorsByZIndex_[m],d=0,g=a.length;d<g;++d)_=f[a[d]],void 0!==_&&_.execute(t,e,i,s,r,l)}this.maxExtent_&&t.restore()}},wd=class bd extends La{constructor(t,e,i,s,r,a,l){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=s,this.transformRotation_=s?Sn(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=a,this.userTransform_=l,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=[1,0,0,1,0,0]}drawImages_(t,e,i,s){if(!this.image_)return;const r=Je(t,e,i,s,this.transform_,this.pixelCoordinates_),a=this.context_,l=this.tmpLocalTransform_,c=a.globalAlpha;1!=this.imageOpacity_&&(a.globalAlpha=c*this.imageOpacity_);let h=this.imageRotation_;0===this.transformRotation_&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let u=0,d=r.length;u<d;u+=2){const g=r[u]-this.imageAnchorX_,f=r[u+1]-this.imageAnchorY_;if(0!==h||1!=this.imageScale_[0]||1!=this.imageScale_[1]){const _=g+this.imageAnchorX_,m=f+this.imageAnchorY_;de(l,_,m,1,1,h,-_,-m),a.setTransform.apply(a,l),a.translate(_,m),a.scale(this.imageScale_[0],this.imageScale_[1]),a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),a.setTransform(1,0,0,1,0,0)}else a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,g,f,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(a.globalAlpha=c)}drawText_(t,e,i,s){if(!this.textState_||""===this.text_)return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=Je(t,e,i,s,this.transform_,this.pixelCoordinates_),a=this.context_;let l=this.textRotation_;for(0===this.transformRotation_&&(l-=this.viewRotation_),this.textRotateWithView_&&(l+=this.viewRotation_);e<i;e+=s){const c=r[e]+this.textOffsetX_,h=r[e+1]+this.textOffsetY_;0!==l||1!=this.textScale_[0]||1!=this.textScale_[1]?(a.translate(c-this.textOffsetX_,h-this.textOffsetY_),a.rotate(l),a.translate(this.textOffsetX_,this.textOffsetY_),a.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&a.strokeText(this.text_,0,0),this.textFillState_&&a.fillText(this.text_,0,0),a.setTransform(1,0,0,1,0,0)):(this.textStrokeState_&&a.strokeText(this.text_,c,h),this.textFillState_&&a.fillText(this.text_,c,h))}}moveToLineTo_(t,e,i,s,r){const a=this.context_,l=Je(t,e,i,s,this.transform_,this.pixelCoordinates_);a.moveTo(l[0],l[1]);let c=l.length;r&&(c-=2);for(let h=2;h<c;h+=2)a.lineTo(l[h],l[h+1]);return r&&a.closePath(),i}drawRings_(t,e,i,s){for(let r=0,a=i.length;r<a;++r)e=this.moveToLineTo_(t,e,i[r],s,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Nt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=function Rc(n,t,e){const i=n.getFlatCoordinates();if(!i)return null;const s=n.getStride();return Je(i,0,i.length,s,t,e)}(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],s=e[3]-e[1],r=Math.sqrt(i*i+s*s),a=this.context_;a.beginPath(),a.arc(e[0],e[1],r,0,2*Math.PI),this.fillState_&&a.fill(),this.strokeState_&&a.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t)}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,s=e.length;i<s;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Nt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(Nt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,s=t.getFlatCoordinates();let r=0;const a=t.getEnds(),l=t.getStride();i.beginPath();for(let c=0,h=a.length;c<h;++c)r=this.moveToLineTo_(s,r,a[c],l,!1);i.stroke()}if(""!==this.text_){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Nt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Nt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let s=0;const r=t.getEndss(),a=t.getStride();e.beginPath();for(let l=0,c=r.length;l<c;++l)s=this.drawRings_(i,s,r[l],a);this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),we(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,s=t.textAlign?t.textAlign:Ji;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=s&&(i.textAlign=s,e.textAlign=s),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=s,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:s,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(t){const i=t.getColor();this.fillState_={fillStyle:le(i||_e)}}else this.fillState_=null;if(e){const i=e.getColor(),s=e.getLineCap(),r=e.getLineDash(),a=e.getLineDashOffset(),l=e.getLineJoin(),c=e.getWidth(),h=e.getMiterLimit(),u=r||qi;this.strokeState_={lineCap:void 0!==s?s:qn,lineDash:1===this.pixelRatio_?u:u.map(d=>d*this.pixelRatio_),lineDashOffset:(a||0)*this.pixelRatio_,lineJoin:void 0!==l?l:Ei,lineWidth:(void 0!==c?c:1)*this.pixelRatio_,miterLimit:void 0!==h?h:10,strokeStyle:le(i||Hi)}}else this.strokeState_=null}setImageStyle(t){let e;if(!t||!(e=t.getSize()))return void(this.image_=null);const i=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),r=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*i,this.imageAnchorY_=s[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const a=t.getScaleArray();this.imageScale_=[a[0]*this.pixelRatio_/i,a[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(t){const e=t.getFill();if(e){const f=e.getColor();this.textFillState_={fillStyle:le(f||_e)}}else this.textFillState_=null;const i=t.getStroke();if(i){const f=i.getColor(),_=i.getLineCap(),m=i.getLineDash(),p=i.getLineDashOffset(),x=i.getLineJoin(),v=i.getWidth(),E=i.getMiterLimit();this.textStrokeState_={lineCap:void 0!==_?_:qn,lineDash:m||qi,lineDashOffset:p||0,lineJoin:void 0!==x?x:Ei,lineWidth:void 0!==v?v:1,miterLimit:void 0!==E?E:10,strokeStyle:le(f||Hi)}}else this.textStrokeState_=null;const s=t.getFont(),r=t.getOffsetX(),a=t.getOffsetY(),l=t.getRotateWithView(),c=t.getRotation(),h=t.getScaleArray(),u=t.getText(),d=t.getTextAlign(),g=t.getTextBaseline();this.textState_={font:void 0!==s?s:Vo,textAlign:void 0!==d?d:Ji,textBaseline:void 0!==g?g:Kn},this.text_=void 0!==u?Array.isArray(u)?u.reduce((f,_,m)=>f+(m%2?" ":_),""):u:"",this.textOffsetX_=void 0!==r?this.pixelRatio_*r:0,this.textOffsetY_=void 0!==a?this.pixelRatio_*a:0,this.textRotateWithView_=void 0!==l&&l,this.textRotation_=void 0!==c?c:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}else this.text_=""}},ce=.5,Ga={Point:function Zd(n,t,e,i,s){const r=e.getImage(),a=e.getText();let l;if(r){if(r.getImageState()!=Ct_LOADED)return;let c=n;if(s){const u=r.getDeclutterMode();if("none"!==u)if(c=s,"obstacle"===u){const d=n.getBuilder(e.getZIndex(),"Image");d.setImageStyle(r,l),d.drawPoint(t,i)}else a&&a.getText()&&(l={})}const h=c.getBuilder(e.getZIndex(),"Image");h.setImageStyle(r,l),h.drawPoint(t,i)}if(a&&a.getText()){let c=n;s&&(c=s);const h=c.getBuilder(e.getZIndex(),"Text");h.setTextStyle(a,l),h.drawText(t,i)}},LineString:function Fd(n,t,e,i,s){const r=e.getStroke();if(r){const l=n.getBuilder(e.getZIndex(),"LineString");l.setFillStrokeStyle(null,r),l.drawLineString(t,i)}const a=e.getText();if(a&&a.getText()){const l=(s||n).getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i)}},Polygon:function Gd(n,t,e,i,s){const r=e.getFill(),a=e.getStroke();if(r||a){const c=n.getBuilder(e.getZIndex(),"Polygon");c.setFillStrokeStyle(r,a),c.drawPolygon(t,i)}const l=e.getText();if(l&&l.getText()){const c=(s||n).getBuilder(e.getZIndex(),"Text");c.setTextStyle(l),c.drawText(t,i)}},MultiPoint:function Nd(n,t,e,i,s){const r=e.getImage(),a=e.getText();let l;if(r){if(r.getImageState()!=Ct_LOADED)return;let c=n;if(s){const u=r.getDeclutterMode();if("none"!==u)if(c=s,"obstacle"===u){const d=n.getBuilder(e.getZIndex(),"Image");d.setImageStyle(r,l),d.drawMultiPoint(t,i)}else a&&a.getText()&&(l={})}const h=c.getBuilder(e.getZIndex(),"Image");h.setImageStyle(r,l),h.drawMultiPoint(t,i)}if(a&&a.getText()){let c=n;s&&(c=s);const h=c.getBuilder(e.getZIndex(),"Text");h.setTextStyle(a,l),h.drawText(t,i)}},MultiLineString:function Dd(n,t,e,i,s){const r=e.getStroke();if(r){const l=n.getBuilder(e.getZIndex(),"LineString");l.setFillStrokeStyle(null,r),l.drawMultiLineString(t,i)}const a=e.getText();if(a&&a.getText()){const l=(s||n).getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i)}},MultiPolygon:function kd(n,t,e,i,s){const r=e.getFill(),a=e.getStroke();if(a||r){const c=n.getBuilder(e.getZIndex(),"Polygon");c.setFillStrokeStyle(r,a),c.drawMultiPolygon(t,i)}const l=e.getText();if(l&&l.getText()){const c=(s||n).getBuilder(e.getZIndex(),"Text");c.setTextStyle(l),c.drawText(t,i)}},GeometryCollection:function Od(n,t,e,i,s){const r=t.getGeometriesArray();let a,l;for(a=0,l=r.length;a<l;++a)(0,Ga[r[a].getType()])(n,r[a],e,i,s)},Circle:function Pd(n,t,e,i,s){const r=e.getFill(),a=e.getStroke();if(r||a){const c=n.getBuilder(e.getZIndex(),"Circle");c.setFillStrokeStyle(r,a),c.drawCircle(t,i)}const l=e.getText();if(l&&l.getText()){const c=(s||n).getBuilder(e.getZIndex(),"Text");c.setTextStyle(l),c.drawText(t,i)}}};function Md(n,t){return parseInt(ct(n),10)-parseInt(ct(t),10)}function Er(n,t){return.5*n/t}function Ua(n,t,e,i,s,r,a){let l=!1;const c=e.getImage();if(c){const h=c.getImageState();h==Ct_LOADED||h==Ct_ERROR?c.unlistenImageChange(s):(h==Ct_IDLE&&c.load(),c.listenImageChange(s),l=!0)}return function Ld(n,t,e,i,s,r){const a=e.getGeometryFunction()(t);if(!a)return;const l=a.simplifyTransformed(i,s);e.getRenderer()?za(n,l,e,t):(0,Ga[l.getType()])(n,l,e,t,r)}(n,t,e,i,r,a),l}function za(n,t,e,i){if("GeometryCollection"!=t.getType())n.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer());else{const r=t.getGeometries();for(let a=0,l=r.length;a<l;++a)za(n,r[a],e,i)}}const zd=class Ud extends la{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=[1/0,1/0,-1/0,-1/0],this.wrappedRenderedExtent_=[1/0,1/0,-1/0,-1/0],this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(t,e,i){const s=e.extent,r=e.viewState,a=r.center,l=r.resolution,c=r.projection,h=r.rotation,u=c.getExtent(),d=this.getLayer().getSource(),g=e.pixelRatio,f=e.viewHints,_=!(f[0]||f[1]),m=this.compositionContext_,p=Math.round(e.size[0]*g),x=Math.round(e.size[1]*g),v=d.getWrapX()&&c.canWrapX(),E=v?_t(u):null,T=v?Math.ceil((s[2]-u[2])/E)+1:1;let b=v?Math.floor((s[0]-u[0])/E):0;do{const R=this.getRenderTransform(a,l,h,g,p,x,b*E);t.execute(m,1,R,h,_,void 0,i)}while(++b<T)}setupCompositionContext_(){if(1!==this.opacity_){const t=Ft(this.context.canvas.width,this.context.canvas.height,aa);this.compositionContext_=t}else this.compositionContext_=this.context}releaseCompositionContext_(){if(1!==this.opacity_){const t=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=t,jn(this.compositionContext_),aa.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(t){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree),this.releaseCompositionContext_())}renderFrame(t,e){const i=t.pixelRatio,s=t.layerStatesArray[t.layerIndex];(function Tl(n,t,e){(function zi(n,t,e,i,s,r,a){return n[0]=t,n[1]=e,n[2]=i,n[3]=s,n[4]=r,n[5]=a,n})(n,t,0,0,e,0,0)})(this.pixelTransform,1/i,1/i),xn(this.inversePixelTransform,this.pixelTransform);const r=ms(this.pixelTransform);this.useContainer(e,r,this.getBackground(t));const a=this.context,l=a.canvas,c=this.replayGroup_,h=this.declutterExecutorGroup;if((!c||c.isEmpty())&&(!h||h.isEmpty()))return null;const u=Math.round(t.size[0]*i),d=Math.round(t.size[1]*i);l.width!=u||l.height!=d?(l.width=u,l.height=d,l.style.transform!==r&&(l.style.transform=r)):this.containerReused||a.clearRect(0,0,u,d),this.preRender(a,t);const g=t.viewState;this.opacity_=s.opacity,this.setupCompositionContext_();let _=!1,m=!0;if(s.extent&&this.clipping){const p=He(s.extent);m=Nt(p,t.extent),_=m&&!ui(p,t.extent),_&&this.clipUnrotated(this.compositionContext_,t,p)}return m&&this.renderWorlds(c,t),_&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(a,t),this.renderedRotation_!==g.rotation&&(this.renderedRotation_=g.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(t){return new Promise(e=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=[this.context.canvas.width,this.context.canvas.height];Rt(this.pixelTransform,i);const s=this.renderedCenter_,r=this.renderedResolution_,a=this.renderedRotation_,l=this.renderedProjection_,c=this.wrappedRenderedExtent_,h=this.getLayer(),u=[],d=i[0]*ce,g=i[1]*ce;u.push(this.getRenderTransform(s,r,a,ce,d,g,0).slice());const f=h.getSource(),_=l.getExtent();if(f.getWrapX()&&l.canWrapX()&&!ui(_,c)){let m=c[0];const p=_t(_);let v,x=0;for(;m<_[0];)--x,v=p*x,u.push(this.getRenderTransform(s,r,a,ce,d,g,v).slice()),m+=p;for(x=0,m=c[2];m>_[2];)++x,v=p*x,u.push(this.getRenderTransform(s,r,a,ce,d,g,v).slice()),m-=p}this.hitDetectionImageData_=function Rd(n,t,e,i,s,r,a){const h=Ft(n[0]*ce,n[1]*ce);h.imageSmoothingEnabled=!1;const u=h.canvas,d=new wd(h,ce,s,null,a),g=e.length,f=Math.floor(16777215/g),_={};for(let p=1;p<=g;++p){const x=e[p-1],v=x.getStyleFunction()||i;if(!i)continue;let E=v(x,r);if(!E)continue;Array.isArray(E)||(E=[E]);const b=(p*f).toString(16).padStart(7,"#00000");for(let R=0,P=E.length;R<P;++R){const I=E[R],z=I.getGeometryFunction()(x);if(!z||!Nt(s,z.getExtent()))continue;const X=I.clone(),at=X.getFill();at&&at.setColor(b);const st=X.getStroke();st&&(st.setColor(b),st.setLineDash(null)),X.setText(void 0);const K=I.getImage();if(K&&0!==K.getOpacity()){const M=K.getImageSize();if(!M)continue;const Z=Ft(M[0],M[1],void 0,{alpha:!1}),lt=Z.canvas;Z.fillStyle=b,Z.fillRect(0,0,lt.width,lt.height),X.setImage(new sn({img:lt,imgSize:M,anchor:K.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:K.getOrigin(),opacity:1,size:K.getSize(),scale:K.getScale(),rotation:K.getRotation(),rotateWithView:K.getRotateWithView()}))}const bt=X.getZIndex()||0;let H=_[bt];H||(H={},_[bt]=H,H.Polygon=[],H.Circle=[],H.LineString=[],H.Point=[]);const k=z.getType();if("GeometryCollection"===k){const M=z.getGeometriesArrayRecursive();for(let Z=0,lt=M.length;Z<lt;++Z){const dt=M[Z];H[dt.getType().replace("Multi","")].push(dt,X)}}else H[k.replace("Multi","")].push(z,X)}}const m=Object.keys(_).map(Number).sort(We);for(let p=0,x=m.length;p<x;++p){const v=_[m[p]];for(const E in v){const T=v[E];for(let b=0,R=T.length;b<R;b+=2){d.setStyle(T[b+1]);for(let P=0,I=t.length;P<I;++P)d.setTransform(t[P]),d.drawGeometry(T[b])}}}return h.getImageData(0,0,u.width,u.height)}(i,u,this.renderedFeatures_,h.getStyleFunction(),c,r,a)}e(function Sd(n,t,e){const i=[];if(e){const s=Math.floor(Math.round(n[0])*ce),r=Math.floor(Math.round(n[1])*ce),a=4*(Et(s,0,e.width-1)+Et(r,0,e.height-1)*e.width),u=e.data[a+2]+256*(e.data[a+1]+256*e.data[a]),d=Math.floor(16777215/t.length);u&&u%d==0&&i.push(t[u/d-1])}return i}(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,i,s,r){if(!this.replayGroup_)return;const a=e.viewState.resolution,l=e.viewState.rotation,c=this.getLayer(),h={},u=function(f,_,m){const p=ct(f),x=h[p];if(x){if(!0!==x&&m<x.distanceSq){if(0===m)return h[p]=!0,r.splice(r.lastIndexOf(x),1),s(f,c,_);x.geometry=_,x.distanceSq=m}}else{if(0===m)return h[p]=!0,s(f,c,_);r.push(h[p]={feature:f,layer:c,geometry:_,distanceSq:m,callback:s})}};let d;const g=[this.replayGroup_];return this.declutterExecutorGroup&&g.push(this.declutterExecutorGroup),g.some(f=>d=f.forEachFeatureAtCoordinate(t,a,l,i,u,f===this.declutterExecutorGroup&&e.declutterTree?e.declutterTree.all().map(_=>_.value):null)),d}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const s=t.viewHints[0],r=t.viewHints[1],a=e.getUpdateWhileAnimating(),l=e.getUpdateWhileInteracting();if(this.ready&&!a&&s||!l&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const c=t.extent,h=t.viewState,u=h.projection,d=h.resolution,g=t.pixelRatio,f=e.getRevision(),_=e.getRenderBuffer();let m=e.getRenderOrder();void 0===m&&(m=Md);const p=h.center.slice(),x=ps(c,_*d),v=x.slice(),E=[x.slice()],T=u.getExtent();if(i.getWrapX()&&u.canWrapX()&&!ui(T,t.extent)){const k=_t(T),M=Math.max(_t(x)/2,k);x[0]=T[0]-M,x[2]=T[2]+M,ho(p,u);const Z=Vr(E[0],u);Z[0]<T[0]&&Z[2]<T[2]?E.push([Z[0]+k,Z[1],Z[2]+k,Z[3]]):Z[0]>T[0]&&Z[2]>T[2]&&E.push([Z[0]-k,Z[1],Z[2]-k,Z[3]])}if(this.ready&&this.renderedResolution_==d&&this.renderedRevision_==f&&this.renderedRenderOrder_==m&&ui(this.wrappedRenderedExtent_,x))return we(this.renderedExtent_,v)||(this.hitDetectionImageData_=null,this.renderedExtent_=v),this.renderedCenter_=p,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const b=new Fa(Er(d,g),x,d,g);let R;this.getLayer().getDeclutter()&&(R=new Fa(Er(d,g),x,d,g));const P=xo();let I;if(P){for(let k=0,M=E.length;k<M;++k){const lt=As(E[k]);i.loadFeatures(lt,d,P)}I=Bi(P,u)}else for(let k=0,M=E.length;k<M;++k)i.loadFeatures(E[k],d,u);const z=function Ad(n,t){const e=Er(n,t);return e*e}(d,g);let X=!0;const at=k=>{let M;const Z=k.getStyleFunction()||e.getStyleFunction();if(Z&&(M=Z(k,d)),M){const lt=this.renderFeature(k,z,M,b,I,R);X=X&&!lt}},st=As(x),K=i.getFeaturesInExtent(st);m&&K.sort(m);for(let k=0,M=K.length;k<M;++k)at(K[k]);this.renderedFeatures_=K,this.ready=X;const bt=b.finish(),H=new Na(x,d,g,i.getOverlaps(),bt,e.getRenderBuffer());return R&&(this.declutterExecutorGroup=new Na(x,d,g,i.getOverlaps(),R.finish(),e.getRenderBuffer())),this.renderedResolution_=d,this.renderedRevision_=f,this.renderedRenderOrder_=m,this.renderedExtent_=v,this.wrappedRenderedExtent_=x,this.renderedCenter_=p,this.renderedProjection_=u,this.replayGroup_=H,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,s,r,a){if(!i)return!1;let l=!1;if(Array.isArray(i))for(let c=0,h=i.length;c<h;++c)l=Ua(s,t,i[c],e,this.boundHandleStyleImageChange_,r,a)||l;else l=Ua(s,t,i,e,this.boundHandleStyleImageChange_,r,a);return l}},is=class Yd extends sd{constructor(t){super(t)}createRenderer(){return new zd(this)}},Ya=class Xd{constructor(t){this.rbush_=new ba(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[ct(e)]=i}load(t,e){const i=new Array(e.length);for(let s=0,r=e.length;s<r;s++){const a=t[s],l=e[s],c={minX:a[0],minY:a[1],maxX:a[2],maxY:a[3],value:l};i[s]=c,this.items_[ct(l)]=c}this.rbush_.load(i)}remove(t){const e=ct(t),i=this.items_[e];return delete this.items_[e],null!==this.rbush_.remove(i)}update(t,e){const i=this.items_[ct(e)];Yi([i.minX,i.minY,i.maxX,i.maxY],t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){return this.rbush_.search({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}).map(function(s){return s.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let s=0,r=t.length;s<r;s++)if(i=e(t[s]),i)return i;return i}isEmpty(){return Ui(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return ge(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}};function Wd(n,t){return[[-1/0,-1/0,1/0,1/0]]}function Wa(n,t){return function(e,i,s,r,a){const l=this;!function Bd(n,t,e,i,s,r,a){const l=new XMLHttpRequest;l.open("GET","function"==typeof n?n(e,i,s):n,!0),"arraybuffer"==t.getType()&&(l.responseType="arraybuffer"),l.withCredentials=false,l.onload=function(c){if(!l.status||l.status>=200&&l.status<300){const h=t.getType();let u;"json"==h||"text"==h?u=l.responseText:"xml"==h?(u=l.responseXML,u||(u=(new DOMParser).parseFromString(l.responseText,"application/xml"))):"arraybuffer"==h&&(u=l.response),u?r(t.readFeatures(u,{extent:e,featureProjection:s}),t.readProjection(u)):a()}else a()},l.onerror=a,l.send()}(n,t,e,i,s,function(c,h){l.addFeatures(c),void 0!==r&&r(c)},a||hi)}}class ke extends ue{constructor(t,e,i){super(t),this.feature=e,this.features=i}}const Tr=class jd extends va{constructor(t){super({attributions:(t=t||{}).attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:void 0===t.wrapX||t.wrapX}),this.loader_=hi,this.format_=t.format,this.overlaps_=void 0===t.overlaps||t.overlaps,this.url_=t.url,void 0!==t.loader?this.loader_=t.loader:void 0!==this.url_&&(tt(this.format_,7),this.loader_=Wa(this.url_,this.format_)),this.strategy_=void 0!==t.strategy?t.strategy:Wd;const e=void 0===t.useSpatialIndex||t.useSpatialIndex;let i,s;this.featuresRtree_=e?new Ya:null,this.loadedExtentsRtree_=new Ya,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(t.features)?s=t.features:t.features&&(i=t.features,s=i.getArray()),!e&&void 0===i&&(i=new oe(s)),void 0!==s&&this.addFeaturesInternal(s),void 0!==i&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=ct(t);if(!this.addToIndex_(e,t))return void(this.featuresCollection_&&this.featuresCollection_.remove(t));this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const s=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new ke("addfeature",t))}setupChangeEvents_(t,e){this.featureChangeKeys_[t]=[rt(e,V.CHANGE,this.handleFeatureChange_,this),rt(e,"propertychange",this.handleFeatureChange_,this)]}addToIndex_(t,e){let i=!0;const s=e.getId();return void 0!==s&&(s.toString()in this.idIndex_?i=!1:this.idIndex_[s.toString()]=e),i&&(tt(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],s=[];for(let r=0,a=t.length;r<a;r++){const l=t[r],c=ct(l);this.addToIndex_(c,l)&&i.push(l)}for(let r=0,a=i.length;r<a;r++){const l=i[r],c=ct(l);this.setupChangeEvents_(c,l);const h=l.getGeometry();if(h){const u=h.getExtent();e.push(u),s.push(l)}else this.nullGeometryFeatures_[c]=l}if(this.featuresRtree_&&this.featuresRtree_.load(e,s),this.hasListener("addfeature"))for(let r=0,a=i.length;r<a;r++)this.dispatchEvent(new ke("addfeature",i[r]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener("addfeature",function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener("removefeature",function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener("add",i=>{e||(e=!0,this.addFeature(i.element),e=!1)}),t.addEventListener("remove",i=>{e||(e=!0,this.removeFeature(i.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(pt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(s=>{this.removeFeatureInternal(s)});for(const s in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[s])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new ke("clear");this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){return this.forEachFeatureInExtent([t[0],t[1],t[0],t[1]],function(s){if(s.getGeometry().intersectsCoordinate(t))return e(s)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){if(i.getGeometry().intersectsExtent(t)){const r=e(i);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Ui(this.nullGeometryFeatures_)||Fr(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(i){e.push(i)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const s=function Dl(n,t){if(t.canWrapX()){const e=t.getExtent();if(!isFinite(n[0])||!isFinite(n[2]))return[[e[0],n[1],e[2],n[3]]];Vr(n,t);const i=_t(e);if(_t(n)>i)return[[e[0],n[1],e[2],n[3]]];if(n[0]<e[0])return[[n[0]+i,n[1],e[2],n[3]],[e[0],n[1],n[2],n[3]]];if(n[2]>e[2])return[[n[0],n[1],e[2],n[3]],[e[0],n[1],n[2]-i,n[3]]]}return[n]}(t,e);return[].concat(...s.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],s=t[1];let r=null;const a=[NaN,NaN];let l=1/0;const c=[-1/0,-1/0,1/0,1/0];return e=e||Ni,this.featuresRtree_.forEachInExtent(c,function(h){if(e(h)){const u=h.getGeometry(),d=l;if(l=u.closestPointXY(i,s,a,l),l<d){r=h;const g=Math.sqrt(l);c[0]=i-g,c[1]=s-g,c[2]=i+g,c[3]=s+g}}}),r}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return void 0!==e?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return void 0!==e?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=ct(e),s=e.getGeometry();if(s){const a=s.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(a,e)):this.featuresRtree_&&this.featuresRtree_.update(a,e)}else i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);const r=e.getId();if(void 0!==r){const a=r.toString();this.idIndex_[a]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[a]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new ke("changefeature",e))}hasFeature(t){const e=t.getId();return void 0!==e?e in this.idIndex_:ct(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Ui(this.nullGeometryFeatures_):!this.featuresCollection_||0===this.featuresCollection_.getLength()}loadFeatures(t,e,i){const s=this.loadedExtentsRtree_,r=this.strategy_(t,e,i);for(let a=0,l=r.length;a<l;++a){const c=r[a];s.forEachInExtent(c,function(u){return ui(u.extent,c)})||(++this.loadingExtentsCount_,this.dispatchEvent(new ke("featuresloadstart")),this.loader_.call(this,c,e,i,u=>{--this.loadingExtentsCount_,this.dispatchEvent(new ke("featuresloadend",void 0,u))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new ke("featuresloaderror"))}),s.insert(c,{extent:c.slice()}))}this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let i;e.forEachInExtent(t,function(s){if(Yi(s.extent,t))return i=s,!0}),i&&e.remove(i)}removeFeature(t){if(!t)return;const e=ct(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=ct(t),i=this.featureChangeKeys_[e];if(!i)return;i.forEach(pt),delete this.featureChangeKeys_[e];const s=t.getId();return void 0!==s&&delete this.idIndex_[s.toString()],delete this.uidIndex_[e],this.dispatchEvent(new ke("removefeature",t)),t}removeFromIdIndex_(t){let e=!1;for(const i in this.idIndex_)if(this.idIndex_[i]===t){delete this.idIndex_[i],e=!0;break}return e}setLoader(t){this.loader_=t}setUrl(t){tt(this.format_,7),this.url_=t,this.setLoader(Wa(t,this.format_))}};class br extends re{constructor(t){super(),this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t&&("function"==typeof t.getSimplifiedGeometry?this.setGeometry(t):this.setProperties(t))}clone(){const t=new br(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(pt(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=rt(t,V.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?function qd(n){if("function"==typeof n)return n;let t;return Array.isArray(n)?t=n:(tt("function"==typeof n.getZIndex,41),t=[n]),function(){return t}}(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}const wr=br;let qa=(()=>{class n{constructor(e){this.elementRef=e,this.lat=-34.603490361131385,this.lon=-58.382037891217465,this.width="100%",this.height="300px",this.title="Monitoreo",this.coordinates=new o.vpe,this.target="map-"+Math.random().toString(36).substring(2)}ngOnInit(){}ngOnChanges(){this.map&&(this.map.getView().setCenter(Ve(this.coordinatesToCenter,"EPSG:4326","EPSG:3857")),this.map.getView().setZoom(15))}ngAfterViewInit(){this.mapEl=this.elementRef.nativeElement.querySelector("#"+this.target),this.setSize(),this.map=new tu({target:this.target,layers:[new Cu({source:new Vu})],view:new ae({center:Is([this.lon,this.lat]),zoom:this.zoom}),controls:Qo({attribution:!1,zoom:!0}).extend([])}),this.map.on("click",e=>{this.map.getLayers().forEach(s=>{s instanceof is&&s.getSource().clear()}),this.setMarker(new is({source:new Tr({features:[new wr({geometry:new zn(e.coordinate)})]}),style:new si({image:new sn({anchor:[.5,1],src:"https://upload.wikimedia.org/wikipedia/commons/thumb/d/d1/Google_Maps_pin.svg/30px-Google_Maps_pin.svg.png"})})}));const i=Ve(e.coordinate,"EPSG:3857","EPSG:4326");this.coordinates.emit(i)})}setMarker(e){this.map.addLayer(e)}setControl(e){this.map.addControl(e)}setSize(){if(this.mapEl){const e=this.mapEl.style;e.height=Ka(this.height)||"300px",e.width=Ka(this.width)||"100%"}}}return n.\u0275fac=function(e){return new(e||n)(o.Y36(o.SBq))},n.\u0275cmp=o.Xpm({type:n,selectors:[["app-ol-map"]],inputs:{lat:"lat",lon:"lon",zoom:"zoom",width:"width",height:"height",title:"title",coordinatesToCenter:"coordinatesToCenter"},outputs:{coordinates:"coordinates"},standalone:!0,features:[o.TTD,o.jDz],decls:3,vars:1,consts:[[1,"map-card-header"],[1,"map-container"],[1,"map",2,"position","relative","-moz-border-radius","4px","border-radius","4px","border","1px solid black","overflow","hidden",3,"id"]],template:function(e,i){1&e&&(o._UZ(0,"div",0),o.TgZ(1,"div",1),o._UZ(2,"div",2),o.qZA()),2&e&&(o.xp6(2),o.s9C("id",i.target))},styles:['[_ngcontent-%COMP%]:root, [_nghost-%COMP%]{--ol-background-color: white;--ol-accent-background-color: #F5F5F5;--ol-subtle-background-color: rgba(128, 128, 128, .25);--ol-partial-background-color: rgba(255, 255, 255, .75);--ol-foreground-color: #333333;--ol-subtle-foreground-color: #666666;--ol-brand-color: #00AAFF}.ol-box[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:2px;border:1.5px solid var(--ol-background-color);background-color:var(--ol-partial-background-color)}.ol-mouse-position[_ngcontent-%COMP%]{top:8px;right:8px;position:absolute}.ol-scale-line[_ngcontent-%COMP%]{background:var(--ol-partial-background-color);border-radius:4px;bottom:8px;left:8px;padding:2px;position:absolute}.ol-scale-line-inner[_ngcontent-%COMP%]{border:1px solid var(--ol-subtle-foreground-color);border-top:none;color:var(--ol-foreground-color);font-size:10px;text-align:center;margin:1px;will-change:contents,width;transition:all .25s}.ol-scale-bar[_ngcontent-%COMP%]{position:absolute;bottom:8px;left:8px}.ol-scale-bar-inner[_ngcontent-%COMP%]{display:flex}.ol-scale-step-marker[_ngcontent-%COMP%]{width:1px;height:15px;background-color:var(--ol-foreground-color);float:right;z-index:10}.ol-scale-step-text[_ngcontent-%COMP%]{position:absolute;bottom:-5px;font-size:10px;z-index:11;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-text[_ngcontent-%COMP%]{position:absolute;font-size:12px;text-align:center;bottom:25px;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-singlebar[_ngcontent-%COMP%]{position:relative;height:10px;z-index:9;box-sizing:border-box;border:1px solid var(--ol-foreground-color)}.ol-scale-singlebar-even[_ngcontent-%COMP%]{background-color:var(--ol-subtle-foreground-color)}.ol-scale-singlebar-odd[_ngcontent-%COMP%]{background-color:var(--ol-background-color)}.ol-unsupported[_ngcontent-%COMP%]{display:none}.ol-viewport[_ngcontent-%COMP%], .ol-unselectable[_ngcontent-%COMP%]{-webkit-touch-callout:none;-webkit-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent}.ol-viewport[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{all:unset}.ol-selectable[_ngcontent-%COMP%]{-webkit-touch-callout:default;-webkit-user-select:text;user-select:text}.ol-grabbing[_ngcontent-%COMP%]{cursor:grabbing}.ol-grab[_ngcontent-%COMP%]{cursor:move;cursor:grab}.ol-control[_ngcontent-%COMP%]{position:absolute;background-color:var(--ol-subtle-background-color);border-radius:4px}.ol-zoom[_ngcontent-%COMP%]{top:.5em;left:.5em}.ol-rotate[_ngcontent-%COMP%]{top:.5em;right:.5em;transition:opacity .25s linear,visibility 0s linear}.ol-rotate.ol-hidden[_ngcontent-%COMP%]{opacity:0;visibility:hidden;transition:opacity .25s linear,visibility 0s linear .25s}.ol-zoom-extent[_ngcontent-%COMP%]{top:4.643em;left:.5em}.ol-full-screen[_ngcontent-%COMP%]{right:.5em;top:.5em}.ol-control[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:block;margin:1px;padding:0;color:var(--ol-subtle-foreground-color);font-weight:700;text-decoration:none;font-size:inherit;text-align:center;height:1.375em;width:1.375em;line-height:.4em;background-color:var(--ol-background-color);border:none;border-radius:2px}.ol-control[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]::-moz-focus-inner{border:none;padding:0}.ol-zoom-extent[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{line-height:1.4em}.ol-compass[_ngcontent-%COMP%]{display:block;font-weight:400;will-change:transform}.ol-touch[_ngcontent-%COMP%]   .ol-control[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:1.5em}.ol-touch[_ngcontent-%COMP%]   .ol-zoom-extent[_ngcontent-%COMP%]{top:5.5em}.ol-control[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .ol-control[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus{text-decoration:none;outline:1px solid var(--ol-subtle-foreground-color);color:var(--ol-foreground-color)}.ol-zoom[_ngcontent-%COMP%]   .ol-zoom-in[_ngcontent-%COMP%]{border-radius:2px 2px 0 0}.ol-zoom[_ngcontent-%COMP%]   .ol-zoom-out[_ngcontent-%COMP%]{border-radius:0 0 2px 2px}.ol-attribution[_ngcontent-%COMP%]{text-align:right;bottom:.5em;right:.5em;max-width:calc(100% - 1.3em);display:flex;flex-flow:row-reverse;align-items:center}.ol-attribution[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--ol-subtle-foreground-color);text-decoration:none}.ol-attribution[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding:1px .5em;color:var(--ol-foreground-color);text-shadow:0 0 2px var(--ol-background-color);font-size:12px}.ol-attribution[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:inline;list-style:none}.ol-attribution[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:not(:last-child):after{content:" "}.ol-attribution[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:2em;max-width:inherit;vertical-align:middle}.ol-attribution[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex-shrink:0}.ol-attribution.ol-collapsed[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{display:none}.ol-attribution[_ngcontent-%COMP%]:not(.ol-collapsed){background:var(--ol-partial-background-color)}.ol-attribution.ol-uncollapsible[_ngcontent-%COMP%]{bottom:0;right:0;border-radius:4px 0 0}.ol-attribution.ol-uncollapsible[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-top:-.2em;max-height:1.6em}.ol-attribution.ol-uncollapsible[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:none}.ol-zoomslider[_ngcontent-%COMP%]{top:4.5em;left:.5em;height:200px}.ol-zoomslider[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{position:relative;height:10px}.ol-touch[_ngcontent-%COMP%]   .ol-zoomslider[_ngcontent-%COMP%]{top:5.5em}.ol-overviewmap[_ngcontent-%COMP%]{left:.5em;bottom:.5em}.ol-overviewmap.ol-uncollapsible[_ngcontent-%COMP%]{bottom:0;left:0;border-radius:0 4px 0 0}.ol-overviewmap[_ngcontent-%COMP%]   .ol-overviewmap-map[_ngcontent-%COMP%], .ol-overviewmap[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:block}.ol-overviewmap[_ngcontent-%COMP%]   .ol-overviewmap-map[_ngcontent-%COMP%]{border:1px solid var(--ol-subtle-foreground-color);height:150px;width:150px}.ol-overviewmap[_ngcontent-%COMP%]:not(.ol-collapsed)   button[_ngcontent-%COMP%]{bottom:0;left:0;position:absolute}.ol-overviewmap.ol-collapsed[_ngcontent-%COMP%]   .ol-overviewmap-map[_ngcontent-%COMP%], .ol-overviewmap.ol-uncollapsible[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:none}.ol-overviewmap[_ngcontent-%COMP%]:not(.ol-collapsed){background:var(--ol-subtle-background-color)}.ol-overviewmap-box[_ngcontent-%COMP%]{border:1.5px dotted var(--ol-subtle-foreground-color)}.ol-overviewmap[_ngcontent-%COMP%]   .ol-overviewmap-box[_ngcontent-%COMP%]:hover{cursor:move}']}),n})();const Hd=/([A-Za-z%]+)$/,Ka=n=>null==n?"":Hd.test(n)?n:`${n}px`,Jd=["*"],tg=[.5,1];let ig=(()=>{class n{constructor(e,i,s){this.olMap=e,this.ngZone=i,this.router=s,this.lat=-34.603490361131385,this.lon=-58.382037891217465,this.icon="https://proyexiot.com/v2/app/assets/images/spotlight-poi2.png",this.title="",this.anchor=tg}ngOnInit(){const e=[];let i,s;if(this.markers){this.markers.map(a=>{let l;e.push(new wr({geometry:new zn(Is([a.lon,a.lat]))})),"locomotora"===a.type?l=new si({image:new fr({radius:5,fill:new ni({color:a.color}),stroke:new Mi({color:"#000000",width:1})}),text:new ts({text:a.title,offsetY:12,font:"11px arial",fill:new ni({color:"white"}),stroke:new Mi({color:"black",width:4})})}):"remolcador"===a.type&&(l=new si({image:new sn({anchor:this.anchor,src:a.icon}),text:new ts({text:a.title,offsetY:12,font:"bold 12px arial",fill:new ni({color:"white"}),stroke:new Mi({color:"black",width:6})})})),e[e.length-1].setStyle(l)}),i=e;const r=new Tr({features:i});s=new is({source:r})}else{const r=new wr({geometry:new zn(Is([this.lon,this.lat]))}),a=new si({image:new sn({anchor:this.anchor,src:this.icon}),text:new ts({text:this.title,offsetY:12,font:"bold 12px arial",fill:new ni({color:"white"}),stroke:new Mi({color:"black",width:6})})});r.setStyle(a),i=[r];const l=new Tr({features:i});s=new is({source:l}),i=r}this.olMap.map?(this.olMap.setMarker(s),this.olMap.map.on("pointermove",r=>{const a=this.olMap.map.getEventPixel(r.originalEvent),l=this.olMap.map.hasFeatureAtPixel(a);this.olMap.map.getViewport().style.cursor=l?"pointer":""}),this.link&&this.olMap.map.on("click",r=>{this.ngZone.runOutsideAngular(()=>{const a=this.olMap.map.forEachFeatureAtPixel(r.pixel,l=>l);a&&a==i&&this.router.navigateByUrl(this.link)})})):setTimeout(()=>{this.ngOnInit()},10)}ngOnDestroy(){}}return n.\u0275fac=function(e){return new(e||n)(o.Y36(qa),o.Y36(o.R0b),o.Y36(y.F0))},n.\u0275cmp=o.Xpm({type:n,selectors:[["app-ol-map-marker"]],inputs:{lat:"lat",lon:"lon",icon:"icon",link:"link",title:"title",anchor:"anchor",markers:"markers"},standalone:!0,features:[o.jDz],ngContentSelectors:Jd,decls:1,vars:0,template:function(e,i){1&e&&(o.F$t(),o.Hsn(0))}}),n})();var ng=N(6812);function sg(n,t){if(1&n&&(o.TgZ(0,"option",25),o._uU(1),o.qZA()),2&n){const e=t.$implicit;o.Q6J("value",e.id),o.xp6(1),o.Oqu(e.name)}}function rg(n,t){1&n&&(o.TgZ(0,"mat-slide-toggle",88),o._uU(1," Papelera "),o.qZA()),2&n&&o.Q6J("checked",!0)}function og(n,t){if(1&n&&(o.TgZ(0,"option",25),o._uU(1),o.qZA()),2&n){const e=t.$implicit;o.Q6J("value",e.id),o.xp6(1),o.Oqu(e.name)}}function ag(n,t){if(1&n){const e=o.EpF();o.TgZ(0,"div",89)(1,"mat-icon",90),o.NdJ("click",function(){const r=o.CHM(e).$implicit,a=o.oxw();return o.KtG(a.remove(r.id))}),o._uU(2,"delete"),o.qZA()()}2&n&&o.Jzz("background-image: url(",t.$implicit.base64,"); width: 32%!important;")}function lg(n,t){if(1&n&&(o.TgZ(0,"option",25),o._uU(1),o.qZA()),2&n){const e=t.$implicit;o.Q6J("value",e.id),o.xp6(1),o.Oqu(e.name)}}function cg(n,t){if(1&n&&(o.TgZ(0,"option",25),o._uU(1),o.qZA()),2&n){const e=t.$implicit;o.Q6J("value",e.id),o.xp6(1),o.Oqu(e.name)}}function hg(n,t){1&n&&(o.TgZ(0,"mat-error"),o._uU(1," El campo debe tener un maximo de 1200 caracteres "),o.qZA())}function ug(n,t){if(1&n&&o._UZ(0,"iframe",91),2&n){const e=o.oxw();o.Q6J("src",e.updateVideoUrl(e.propertyFG.get("youtube_link").value),o.uOi)}}function dg(n,t){if(1&n){const e=o.EpF();o.TgZ(0,"file-input",92),o.NdJ("fileChange",function(s){o.CHM(e);const r=o.oxw();return o.KtG(r.selectVideo(s))}),o.qZA()}2&n&&o.Q6J("multiple",!1)}function gg(n,t){if(1&n){const e=o.EpF();o.TgZ(0,"div")(1,"div",93)(2,"button",94),o.NdJ("click",function(){o.CHM(e);const s=o.oxw();return o.KtG(s.deleteVideo())}),o._uU(3,"Eliminar video"),o.qZA()(),o.TgZ(4,"video",95),o._UZ(5,"source",96),o._uU(6," Your browser does not support the video tag. "),o.qZA()()}if(2&n){const e=o.oxw();o.xp6(5),o.Q6J("src",e.videoUrl,o.LSH)}}function fg(n,t){if(1&n){const e=o.EpF();o.TgZ(0,"div",89)(1,"mat-icon",90),o.NdJ("click",function(){const r=o.CHM(e).$implicit,a=o.oxw();return o.KtG(a.remove(r.id))}),o._uU(2,"delete"),o.qZA()()}2&n&&o.Jzz("background-image: url(",t.$implicit.base64,"); width: 32%!important;")}function _g(n,t){if(1&n){const e=o.EpF();o.TgZ(0,"app-ol-map",97),o.NdJ("coordinates",function(s){o.CHM(e);const r=o.oxw();return o.KtG(r.setCoordinates(s))}),o._UZ(1,"app-ol-map-marker",98),o.qZA()}if(2&n){const e=o.oxw();o.Q6J("lat",18.477791110138053)("lon",-69.92633752725835)("height",500)("zoom",12),o.xp6(1),o.Q6J("lat",e.propertyFG.get("lat").value)("lon",e.propertyFG.get("lon").value)}}let Va=(()=>{class n{constructor(e,i,s,r,a,l,c,h){this._propertiesService=e,this._activatedRouter=i,this.sanitizer=s,this._formBuilder=r,this._globalService=a,this._userService=l,this.location=c,this._matSnachBar=h,this.property={},this.files=[],this.filesBanner=[],this.filesToRemove=[],this.showMap=!1,this.nameKeys={name:"nombre",address:"direccion",currency_id:"moneda",price:"precio"}}ngOnInit(){this._userService.user$.subscribe(e=>{this.user=e}),this.propertyFG=this._formBuilder.group({name:["",et.kI.required],description:["",[et.kI.maxLength(1200)]],address:["",et.kI.required],currency_id:[null,et.kI.required],price:["",et.kI.required],lat:[""],lon:[""],bedrooms:[0],bathrooms:[0],construction_year:[null],trashed:[!1],size:[null],property_type_id:[null],contract_type_id:[null],status_id:[null],published:[!0],deleteVideo:[!1],wifi:[1],kitchen:[1],lobby:[1],elevator:[1],parking:[1],gym:[1],security:[1],fireplace:[1],balcony:[1],terrace:[1],power_plant:[1],walk_in_closet:[1],swimming_pool:[1],kids_area:[1],pets_allowed:[1],youtube_link:[""]}),this._propertiesService.getFeatures().subscribe(e=>{this.currencies=e.data.currencies,this.propertyTypes=e.data.propertyTypes,this.status=e.data.status,this.contractTypes=e.data.contractTypes}),this.checkIfEdit()}checkIfEdit(){this._activatedRouter.params.subscribe(e=>{e.id?(this.propertyID=e.id,this.getProperty()):this.showMap=!0})}fileChanges(e){var i=this;return W(function*(){for(let s=0;s<e.length;s++)i.files.push({id:i.generateRandomId(),name:e[s].name,file:e[s],base64:yield i.imgToBase64(e[s])});console.log()})()}remove(e){const i=this.filesBanner.find(s=>s.id===e);i.base64.startsWith("http")&&this.filesToRemove.push(i.id),this.filesBanner=this.filesBanner.filter(s=>s.id!==e)}imgToBase64(e){return new Promise((i,s)=>{const r=new FileReader;r.readAsDataURL(e),r.onload=()=>i(r.result),r.onerror=a=>s(a)})}getProperty(){this._propertiesService.get(this.propertyID).subscribe(e=>{this.property=e.data,this.propertyFG.patchValue(this.property),this.filesBanner=this.property.images.filter(i=>"Banner"===i.type).map(i=>({id:i.id,base64:`${be.N.assets}/storage/properties/${i.name}`})),this.files=this.property.images.filter(i=>"Gallery"===i.type).map(i=>({id:i.id,base64:`${be.N.assets}/storage/properties/${i.name}`})),this.property.video&&(this.video=this.property.video,this.videoUrl=this.sanitizer.bypassSecurityTrustResourceUrl(be.N.assets+"/storage/properties/"+this.property.video)),this.property.deleted_at&&this.propertyFG.patchValue({trashed:!0}),setTimeout(()=>{this.showMap=!0},100)})}generateRandomId(){return Math.random().toString(36).substring(2)}updateVideoUrl(e){const s="https://www.youtube.com/embed/"+e.split("v=")[1];return this.sanitizer.bypassSecurityTrustResourceUrl(s)}fileChangesBanner(e){var i=this;return W(function*(){for(let s=0;s<e.length;s++)i.filesBanner.push({id:i.generateRandomId(),name:e[s].name,file:e[s],base64:yield i.imgToBase64(e[s])});console.log(i.filesBanner)})()}removeBanner(e){const i=this.filesBanner.find(s=>s.id===e);i.base64.startsWith("http")&&this.filesToRemove.push(i.id),console.log(this.filesToRemove),this.filesBanner=this.filesBanner.filter(s=>s.id!==e)}actualizar(){if(this.errors=[],this.propertyFG.invalid)return this.propertyFG.markAllAsTouched(),this.errors=Object.keys(this.propertyFG.controls).map(r=>{const a=this.propertyFG.get(r).errors;if(null!=a)return{key:r,errors:Object.keys(a)}}).filter(r=>r),void this._globalService.openSnackBar(this._matSnachBar,"Hay errores en el formulario",5e3,"error");const e=this.files.filter(r=>r.file).map(r=>r.file),i=this.filesBanner.filter(r=>r.file).map(r=>r.file),s={...this.propertyFG.value,filesToRemove:this.filesToRemove};console.log(s),this._propertiesService.actualizar(this.propertyID,s,e,i,this.video).subscribe(r=>{this.propertyFG.patchValue(r.data),this.propertyFG.get("deleteVideo").setValue(!1),this.property=r.data,this.filesBanner=this.property.images.filter(a=>"Banner"===a.type).map(a=>({id:a.id,base64:`${be.N.assets}/storage/properties/${a.name}`})),this.files=this.property.images.filter(a=>"Gallery"===a.type).map(a=>({id:a.id,base64:`${be.N.assets}/storage/properties/${a.name}`})),this._globalService.openSnackBar(this._matSnachBar,"Propiedad actualizada correctamente",1e4,"success")})}guardar(){if(this.errors=[],this.propertyFG.invalid)return this.propertyFG.markAllAsTouched(),this.errors=Object.keys(this.propertyFG.controls).map(s=>{const r=this.propertyFG.get(s).errors;if(null!=r)return{key:s,errors:Object.keys(r)}}).filter(s=>s),this._globalService.openSnackBar(this._matSnachBar,"Hay errores en el formulario",5e3,"error"),void console.log(this.errors);const e=this.files.map(s=>s.file),i=this.filesBanner.map(s=>s.file);this._propertiesService.crear(this.propertyFG.value,e,i,this.video).subscribe(s=>{this.location.go("/propiedades/editar/"+s.data.id),this.propertyFG.patchValue(s.data),this.property=s.data,this.propertyID=s.data.id,this.filesBanner=this.property.images.filter(r=>"Banner"===r.type).map(r=>({id:r.id,base64:`${be.N.assets}/storage/properties/${r.name}`})),this.files=this.property.images.filter(r=>"Gallery"===r.type).map(r=>({id:r.id,base64:`${be.N.assets}/storage/properties/${r.name}`})),this._globalService.openSnackBar(this._matSnachBar,"Propiedad creada correctamente",1e4,"success")})}selectVideo(e){this.video=e,console.log(this.video);const i=URL.createObjectURL(e);this.videoUrl=this.sanitizer.bypassSecurityTrustResourceUrl(i)}deleteVideo(){this.video=null,this.videoUrl=null,this.propertyID&&this.propertyFG.get("deleteVideo").setValue(!0)}getCharactersLeft(){return 1200-this.propertyFG.get("description").value?.length||0}getSafeUrl(e){return e=e.replace(/ /g,"+"),console.log(e),console.log(this.sanitizer.bypassSecurityTrustResourceUrl(e)),this.sanitizer.bypassSecurityTrustResourceUrl(e)}setCoordinates(e){this.propertyFG.get("lon").setValue(e[0]),this.propertyFG.get("lat").setValue(e[1])}}return n.\u0275fac=function(e){return new(e||n)(o.Y36(Pr.C),o.Y36(y.gz),o.Y36(rl.H7),o.Y36(et.qu),o.Y36(Lr.U),o.Y36(Or.K),o.Y36(vt.Ye),o.Y36(D.ux))},n.\u0275cmp=o.Xpm({type:n,selectors:[["app-manage-property"]],standalone:!0,features:[o.jDz],decls:380,vars:135,consts:[[1,"w-full",3,"formGroup"],[1,"w-full","property-banner","-my-5"],[1,"grid","grid-cols-3","gap-5","max-w-320","mx-auto"],[1,"col-span-2"],[1,"bg-card","shadow","rounded-2xl","p-6"],[1,"flex","flex-col","gap-2"],[1,"flex","flex-wrap","w-full"],[1,"w-full","mb-2"],[1,"w-1/2"],["formControlName","contract_type_id","placeholder","Modo",1,"w-50","p-1","rounded-md","border","border-solid"],["disabled","",3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"w-1/2","text-right"],["formControlName","published",1,"example-margin","mr-4",3,"checked"],["formControlName","trashed","class","example-margin",3,"checked",4,"ngIf"],["formControlName","name","placeholder","Nombre","type","text",1,"font-bold","text-3xl","leading-8","w-100","p-1","rounded-md","border","border-solid"],[1,"flex","gap-1","items-center"],[1,"font-light","text-slate-600"],["formControlName","address","placeholder","Direccion","type","text",1,"font-light","text-slate-600","w-100","p-1","rounded-md","border","border-solid"],["formControlName","price","placeholder","Precio","type","text",1,"w-50","rounded-md","border","border-solid","text-3xl","text-green-600"],["formControlName","currency_id","placeholder","Moneda",1,"ml-1","w-40","p-1","rounded-md","border","border-solid"],[1,"mt-2","flex","gap-4"],[1,"flex","items-center","gap-1"],["svgIcon","mat_solid:bed",1,"text-2xl","p-1","bg-slate-300","text-slate-600","rounded-full"],["formControlName","bedrooms","placeholder","Habitaciones",1,"w-40","p-1","rounded-md","border","border-solid"],[3,"value"],["svgIcon","mat_solid:bathtub",1,"text-2xl","p-1","bg-slate-300","text-slate-600","rounded-full"],["formControlName","bathrooms","placeholder","Ba\xf1os",1,"w-40","p-1","rounded-md","border","border-solid"],["svgIcon","feather:move",1,"text-2xl","p-1","bg-slate-300","text-slate-600","rounded-full"],["formControlName","size","placeholder","Area","type","text",1,"w-20","rounded-md","border","border-solid"],[1,"flex","flex-col","gap-10"],[1,"bg-card","shadow","rounded-2xl","p-6","mt-4"],[1,"mb-5"],[3,"fileChange"],[1,"w-full","flex","flex-wrap","gap-3"],["class","img h-30 bg-cover bg-no-repeat bg-center rounded-md",3,"style",4,"ngFor","ngForOf"],["multi","",1,"example-headers-align"],[3,"expanded"],[1,"font-bold","text-lg"],[1,"flex","flex-wrap"],[1,"w-1/3","flex","flex-col","gap-5"],[1,"text-base","text-slate-600"],["formControlName","parking","placeholder","Garaje",1,"w-20","p-1","rounded-md","border","border-solid"],["formControlName","status_id","placeholder","Status",1,"w-20","p-1","rounded-md","border","border-solid"],["formControlName","kitchen","placeholder","Cocina",1,"w-20","p-1","rounded-md","border","border-solid"],["formControlName","property_type_id","placeholder","Status",1,"w-20","p-1","rounded-md","border","border-solid"],["formControlName","fireplace","placeholder","Chimenea",1,"w-20","p-1","rounded-md","border","border-solid"],["formControlName","elevator","placeholder","Elevador",1,"w-20","p-1","rounded-md","border","border-solid"],["formControlName","construction_year","placeholder","A\xf1o contrucci\xf3n","type","text",1,"w-30","rounded-md","border","border-solid"],["formControlName","swimming_pool","placeholder","Piscina",1,"w-20","p-1","rounded-md","border","border-solid"],["formControlName","wifi","placeholder","Wifi",1,"w-20","p-1","rounded-md","border","border-solid"],["formControlName","description","name","","id","","cols","30","rows","10",1,"p-1","rounded-md","border","border-solid","w-full"],[4,"ngIf"],["formControlName","security","placeholder","Seguridad",1,"w-20","p-1","rounded-md","border","border-solid"],["formControlName","power_plant","placeholder","Planta poder",1,"w-20","p-1","rounded-md","border","border-solid"],["formControlName","walk_in_closet","placeholder","Vestidor",1,"w-20","p-1","rounded-md","border","border-solid"],["formControlName","lobby","placeholder","Vestibulo",1,"w-20","p-1","rounded-md","border","border-solid"],["formControlName","balcony","placeholder","Balcon",1,"w-20","p-1","rounded-md","border","border-solid"],["formControlName","terrace","placeholder","Terraza",1,"w-20","p-1","rounded-md","border","border-solid"],["formControlName","gym","placeholder","Gym",1,"w-20","p-1","rounded-md","border","border-solid"],["formControlName","kids_area","placeholder","Area de ni\xf1os",1,"w-20","p-1","rounded-md","border","border-solid"],["formControlName","pets_allowed","placeholder","Mascotas permitidas",1,"w-20","p-1","rounded-md","border","border-solid"],["mat-stretch-tabs","false","mat-align-tabs","start"],["label","Link de youtube"],["placeholder","Introduce la URL del video de youtube","formControlName","youtube_link","type","text",1,"w-full","rounded-md","border","border-solid"],["width","100%","height","400","title","YouTube video player","frameborder","0","allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture","allowfullscreen","",3,"src",4,"ngIf"],["label","Subir video"],[3,"multiple","fileChange",4,"ngIf"],[3,"lat","lon","height","zoom","coordinates",4,"ngIf"],[1,"flex","flex-row","gap-2","items-center"],[1,"w-1/6"],[1,"text-center"],[1,"text-8xl","text-slate-800","font-extrabold"],[2,"transform","translateY(-15px)"],[1,"text-lg","text-slate-500"],[1,"flex","justify-center"],[1,"text-xl","text-yellow-500","justify-center"],[1,"w-5/6"],[1,"flex","gap-10","items-center"],[1,"flex","justify-center","items-center","gap-5"],["mode","determinate","value","40",1,"bar1"],[1,"bg-slate-200","p-1","rounded-full"],["mode","determinate","value","40",1,"bar2"],["mode","determinate","value","40",1,"bar3"],["mode","determinate","value","40",1,"bar4"],[1,"col-span-1"],[1,"fixed","right-8","bottom-8"],["mat-button","",1,"rounded","mr-1","px-3","bg-primary-300","text-on-primary-300",3,"click"],["formControlName","trashed",1,"example-margin",3,"checked"],[1,"img","h-30","bg-cover","bg-no-repeat","bg-center","rounded-md"],[1,"w-full","justify-end","text-red-700","cursor-pointer","mt-2",2,"width","95%",3,"click"],["width","100%","height","400","title","YouTube video player","frameborder","0","allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture","allowfullscreen","",3,"src"],[3,"multiple","fileChange"],[1,"delete-video","mb-3"],["mat-button","",1,"bg-red-400","text-white",3,"click"],["width","100%","height","400","controls",""],["type","video/mp4",3,"src"],[3,"lat","lon","height","zoom","coordinates"],[3,"lat","lon"]],template:function(e,i){1&e&&(o.TgZ(0,"div",0),o._UZ(1,"div",1),o.TgZ(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7),o._uU(8),o.qZA(),o.TgZ(9,"div",8)(10,"select",9)(11,"option",10),o._uU(12,"Venta/Alquiler"),o.qZA(),o.YNc(13,sg,2,2,"option",11),o.qZA()(),o.TgZ(14,"div",12)(15,"mat-slide-toggle",13),o._uU(16," Publicada "),o.qZA(),o.YNc(17,rg,2,1,"mat-slide-toggle",14),o.qZA()(),o._UZ(18,"input",15),o.TgZ(19,"div",16)(20,"mat-icon",17),o._uU(21,"location_on"),o.qZA(),o._UZ(22,"input",18),o.qZA(),o.TgZ(23,"div"),o._UZ(24,"input",19),o.TgZ(25,"select",20)(26,"option",10),o._uU(27,"Moneda"),o.qZA(),o.YNc(28,og,2,2,"option",11),o.qZA()(),o.TgZ(29,"div",21)(30,"div",22),o._UZ(31,"mat-icon",23),o.TgZ(32,"select",24)(33,"option",25),o._uU(34,"0 Habitaciones"),o.qZA(),o.TgZ(35,"option",25),o._uU(36,"1 Habitaci\xf3n"),o.qZA(),o.TgZ(37,"option",25),o._uU(38,"2 Habitaciones"),o.qZA(),o.TgZ(39,"option",25),o._uU(40,"3 Habitaciones"),o.qZA(),o.TgZ(41,"option",25),o._uU(42,"4 Habitaciones"),o.qZA(),o.TgZ(43,"option",25),o._uU(44,"5 Habitaciones"),o.qZA(),o.TgZ(45,"option",25),o._uU(46,"6 Habitaciones"),o.qZA(),o.TgZ(47,"option",25),o._uU(48,"6 Habitaciones"),o.qZA(),o.TgZ(49,"option",25),o._uU(50,"6 Habitaciones"),o.qZA(),o.TgZ(51,"option",25),o._uU(52,"6 Habitaciones"),o.qZA(),o.TgZ(53,"option",25),o._uU(54,"6 Habitaciones"),o.qZA()()(),o.TgZ(55,"div",22),o._UZ(56,"mat-icon",26),o.TgZ(57,"select",27)(58,"option",25),o._uU(59,"0 Ba\xf1os"),o.qZA(),o.TgZ(60,"option",25),o._uU(61,"1 Ba\xf1o"),o.qZA(),o.TgZ(62,"option",25),o._uU(63,"2 Ba\xf1os"),o.qZA(),o.TgZ(64,"option",25),o._uU(65,"3 Ba\xf1os"),o.qZA(),o.TgZ(66,"option",25),o._uU(67,"4 Ba\xf1os"),o.qZA(),o.TgZ(68,"option",25),o._uU(69,"5 Ba\xf1os"),o.qZA(),o.TgZ(70,"option",25),o._uU(71,"6 Ba\xf1os"),o.qZA(),o.TgZ(72,"option",25),o._uU(73,"6 Ba\xf1os"),o.qZA(),o.TgZ(74,"option",25),o._uU(75,"6 Ba\xf1os"),o.qZA(),o.TgZ(76,"option",25),o._uU(77,"6 Ba\xf1os"),o.qZA(),o.TgZ(78,"option",25),o._uU(79,"6 Ba\xf1os"),o.qZA()()(),o.TgZ(80,"div",22),o._UZ(81,"mat-icon",28)(82,"input",29),o._uU(83," m"),o.TgZ(84,"sup"),o._uU(85,"2"),o.qZA()()()()(),o.TgZ(86,"div",30)(87,"div",31)(88,"div"),o._uU(89,"Imagenes principales de la propiedad"),o.qZA(),o.TgZ(90,"div",32)(91,"file-input",33),o.NdJ("fileChange",function(r){return i.fileChangesBanner(r)}),o.qZA()(),o.TgZ(92,"div",34),o.YNc(93,ag,3,3,"div",35),o.qZA()(),o.TgZ(94,"mat-accordion",36)(95,"mat-expansion-panel",37)(96,"mat-expansion-panel-header")(97,"mat-panel-title")(98,"span",38),o._uU(99,"Detalles y caracter\xedsticas"),o.qZA()()(),o.TgZ(100,"div",39)(101,"div",40)(102,"div")(103,"strong",41),o._uU(104,"Garaje: "),o.qZA(),o.TgZ(105,"select",42)(106,"option",25),o._uU(107,"Si"),o.qZA(),o.TgZ(108,"option",25),o._uU(109,"No"),o.qZA(),o.TgZ(110,"option",25),o._uU(111,"N/A"),o.qZA()()(),o.TgZ(112,"div")(113,"strong",41),o._uU(114,"Status: "),o.qZA(),o.TgZ(115,"select",43),o.YNc(116,lg,2,2,"option",11),o.qZA()(),o.TgZ(117,"div")(118,"strong",41),o._uU(119,"Cocina: "),o.qZA(),o.TgZ(120,"select",44)(121,"option",25),o._uU(122,"Si"),o.qZA(),o.TgZ(123,"option",25),o._uU(124,"No"),o.qZA(),o.TgZ(125,"option",25),o._uU(126,"N/A"),o.qZA()()()(),o.TgZ(127,"div",40)(128,"div")(129,"strong",41),o._uU(130,"Tipo de propiedad: "),o.qZA(),o.TgZ(131,"select",45),o.YNc(132,cg,2,2,"option",11),o.qZA()(),o.TgZ(133,"div")(134,"strong",41),o._uU(135,"Chimenea: "),o.qZA(),o.TgZ(136,"select",46)(137,"option",25),o._uU(138,"Si"),o.qZA(),o.TgZ(139,"option",25),o._uU(140,"No"),o.qZA(),o.TgZ(141,"option",25),o._uU(142,"N/A"),o.qZA()()(),o.TgZ(143,"div")(144,"strong",41),o._uU(145,"Elevador: "),o.qZA(),o.TgZ(146,"select",47)(147,"option",25),o._uU(148,"Si"),o.qZA(),o.TgZ(149,"option",25),o._uU(150,"No"),o.qZA(),o.TgZ(151,"option",25),o._uU(152,"N/A"),o.qZA()()()(),o.TgZ(153,"div",40)(154,"div")(155,"strong",41),o._uU(156,"A\xf1o: "),o.qZA(),o._UZ(157,"input",48),o.qZA(),o.TgZ(158,"div")(159,"strong",41),o._uU(160,"Piscina: "),o.qZA(),o.TgZ(161,"select",49)(162,"option",25),o._uU(163,"Si"),o.qZA(),o.TgZ(164,"option",25),o._uU(165,"No"),o.qZA(),o.TgZ(166,"option",25),o._uU(167,"N/A"),o.qZA()()(),o.TgZ(168,"div")(169,"strong",41),o._uU(170,"Wifi gratis: "),o.qZA(),o.TgZ(171,"select",50)(172,"option",25),o._uU(173,"Si"),o.qZA(),o.TgZ(174,"option",25),o._uU(175,"No"),o.qZA(),o.TgZ(176,"option",25),o._uU(177,"N/A"),o.qZA()()()()()(),o.TgZ(178,"mat-expansion-panel",37)(179,"mat-expansion-panel-header")(180,"mat-panel-title")(181,"span",38),o._uU(182,"Descripci\xf3n"),o.qZA()()(),o._UZ(183,"textarea",51),o.TgZ(184,"mat-hint"),o._uU(185),o.qZA(),o.YNc(186,hg,2,0,"mat-error",52),o.qZA(),o.TgZ(187,"mat-expansion-panel",37)(188,"mat-expansion-panel-header")(189,"mat-panel-title")(190,"span",38),o._uU(191,"Comodidades"),o.qZA()()(),o.TgZ(192,"div",39)(193,"div",40)(194,"div",16)(195,"mat-icon"),o._uU(196),o.qZA(),o.TgZ(197,"span",41),o._uU(198,"Seguridad "),o.qZA(),o.TgZ(199,"select",53)(200,"option",25),o._uU(201,"Si"),o.qZA(),o.TgZ(202,"option",25),o._uU(203,"No"),o.qZA(),o.TgZ(204,"option",25),o._uU(205,"N/A"),o.qZA()()(),o.TgZ(206,"div",16)(207,"mat-icon"),o._uU(208),o.qZA(),o.TgZ(209,"span",41),o._uU(210,"Planta de poder "),o.qZA(),o.TgZ(211,"select",54)(212,"option",25),o._uU(213,"Si"),o.qZA(),o.TgZ(214,"option",25),o._uU(215,"No"),o.qZA(),o.TgZ(216,"option",25),o._uU(217,"N/A"),o.qZA()()(),o.TgZ(218,"div",16)(219,"mat-icon"),o._uU(220),o.qZA(),o.TgZ(221,"span",41),o._uU(222,"Vestidor "),o.qZA(),o.TgZ(223,"select",55)(224,"option",25),o._uU(225,"Si"),o.qZA(),o.TgZ(226,"option",25),o._uU(227,"No"),o.qZA(),o.TgZ(228,"option",25),o._uU(229,"N/A"),o.qZA()()()(),o.TgZ(230,"div",40)(231,"div",16)(232,"mat-icon"),o._uU(233),o.qZA(),o.TgZ(234,"span",41),o._uU(235,"Vestibulo "),o.qZA(),o.TgZ(236,"select",56)(237,"option",25),o._uU(238,"Si"),o.qZA(),o.TgZ(239,"option",25),o._uU(240,"No"),o.qZA(),o.TgZ(241,"option",25),o._uU(242,"N/A"),o.qZA()()(),o.TgZ(243,"div",16)(244,"mat-icon"),o._uU(245),o.qZA(),o.TgZ(246,"span",41),o._uU(247,"Balcon "),o.qZA(),o.TgZ(248,"select",57)(249,"option",25),o._uU(250,"Si"),o.qZA(),o.TgZ(251,"option",25),o._uU(252,"No"),o.qZA(),o.TgZ(253,"option",25),o._uU(254,"N/A"),o.qZA()()(),o.TgZ(255,"div",16)(256,"mat-icon"),o._uU(257),o.qZA(),o.TgZ(258,"span",41),o._uU(259,"Terraza "),o.qZA(),o.TgZ(260,"select",58)(261,"option",25),o._uU(262,"Si"),o.qZA(),o.TgZ(263,"option",25),o._uU(264,"No"),o.qZA(),o.TgZ(265,"option",25),o._uU(266,"N/A"),o.qZA()()()(),o.TgZ(267,"div",40)(268,"div",16)(269,"mat-icon"),o._uU(270),o.qZA(),o.TgZ(271,"span",41),o._uU(272,"Gym "),o.qZA(),o.TgZ(273,"select",59)(274,"option",25),o._uU(275,"Si"),o.qZA(),o.TgZ(276,"option",25),o._uU(277,"No"),o.qZA(),o.TgZ(278,"option",25),o._uU(279,"N/A"),o.qZA()()(),o.TgZ(280,"div",16)(281,"mat-icon"),o._uU(282),o.qZA(),o.TgZ(283,"span",41),o._uU(284,"Area de ni\xf1os "),o.qZA(),o.TgZ(285,"select",60)(286,"option",25),o._uU(287,"Si"),o.qZA(),o.TgZ(288,"option",25),o._uU(289,"No"),o.qZA(),o.TgZ(290,"option",25),o._uU(291,"N/A"),o.qZA()()(),o.TgZ(292,"div",16)(293,"mat-icon"),o._uU(294),o.qZA(),o.TgZ(295,"span",41),o._uU(296,"Mascotas permitidas "),o.qZA(),o.TgZ(297,"select",61)(298,"option",25),o._uU(299,"Si"),o.qZA(),o.TgZ(300,"option",25),o._uU(301,"No"),o.qZA(),o.TgZ(302,"option",25),o._uU(303,"N/A"),o.qZA()()()()()(),o.TgZ(304,"mat-expansion-panel",37)(305,"mat-expansion-panel-header")(306,"mat-panel-title")(307,"span",38),o._uU(308,"Video"),o.qZA()()(),o.TgZ(309,"mat-tab-group",62)(310,"mat-tab",63)(311,"div",39),o._UZ(312,"input",64),o.YNc(313,ug,1,1,"iframe",65),o.qZA()(),o.TgZ(314,"mat-tab",66),o.YNc(315,dg,1,1,"file-input",67),o.YNc(316,gg,7,1,"div",52),o.qZA()()(),o.TgZ(317,"mat-expansion-panel",37)(318,"mat-expansion-panel-header")(319,"mat-panel-title")(320,"span",38),o._uU(321,"Galeria"),o.qZA()()(),o.TgZ(322,"div",32)(323,"file-input",33),o.NdJ("fileChange",function(r){return i.fileChanges(r)}),o.qZA()(),o.TgZ(324,"div",34),o.YNc(325,fg,3,3,"div",35),o.qZA()()(),o.TgZ(326,"div",4),o.YNc(327,_g,2,6,"app-ol-map",68),o.qZA(),o.TgZ(328,"div",4)(329,"div",69)(330,"div",70)(331,"div",71)(332,"div",72),o._uU(333,"4.2"),o.qZA(),o.TgZ(334,"div",73)(335,"div",74),o._uU(336,"de 5.0"),o.qZA(),o.TgZ(337,"div",75)(338,"mat-icon",76),o._uU(339,"star_border"),o.qZA(),o.TgZ(340,"mat-icon",76),o._uU(341,"star_border"),o.qZA(),o.TgZ(342,"mat-icon",76),o._uU(343,"star_border"),o.qZA(),o.TgZ(344,"mat-icon",76),o._uU(345,"star_border"),o.qZA(),o.TgZ(346,"mat-icon",76),o._uU(347,"star_border"),o.qZA()()()()(),o.TgZ(348,"div",77)(349,"div",78)(350,"div",8)(351,"div"),o._uU(352," Service "),o.TgZ(353,"div",79),o._UZ(354,"mat-progress-bar",80),o.TgZ(355,"div",81),o._uU(356,"4.7"),o.qZA()()(),o.TgZ(357,"div"),o._uU(358," Localidad "),o.TgZ(359,"div",79),o._UZ(360,"mat-progress-bar",82),o.TgZ(361,"div",81),o._uU(362,"4.7"),o.qZA()()()(),o.TgZ(363,"div",8)(364,"div"),o._uU(365," Relaci\xf3n calidad-precio "),o.TgZ(366,"div",79),o._UZ(367,"mat-progress-bar",83),o.TgZ(368,"div",81),o._uU(369,"4.7"),o.qZA()()(),o.TgZ(370,"div"),o._uU(371," Limpieza "),o.TgZ(372,"div",79),o._UZ(373,"mat-progress-bar",84),o.TgZ(374,"div",81),o._uU(375,"4.7"),o.qZA()()()()()()()()()(),o._UZ(376,"div",85),o.qZA(),o.TgZ(377,"div",86)(378,"button",87),o.NdJ("click",function(){return i.propertyID?i.actualizar():i.guardar()}),o._uU(379,"Guardar"),o.qZA()()()),2&e&&(o.Q6J("formGroup",i.propertyFG),o.xp6(8),o.hij(" ID de propiedad: ",i.property.id," "),o.xp6(3),o.Q6J("value",null),o.xp6(2),o.Q6J("ngForOf",i.contractTypes),o.xp6(2),o.Q6J("checked",!0),o.xp6(2),o.Q6J("ngIf",1==i.user.role_id),o.xp6(9),o.Q6J("value",null),o.xp6(2),o.Q6J("ngForOf",i.currencies),o.xp6(5),o.Q6J("value",0),o.xp6(2),o.Q6J("value",1),o.xp6(2),o.Q6J("value",2),o.xp6(2),o.Q6J("value",2),o.xp6(2),o.Q6J("value",4),o.xp6(2),o.Q6J("value",5),o.xp6(2),o.Q6J("value",6),o.xp6(2),o.Q6J("value",6),o.xp6(2),o.Q6J("value",6),o.xp6(2),o.Q6J("value",6),o.xp6(2),o.Q6J("value",6),o.xp6(5),o.Q6J("value",0),o.xp6(2),o.Q6J("value",1),o.xp6(2),o.Q6J("value",2),o.xp6(2),o.Q6J("value",2),o.xp6(2),o.Q6J("value",4),o.xp6(2),o.Q6J("value",5),o.xp6(2),o.Q6J("value",6),o.xp6(2),o.Q6J("value",6),o.xp6(2),o.Q6J("value",6),o.xp6(2),o.Q6J("value",6),o.xp6(2),o.Q6J("value",6),o.xp6(15),o.Q6J("ngForOf",i.filesBanner),o.xp6(2),o.Q6J("expanded",!0),o.xp6(11),o.Q6J("value",1),o.xp6(2),o.Q6J("value",0),o.xp6(2),o.Q6J("value",2),o.xp6(6),o.Q6J("ngForOf",i.status),o.xp6(5),o.Q6J("value",1),o.xp6(2),o.Q6J("value",0),o.xp6(2),o.Q6J("value",2),o.xp6(7),o.Q6J("ngForOf",i.propertyTypes),o.xp6(5),o.Q6J("value",1),o.xp6(2),o.Q6J("value",0),o.xp6(2),o.Q6J("value",2),o.xp6(6),o.Q6J("value",1),o.xp6(2),o.Q6J("value",0),o.xp6(2),o.Q6J("value",2),o.xp6(11),o.Q6J("value",1),o.xp6(2),o.Q6J("value",0),o.xp6(2),o.Q6J("value",2),o.xp6(6),o.Q6J("value",1),o.xp6(2),o.Q6J("value",0),o.xp6(2),o.Q6J("value",2),o.xp6(2),o.Q6J("expanded",!0),o.xp6(7),o.hij("Caracteres disponibles: ",i.getCharactersLeft(),""),o.xp6(1),o.Q6J("ngIf",i.propertyFG.get("description").hasError("minlength")),o.xp6(1),o.Q6J("expanded",!0),o.xp6(8),o.ekj("text-lime-500",1==i.propertyFG.get("security").value)("text-red-500",0==i.propertyFG.get("security").value),o.xp6(1),o.Oqu(1==i.propertyFG.get("security").value?"check_circle_outline":"close"),o.xp6(4),o.Q6J("value",1),o.xp6(2),o.Q6J("value",0),o.xp6(2),o.Q6J("value",2),o.xp6(3),o.ekj("text-lime-500",1==i.propertyFG.get("power_plant").value)("text-red-500",0==i.propertyFG.get("power_plant").value),o.xp6(1),o.Oqu(1==i.propertyFG.get("power_plant").value?"check_circle_outline":"close"),o.xp6(4),o.Q6J("value",1),o.xp6(2),o.Q6J("value",0),o.xp6(2),o.Q6J("value",2),o.xp6(3),o.ekj("text-lime-500",1==i.propertyFG.get("walk_in_closet").value)("text-red-500",0==i.propertyFG.get("walk_in_closet").value),o.xp6(1),o.Oqu(1==i.propertyFG.get("walk_in_closet").value?"check_circle_outline":"close"),o.xp6(4),o.Q6J("value",1),o.xp6(2),o.Q6J("value",0),o.xp6(2),o.Q6J("value",2),o.xp6(4),o.ekj("text-lime-500",1==i.propertyFG.get("fireplace").value)("text-red-500",0==i.propertyFG.get("fireplace").value),o.xp6(1),o.Oqu(1==i.propertyFG.get("fireplace").value?"check_circle_outline":"close"),o.xp6(4),o.Q6J("value",1),o.xp6(2),o.Q6J("value",0),o.xp6(2),o.Q6J("value",2),o.xp6(3),o.ekj("text-lime-500",1==i.propertyFG.get("balcony").value)("text-red-500",0==i.propertyFG.get("balcony").value),o.xp6(1),o.Oqu(1==i.propertyFG.get("balcony").value?"check_circle_outline":"close"),o.xp6(4),o.Q6J("value",1),o.xp6(2),o.Q6J("value",0),o.xp6(2),o.Q6J("value",2),o.xp6(3),o.ekj("text-lime-500",1==i.propertyFG.get("terrace").value)("text-red-500",0==i.propertyFG.get("terrace").value),o.xp6(1),o.Oqu(1==i.propertyFG.get("terrace").value?"check_circle_outline":"close"),o.xp6(4),o.Q6J("value",1),o.xp6(2),o.Q6J("value",0),o.xp6(2),o.Q6J("value",2),o.xp6(4),o.ekj("text-lime-500",1==i.propertyFG.get("gym").value)("text-red-500",0==i.propertyFG.get("gym").value),o.xp6(1),o.Oqu(1==i.propertyFG.get("gym").value?"check_circle_outline":"close"),o.xp6(4),o.Q6J("value",1),o.xp6(2),o.Q6J("value",0),o.xp6(2),o.Q6J("value",2),o.xp6(3),o.ekj("text-lime-500",1==i.propertyFG.get("kids_area").value)("text-red-500",0==i.propertyFG.get("kids_area").value),o.xp6(1),o.Oqu(1==i.propertyFG.get("kids_area").value?"check_circle_outline":"close"),o.xp6(4),o.Q6J("value",1),o.xp6(2),o.Q6J("value",0),o.xp6(2),o.Q6J("value",2),o.xp6(3),o.ekj("text-lime-500",1==i.propertyFG.get("pets_allowed").value)("text-red-500",0==i.propertyFG.get("pets_allowed").value),o.xp6(1),o.Oqu(1==i.propertyFG.get("pets_allowed").value?"check_circle_outline":"close"),o.xp6(4),o.Q6J("value",1),o.xp6(2),o.Q6J("value",0),o.xp6(2),o.Q6J("value",2),o.xp6(2),o.Q6J("expanded",!0),o.xp6(9),o.Q6J("ngIf",i.propertyFG.get("youtube_link").value),o.xp6(2),o.Q6J("ngIf",!i.videoUrl),o.xp6(1),o.Q6J("ngIf",i.video),o.xp6(1),o.Q6J("expanded",!0),o.xp6(8),o.Q6J("ngForOf",i.files),o.xp6(2),o.Q6J("ngIf",i.showMap))},dependencies:[vt.ez,vt.sg,vt.O5,Q.Ps,Q.Hw,et.u5,et.YN,et.Kr,et.Fj,et.EJ,et.JJ,et.JL,q.To,q.pp,q.ib,q.yz,q.yK,y.Bz,mt.ot,mt.lW,wt.JF,J.Nh,J.uX,J.SP,sl,qa,ig,B.rP,B.Rr,j.lN,j.bx,j.TO,L.Cv,L.pW,F.c,C.c,ng.Y,et.UX,et.sg,et.u,D.ZX],styles:[".property-banner[_ngcontent-%COMP%]   .owl-carousel-o[_ngcontent-%COMP%]{width:100%}  .property-banner .owl-nav{display:flex!important;justify-content:space-between!important;margin:0 20px!important;transform:translateY(-275px)!important;z-index:999!important;position:relative!important}  .property-banner .owl-theme .owl-nav [class*=owl-]{background:rgba(0,0,0,.51)!important;height:40px!important;width:40px!important;display:flex!important;justify-content:center!important;align-items:center!important;font-size:19px!important}  .bar1 .mat-progress-bar-fill:after{background-color:#00ba74!important}  .bar2 .mat-progress-bar-fill:after{background-color:#fbb851!important}  .bar3 .mat-progress-bar-fill:after{background-color:#83ce36!important}  .bar4 .mat-progress-bar-fill:after{background-color:#e6453c!important}"]}),n})();var jt=N(3627),mg=N(7579),Ha=N(3276),pg=N(787),Ja=N(3649);let yg=(()=>{class n{transform(e,i){return e?e.length>i?e.substr(0,i)+"...":e:" - "}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275pipe=o.Yjl({name:"excerpt",type:n,pure:!1,standalone:!0}),n})(),xg=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=o.oAB({type:n}),n.\u0275inj=o.cJS({}),n})();var vg=N(3231);function Cg(n,t){1&n&&(o.TgZ(0,"th",39),o._uU(1,"ID"),o.qZA())}function Eg(n,t){if(1&n&&(o.TgZ(0,"td",40)(1,"span",41),o._uU(2),o.qZA()()),2&n){const e=t.$implicit;o.xp6(2),o.hij(" ",e.id," ")}}function Tg(n,t){1&n&&(o.TgZ(0,"th",39),o._uU(1,"Nombre"),o.qZA())}function bg(n,t){if(1&n&&(o.TgZ(0,"td",42)(1,"span",41),o._uU(2),o.ALo(3,"excerpt"),o.qZA()()),2&n){const e=t.$implicit;o.Q6J("matTooltip",e.description)("matTooltipPosition","left"),o.xp6(2),o.hij(" ",o.xi3(3,3,e.name,100)," ")}}function wg(n,t){1&n&&(o.TgZ(0,"th",39),o._uU(1,"Direccion"),o.qZA())}function Rg(n,t){if(1&n&&(o.TgZ(0,"td",43)(1,"span",41),o._uU(2),o.qZA()()),2&n){const e=t.$implicit;o.xp6(2),o.hij(" ",e.address," ")}}function Sg(n,t){1&n&&(o.TgZ(0,"th",39),o._uU(1,"Precio"),o.qZA())}function Ig(n,t){if(1&n&&(o.TgZ(0,"td",44)(1,"span",41),o._uU(2),o.qZA()()),2&n){const e=t.$implicit;o.xp6(2),o.hij(" ",e.price||"-"," ")}}function Mg(n,t){1&n&&(o.TgZ(0,"th",39),o._uU(1,"# Habitaciones"),o.qZA())}function Ag(n,t){if(1&n&&(o.TgZ(0,"td",45)(1,"span",41),o._uU(2),o.qZA()()),2&n){const e=t.$implicit;o.xp6(2),o.hij(" ",e.bedrooms||"-"," ")}}function Pg(n,t){1&n&&(o.TgZ(0,"th",39),o._uU(1,"# Ba\xf1os"),o.qZA())}function Lg(n,t){if(1&n&&(o.TgZ(0,"td",46)(1,"span",41),o._uU(2),o.qZA()()),2&n){const e=t.$implicit;o.xp6(2),o.hij(" ",e.bathrooms||"-"," ")}}function Og(n,t){1&n&&(o.TgZ(0,"th",39),o._uU(1,"Estado"),o.qZA())}function Fg(n,t){if(1&n&&(o.TgZ(0,"td",49)(1,"span",41),o._uU(2),o.qZA()()),2&n){const e=t.$implicit;o.xp6(1),o.ekj("text-green-500",!e.deleted_at)("text-red-500",e.deleted_at),o.xp6(1),o.hij(" ",e.deleted_at?"Eliminado":"Activo"," ")}}function Dg(n,t){1&n&&(o.ynx(0,47),o.YNc(1,Og,2,0,"th",21),o.YNc(2,Fg,3,5,"td",48),o.BQk())}function kg(n,t){1&n&&(o.TgZ(0,"th",39),o._uU(1,"Acciones"),o.qZA())}function Zg(n,t){if(1&n){const e=o.EpF();o.TgZ(0,"td",50)(1,"div",51)(2,"div",52)(3,"mat-icon",53),o._uU(4,"edit"),o.qZA()(),o.TgZ(5,"div",52)(6,"mat-icon",54),o.NdJ("click",function(){const r=o.CHM(e).$implicit,a=o.oxw();return o.KtG(a.newTab("propiedad/"+r.id))}),o._uU(7,"visibility"),o.qZA()(),o.TgZ(8,"div",52)(9,"mat-icon",55),o.NdJ("click",function(){const r=o.CHM(e).$implicit,a=o.oxw();return o.KtG(a.deleteProperty(r.id))}),o._uU(10,"delete"),o.qZA()()()()}if(2&n){const e=t.$implicit;o.xp6(3),o.Q6J("routerLink","/propiedades/editar/"+e.id)}}function Ng(n,t){1&n&&o._UZ(0,"tr",56)}function Gg(n,t){1&n&&o._UZ(0,"tr",57)}const Ug=function(){return[10,25,100]},zg=[{path:"lista",component:(()=>{class n{constructor(e,i,s,r){this._propertiesService=e,this._globalService=i,this._userService=s,this._matSnachBar=r,this.columns=["id","description","address","location_type","price","published_at","acciones"],this.newColumns=["id","name","address","price","rooms","bathrooms","actions"],this.m=null,this._unsubscribeAll=new mg.x}ngOnInit(){this.getProperties(),this._userService.user$.subscribe(e=>{this.user=e,console.log(this.user),(1===e.role_id||2===e.role_id)&&(console.log("Hola que tal"),this.newColumns.splice(6,0,"state"))})}getProperties(e={},i={page:1,perPage:10}){this._propertiesService.getList(e,i).subscribe(s=>{this.dataSource=new jt.by(s.data.data),console.log(s),this.propertiesPaginated=s.data})}paginate(e){this.getProperties(this.getValues(),{page:e.pageIndex+1,perPage:e.pageSize})}getValues(){return null}newTab(e){const i=new URL(e,be.N.front_url);window.open(i.toString(),"_blank")}deleteProperty(e){this._propertiesService.delete(e+"").subscribe(()=>{this.getProperties(),this._globalService.openSnackBar(this._matSnachBar,"Propiedad eliminada correctamente",5e3,"success")})}}return n.\u0275fac=function(e){return new(e||n)(o.Y36(Pr.C),o.Y36(Lr.U),o.Y36(Or.K),o.Y36(D.ux))},n.\u0275cmp=o.Xpm({type:n,selectors:[["app-properties-list"]],standalone:!0,features:[o.jDz],decls:55,vars:9,consts:[[1,"w-full"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-8","w-full","mb-6"],[1,"w-full","col-span-1"],[1,"text-3xl","font-bold"],[1,"text-secondary"],[1,"sm:text-right"],["mat-stroked-button","",1,"w-full","sm:w-fit","rounded","mr-1","px-3","bg-primary-300","text-on-primary-300",3,"routerLink"],[1,"sm:col-span-6","flex","flex-col","flex-auto","p-6","bg-card","shadow","rounded-2xl","overflow-hidden"],[1,"grid","grid-cols-12","gap-5"],[1,"col-span-12","sm:col-span-3","text-center","sm:text-left"],[1,"text-lg","font-medium","tracking-tight","leading-6","truncate"],[1,"col-span-12","sm:col-span-9"],[1,"flex","gap-3","justify-end"],[1,"w-full","sm:w-2/5"],["type","text","matInput",""],[1,"w-1/5"],[1,"flex","mt-7","gap-1"],["mat-stroked-button","",1,"rounded","w-full","p-0","bg-primary-300","text-on-primary-300"],[1,"flex","flex-col","flex-auto","mt-2","overflow-x-auto"],["mat-table","",1,"md:min-w-240","overflow-y-visible",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","data-label","id",4,"matCellDef"],["matColumnDef","name"],["data-label","Nombre","mat-cell","","class","px-4",3,"matTooltip","matTooltipPosition",4,"matCellDef"],["matColumnDef","address"],["data-label","Direcci\xf3n","mat-cell","","class","px-4",4,"matCellDef"],["matColumnDef","price"],["data-label","Precio","mat-cell","","class","px-4",4,"matCellDef"],["matColumnDef","rooms"],["data-label","Habitaciones","mat-cell","","class","px-4",4,"matCellDef"],["matColumnDef","bathrooms"],["data-label","Ba\xf1os","mat-cell","","class","px-4",4,"matCellDef"],["matColumnDef","state",4,"ngIf"],["matColumnDef","actions"],["data-label","Acciones","mat-cell","",4,"matCellDef"],["class","table-header","mat-header-row","",4,"matHeaderRowDef"],["class","cursor-pointer","mat-row","",4,"matRowDef","matRowDefColumns"],["aria-label","Select page",3,"length","pageSize","pageSizeOptions","page"],["mat-header-cell",""],["mat-cell","","data-label","id"],[1,"font-medium"],["data-label","Nombre","mat-cell","",1,"px-4",3,"matTooltip","matTooltipPosition"],["data-label","Direcci\xf3n","mat-cell","",1,"px-4"],["data-label","Precio","mat-cell","",1,"px-4"],["data-label","Habitaciones","mat-cell","",1,"px-4"],["data-label","Ba\xf1os","mat-cell","",1,"px-4"],["matColumnDef","state"],["data-label","Estado","mat-cell","","class","px-4",4,"matCellDef"],["data-label","Estado","mat-cell","",1,"px-4"],["data-label","Acciones","mat-cell",""],[1,"flex","justify-end","gap-2"],[1,"1/3"],[1,"text-on-primary-300",3,"routerLink"],[1,"text-on-primary-300",3,"click"],[1,"text-red-500",3,"click"],["mat-header-row","",1,"table-header"],["mat-row","",1,"cursor-pointer"]],template:function(e,i){1&e&&(o.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),o._uU(4,"Propiedades"),o.qZA(),o.TgZ(5,"div",4),o._uU(6,"Una lista de propiedades registradas en el sistema"),o.qZA()(),o.TgZ(7,"div",2)(8,"div",5)(9,"button",6),o._uU(10,"Crear Propiedad"),o.qZA()()(),o._UZ(11,"div",2),o.qZA(),o.TgZ(12,"div",7)(13,"div",8)(14,"div",9)(15,"div",10),o._uU(16,"Detalles de la propiedad"),o.qZA()(),o.TgZ(17,"div",11)(18,"div",12)(19,"div",13)(20,"mat-form-field",0)(21,"mat-label"),o._uU(22,"Buscar Propiedad"),o.qZA(),o._UZ(23,"input",14),o.qZA()(),o.TgZ(24,"div",15)(25,"div",16)(26,"button",17),o._uU(27,"Buscar"),o.qZA()()()()()(),o.TgZ(28,"div",18)(29,"table",19),o.ynx(30,20),o.YNc(31,Cg,2,0,"th",21),o.YNc(32,Eg,3,1,"td",22),o.BQk(),o.ynx(33,23),o.YNc(34,Tg,2,0,"th",21),o.YNc(35,bg,4,6,"td",24),o.BQk(),o.ynx(36,25),o.YNc(37,wg,2,0,"th",21),o.YNc(38,Rg,3,1,"td",26),o.BQk(),o.ynx(39,27),o.YNc(40,Sg,2,0,"th",21),o.YNc(41,Ig,3,1,"td",28),o.BQk(),o.ynx(42,29),o.YNc(43,Mg,2,0,"th",21),o.YNc(44,Ag,3,1,"td",30),o.BQk(),o.ynx(45,31),o.YNc(46,Pg,2,0,"th",21),o.YNc(47,Lg,3,1,"td",32),o.BQk(),o.YNc(48,Dg,3,0,"ng-container",33),o.ynx(49,34),o.YNc(50,kg,2,0,"th",21),o.YNc(51,Zg,11,1,"td",35),o.BQk(),o.YNc(52,Ng,1,0,"tr",36),o.YNc(53,Gg,1,0,"tr",37),o.qZA(),o.TgZ(54,"mat-paginator",38),o.NdJ("page",function(r){return i.paginate(r)}),o.qZA()()()()),2&e&&(o.xp6(9),o.Q6J("routerLink","/propiedades/crear"),o.xp6(20),o.Q6J("dataSource",i.dataSource),o.xp6(19),o.Q6J("ngIf",1===i.user.role_id||2===i.user.role_id),o.xp6(4),o.Q6J("matHeaderRowDef",i.newColumns),o.xp6(1),o.Q6J("matRowDefColumns",i.newColumns),o.xp6(1),o.Q6J("length",null==i.propertiesPaginated?null:i.propertiesPaginated.total)("pageSize",null==i.propertiesPaginated?null:i.propertiesPaginated.per_page)("pageSizeOptions",o.DdM(8,Ug)))},dependencies:[vt.ez,vt.O5,mt.ot,mt.lW,j.lN,j.KE,j.hX,pg.LD,et.UX,y.Bz,y.rH,et.u5,F.c,F.Nt,Ja.AV,Ja.gM,jt.p0,jt.BZ,jt.fO,jt.as,jt.w1,jt.Dz,jt.nj,jt.ge,jt.ev,jt.XQ,jt.Gk,Q.Ps,Q.Hw,vg.Co,xg,yg,Ha.TU,Ha.NW,C.c,D.ZX],styles:["tr.mat-row,   tr.mat-footer-row{height:100%!important}@media screen and (max-width: 960px){.mat-table[_ngcontent-%COMP%]{border:0;vertical-align:middle}.table-header[_ngcontent-%COMP%]{display:none}.mat-table[_ngcontent-%COMP%]   caption[_ngcontent-%COMP%]{font-size:1em}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]{border-bottom:5px solid #ddd;display:block}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{border-bottom:1px solid #ddd;display:block;font-size:1em;text-align:right;font-weight:700;height:30px;margin-bottom:4%}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]:before{content:attr(data-label);float:left;text-transform:uppercase;font-weight:400;font-size:.85em}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]:last-child{border-bottom:0}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]:first-child{margin-top:4%}}"]}),n})()},{path:"crear",component:Va},{path:"editar/:id",component:Va},{path:"",pathMatch:"full",redirectTo:"lista"}]},7326:(ze,Ht,N)=>{"use strict";N.d(Ht,{C:()=>wt});var kt=N(3144),W=N(2340),vt=N(2223);let wt=(()=>{class et{constructor(q){this._httpClient=q}getList(q,j){const Q=new kt.LE({fromObject:{...j,...q}});return this._httpClient.get(`${W.N.api}/properties`,{params:Q})}get(q){return this._httpClient.get(`${W.N.api}/properties/${q}`)}getFeatures(){return this._httpClient.get(`${W.N.api}/properties/get-features`)}getPropertyTypes(){return this._httpClient.get(`${W.N.api}/properties/get-property-types`)}crear(q,j,Q,F){const L=new FormData;Object.keys(q).forEach(D=>{L.append(D,q[D])}),j.forEach(D=>{L.append("images[]",D,D.name)}),Q.forEach(D=>{L.append("bannerImgs[]",D,D.name)}),F instanceof File&&L.append("video",F,F.name);const B=new kt.WM;return B.append("Content-Type","multipart/form-data"),B.append("Accept","application/json"),this._httpClient.post(`${W.N.api}/properties`,L,{headers:B})}actualizar(q,j,Q,F,L){const B=new FormData;Object.keys(j).forEach(J=>{B.append(J,j[J])}),Q.forEach(J=>{B.append("images[]",J,J.name)}),F.forEach(J=>{B.append("bannerImgs[]",J,J.name)}),L instanceof File&&B.append("video",L,L.name);const D=new kt.WM;return D.append("Content-Type","multipart/form-data"),D.append("Accept","application/json"),D.append("_method","PUT"),this._httpClient.post(`${W.N.api}/properties/${q}?_method=PUT`,B,{headers:D})}getFeatureProperties(q){return this._httpClient.get(`${W.N.api}/properties/get-feature-properties?property_id=${q}`)}registerView(q,j,Q){return this._httpClient.post(`${W.N.api}/properties/register-view`,{userID:q,propertyID:j,brokerID:Q})}delete(q){return this._httpClient.delete(`${W.N.api}/properties/${q}`)}registerAppointment(q,j,Q,F){return this._httpClient.post(`${W.N.api}/appointments`,{property_id:q,email:j,phone:Q,message:F})}}return et.\u0275fac=function(q){return new(q||et)(vt.LFG(kt.eN))},et.\u0275prov=vt.Yz7({token:et,factory:et.\u0275fac,providedIn:"root"}),et})()},4031:(ze,Ht,N)=>{"use strict";N.d(Ht,{U:()=>et});var kt=N(4327),W=N.n(kt),vt=N(2223),wt=N(7495);let et=(()=>{class mt{constructor(j,Q){this._userService=j,this._ngZone=Q,this.httpValidationErrorMessage="Hay errores en el formulario",this.httpGeneralErrorMessage="Ocurrio un error inesperado"}getValidationErrors(j,Q){return Object.entries(Q.errors?Q.errors:{}).map(L=>{try{const B={};L[1].forEach((D,J)=>{B[J]=D}),j.get(L[0]).setErrors(B)}catch{}}),j}getValidationErrorsFormArray(j,Q){return Object.entries(Q.errors?Q.errors:{}).map(L=>{try{const B={},D=L[0].split(".")[1],J=L[0].split(".")[2];L[1].forEach((y,C)=>{B[C]=y.replace(L[0],J)}),j.controls[D].get(J).setErrors(B)}catch{}}),j}errorsLength(j){return j.errors&&Object.keys(j.errors).map((Q,F)=>F.toFixed(0)),[]}openSnackBar(j,Q,F=3e3,L="success"){j.open(Q,null,{horizontalPosition:"center",verticalPosition:"top",duration:F,panelClass:"success"===L?["bg-green-700","text-white"]:["bg-red-700","text-red-100"]})}formatDataForChart(j,Q,F,L,B){const D=Q.map(y=>{let C=new Date(y[F]);return C=new Date(C.getTime()-144e5),{x:C,y:y[L]}}),J=JSON.parse(JSON.stringify(j));return J.series={main:[{name:B,data:D}]},J}saveDataAsCSV(j,Q){const F=(C,o)=>null===o?"":o,L=Object.keys(j[0]),B=j.map(C=>L.map(o=>JSON.stringify(C[o],F)).join(";"));B.unshift(L.join(";"));const D=B.join("\r\n"),J=new Blob([D],{type:"text/csv"});let y=new Date;y=`${y.getFullYear()}-${y.getMonth()+1}-${y.getDate()} ${y.getHours()}:${y.getMinutes()}:${y.getSeconds()}`,W()(J,`${Q} ${y}.csv`)}}return mt.\u0275fac=function(j){return new(j||mt)(vt.LFG(wt.K),vt.LFG(vt.R0b))},mt.\u0275prov=vt.Yz7({token:mt,factory:mt.\u0275fac,providedIn:"root"}),mt})()},4327:function(ze,Ht){var N,W;void 0!==(W="function"==typeof(N=function(){"use strict";function wt(F,L,B){var D=new XMLHttpRequest;D.open("GET",F),D.responseType="blob",D.onload=function(){Q(D.response,L,B)},D.onerror=function(){console.error("could not download file")},D.send()}function et(F){var L=new XMLHttpRequest;L.open("HEAD",F,!1);try{L.send()}catch{}return 200<=L.status&&299>=L.status}function mt(F){try{F.dispatchEvent(new MouseEvent("click"))}catch{var L=document.createEvent("MouseEvents");L.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),F.dispatchEvent(L)}}var q="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,j=q.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),Q=q.saveAs||("object"!=typeof window||window!==q?function(){}:"download"in HTMLAnchorElement.prototype&&!j?function(F,L,B){var D=q.URL||q.webkitURL,J=document.createElement("a");J.download=L=L||F.name||"download",J.rel="noopener","string"==typeof F?(J.href=F,J.origin===location.origin?mt(J):et(J.href)?wt(F,L,B):mt(J,J.target="_blank")):(J.href=D.createObjectURL(F),setTimeout(function(){D.revokeObjectURL(J.href)},4e4),setTimeout(function(){mt(J)},0))}:"msSaveOrOpenBlob"in navigator?function(F,L,B){if(L=L||F.name||"download","string"!=typeof F)navigator.msSaveOrOpenBlob(function vt(F,L){return typeof L>"u"?L={autoBom:!1}:"object"!=typeof L&&(console.warn("Deprecated: Expected third argument to be a object"),L={autoBom:!L}),L.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(F.type)?new Blob(["\ufeff",F],{type:F.type}):F}(F,B),L);else if(et(F))wt(F,L,B);else{var D=document.createElement("a");D.href=F,D.target="_blank",setTimeout(function(){mt(D)})}}:function(F,L,B,D){if((D=D||open("","_blank"))&&(D.document.title=D.document.body.innerText="downloading..."),"string"==typeof F)return wt(F,L,B);var J="application/octet-stream"===F.type,y=/constructor/i.test(q.HTMLElement)||q.safari,C=/CriOS\/[\d]+/.test(navigator.userAgent);if((C||J&&y||j)&&typeof FileReader<"u"){var o=new FileReader;o.onloadend=function(){var S=o.result;S=C?S:S.replace(/^data:[^;]*;/,"data:attachment/file;"),D?D.location.href=S:location=S,D=null},o.readAsDataURL(F)}else{var O=q.URL||q.webkitURL,A=O.createObjectURL(F);D?D.location=A:location.href=A,D=null,setTimeout(function(){O.revokeObjectURL(A)},4e4)}});q.saveAs=Q.saveAs=Q,ze.exports=Q})?N.apply(Ht,[]):N)&&(ze.exports=W)},2402:function(ze){ze.exports=function(){"use strict";function Ht(y,C,o,O,A){!function S(G,$,it,nt,yt){for(;nt>it;){if(nt-it>600){var gt=nt-it+1,Tt=$-it+1,ai=Math.log(gt),Te=.5*Math.exp(2*ai/3),Ye=.5*Math.sqrt(ai*Te*(gt-Te)/gt)*(Tt-gt/2<0?-1:1);S(G,$,Math.max(it,Math.floor($-Tt*Te/gt+Ye)),Math.min(nt,Math.floor($+(gt-Tt)*Te/gt+Ye)),yt)}var Zi=G[$],li=it,Wt=nt;for(N(G,it,$),yt(G[nt],Zi)>0&&N(G,it,nt);li<Wt;){for(N(G,li,Wt),li++,Wt--;yt(G[li],Zi)<0;)li++;for(;yt(G[Wt],Zi)>0;)Wt--}0===yt(G[it],Zi)?N(G,it,Wt):N(G,++Wt,nt),Wt<=$&&(it=Wt+1),$<=Wt&&(nt=Wt-1)}}(y,C,o||0,O||y.length-1,A||kt)}function N(y,C,o){var O=y[C];y[C]=y[o],y[o]=O}function kt(y,C){return y<C?-1:y>C?1:0}var W=function(y){void 0===y&&(y=9),this._maxEntries=Math.max(4,y),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function vt(y,C,o){if(!o)return C.indexOf(y);for(var O=0;O<C.length;O++)if(o(y,C[O]))return O;return-1}function wt(y,C){et(y,0,y.children.length,C,y)}function et(y,C,o,O,A){A||(A=D(null)),A.minX=1/0,A.minY=1/0,A.maxX=-1/0,A.maxY=-1/0;for(var S=C;S<o;S++){var G=y.children[S];mt(A,y.leaf?O(G):G)}return A}function mt(y,C){return y.minX=Math.min(y.minX,C.minX),y.minY=Math.min(y.minY,C.minY),y.maxX=Math.max(y.maxX,C.maxX),y.maxY=Math.max(y.maxY,C.maxY),y}function q(y,C){return y.minX-C.minX}function j(y,C){return y.minY-C.minY}function Q(y){return(y.maxX-y.minX)*(y.maxY-y.minY)}function F(y){return y.maxX-y.minX+(y.maxY-y.minY)}function L(y,C){return y.minX<=C.minX&&y.minY<=C.minY&&C.maxX<=y.maxX&&C.maxY<=y.maxY}function B(y,C){return C.minX<=y.maxX&&C.minY<=y.maxY&&C.maxX>=y.minX&&C.maxY>=y.minY}function D(y){return{children:y,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function J(y,C,o,O,A){for(var S=[C,o];S.length;)if(!((o=S.pop())-(C=S.pop())<=O)){var G=C+Math.ceil((o-C)/O/2)*O;Ht(y,G,C,o,A),S.push(C,G,G,o)}}return W.prototype.all=function(){return this._all(this.data,[])},W.prototype.search=function(y){var C=this.data,o=[];if(!B(y,C))return o;for(var O=this.toBBox,A=[];C;){for(var S=0;S<C.children.length;S++){var G=C.children[S],$=C.leaf?O(G):G;B(y,$)&&(C.leaf?o.push(G):L(y,$)?this._all(G,o):A.push(G))}C=A.pop()}return o},W.prototype.collides=function(y){var C=this.data;if(!B(y,C))return!1;for(var o=[];C;){for(var O=0;O<C.children.length;O++){var A=C.children[O],S=C.leaf?this.toBBox(A):A;if(B(y,S)){if(C.leaf||L(y,S))return!0;o.push(A)}}C=o.pop()}return!1},W.prototype.load=function(y){if(!y||!y.length)return this;if(y.length<this._minEntries){for(var C=0;C<y.length;C++)this.insert(y[C]);return this}var o=this._build(y.slice(),0,y.length-1,0);if(this.data.children.length)if(this.data.height===o.height)this._splitRoot(this.data,o);else{if(this.data.height<o.height){var O=this.data;this.data=o,o=O}this._insert(o,this.data.height-o.height-1,!0)}else this.data=o;return this},W.prototype.insert=function(y){return y&&this._insert(y,this.data.height-1),this},W.prototype.clear=function(){return this.data=D([]),this},W.prototype.remove=function(y,C){if(!y)return this;for(var o,O,A,S=this.data,G=this.toBBox(y),$=[],it=[];S||$.length;){if(S||(S=$.pop(),O=$[$.length-1],o=it.pop(),A=!0),S.leaf){var nt=vt(y,S.children,C);if(-1!==nt)return S.children.splice(nt,1),$.push(S),this._condense($),this}A||S.leaf||!L(S,G)?O?(o++,S=O.children[o],A=!1):S=null:($.push(S),it.push(o),o=0,O=S,S=S.children[0])}return this},W.prototype.toBBox=function(y){return y},W.prototype.compareMinX=function(y,C){return y.minX-C.minX},W.prototype.compareMinY=function(y,C){return y.minY-C.minY},W.prototype.toJSON=function(){return this.data},W.prototype.fromJSON=function(y){return this.data=y,this},W.prototype._all=function(y,C){for(var o=[];y;)y.leaf?C.push.apply(C,y.children):o.push.apply(o,y.children),y=o.pop();return C},W.prototype._build=function(y,C,o,O){var A,S=o-C+1,G=this._maxEntries;if(S<=G)return wt(A=D(y.slice(C,o+1)),this.toBBox),A;O||(O=Math.ceil(Math.log(S)/Math.log(G)),G=Math.ceil(S/Math.pow(G,O-1))),(A=D([])).leaf=!1,A.height=O;var $=Math.ceil(S/G),it=$*Math.ceil(Math.sqrt(G));J(y,C,o,it,this.compareMinX);for(var nt=C;nt<=o;nt+=it){var yt=Math.min(nt+it-1,o);J(y,nt,yt,$,this.compareMinY);for(var gt=nt;gt<=yt;gt+=$){var Tt=Math.min(gt+$-1,yt);A.children.push(this._build(y,gt,Tt,O-1))}}return wt(A,this.toBBox),A},W.prototype._chooseSubtree=function(y,C,o,O){for(;O.push(C),!C.leaf&&O.length-1!==o;){for(var A=1/0,S=1/0,G=void 0,$=0;$<C.children.length;$++){var it=C.children[$],nt=Q(it),yt=(gt=y,Tt=it,(Math.max(Tt.maxX,gt.maxX)-Math.min(Tt.minX,gt.minX))*(Math.max(Tt.maxY,gt.maxY)-Math.min(Tt.minY,gt.minY))-nt);yt<S?(S=yt,A=nt<A?nt:A,G=it):yt===S&&nt<A&&(A=nt,G=it)}C=G||C.children[0]}var gt,Tt;return C},W.prototype._insert=function(y,C,o){var O=o?y:this.toBBox(y),A=[],S=this._chooseSubtree(O,this.data,C,A);for(S.children.push(y),mt(S,O);C>=0&&A[C].children.length>this._maxEntries;)this._split(A,C),C--;this._adjustParentBBoxes(O,A,C)},W.prototype._split=function(y,C){var o=y[C],O=o.children.length,A=this._minEntries;this._chooseSplitAxis(o,A,O);var S=this._chooseSplitIndex(o,A,O),G=D(o.children.splice(S,o.children.length-S));G.height=o.height,G.leaf=o.leaf,wt(o,this.toBBox),wt(G,this.toBBox),C?y[C-1].children.push(G):this._splitRoot(o,G)},W.prototype._splitRoot=function(y,C){this.data=D([y,C]),this.data.height=y.height+1,this.data.leaf=!1,wt(this.data,this.toBBox)},W.prototype._chooseSplitIndex=function(y,C,o){for(var O,A,S,G,$,it,nt,yt=1/0,gt=1/0,Tt=C;Tt<=o-C;Tt++){var ai=et(y,0,Tt,this.toBBox),Te=et(y,Tt,o,this.toBBox),Ye=(A=ai,S=Te,void 0,void 0,void 0,void 0,G=Math.max(A.minX,S.minX),$=Math.max(A.minY,S.minY),it=Math.min(A.maxX,S.maxX),nt=Math.min(A.maxY,S.maxY),Math.max(0,it-G)*Math.max(0,nt-$)),Xe=Q(ai)+Q(Te);Ye<yt?(yt=Ye,O=Tt,gt=Xe<gt?Xe:gt):Ye===yt&&Xe<gt&&(gt=Xe,O=Tt)}return O||o-C},W.prototype._chooseSplitAxis=function(y,C,o){var O=y.leaf?this.compareMinX:q,A=y.leaf?this.compareMinY:j;this._allDistMargin(y,C,o,O)<this._allDistMargin(y,C,o,A)&&y.children.sort(O)},W.prototype._allDistMargin=function(y,C,o,O){y.children.sort(O);for(var A=this.toBBox,S=et(y,0,C,A),G=et(y,o-C,o,A),$=F(S)+F(G),it=C;it<o-C;it++){var nt=y.children[it];mt(S,y.leaf?A(nt):nt),$+=F(S)}for(var yt=o-C-1;yt>=C;yt--){var gt=y.children[yt];mt(G,y.leaf?A(gt):gt),$+=F(G)}return $},W.prototype._adjustParentBBoxes=function(y,C,o){for(var O=o;O>=0;O--)mt(C[O],y)},W.prototype._condense=function(y){for(var C=y.length-1,o=void 0;C>=0;C--)0===y[C].children.length?C>0?(o=y[C-1].children).splice(o.indexOf(y[C]),1):this.clear():wt(y[C],this.toBBox)},W}()}}]);